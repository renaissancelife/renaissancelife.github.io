(window.webpackJsonp=window.webpackJsonp||[]).push([["desktop-feed-edgenext"],{"2H+z":function(e,t,i){"use strict";var n=i("yvDU"),s=i("rkDk"),a=i("wh7w"),o=i("btVS"),r=i("SEb4");t.a=function(e,t,i){var c=Object(r.a)(e)?n.a:o.a,d=arguments.length<3;return c(e,Object(a.a)(t,4),i,d,s.a)}},"5xIM":function(e,t,i){var n,s,a;s=[t,e],void 0===(a="function"==typeof(n=function(e,t){"use strict";var i=5e3,n="callback";function s(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function a(e){try{delete window[e]}catch(t){window[e]=void 0}}function o(e){var t=document.getElementById(e);t&&document.getElementsByTagName("head")[0].removeChild(t)}t.exports=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=e,c=t.timeout||i,d=t.jsonpCallback||n,l=void 0;return new Promise((function(i,n){var h=t.jsonpCallbackFunction||s(),u=d+"_"+h;window[h]=function(e){i({ok:!0,json:function(){return Promise.resolve(e)}}),l&&clearTimeout(l),o(u),a(h)},r+=-1===r.indexOf("?")?"?":"&";var p=document.createElement("script");p.setAttribute("src",""+r+d+"="+h),t.charset&&p.setAttribute("charset",t.charset),p.id=u,document.getElementsByTagName("head")[0].appendChild(p),l=setTimeout((function(){n(new Error("JSONP request to "+e+" timed out")),a(h),o(u),window[h]=function(){a(h)}}),c),p.onerror=function(){n(new Error("JSONP request to "+e+" failed")),a(h),o(u),l&&clearTimeout(l)}}))}})?n.apply(t,s):n)||(e.exports=a)},"6I6u":function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var n=i("D57K"),s=i("5Aq4"),a=i("tERu"),o=i("BQg2"),r=i("rvYQ"),c=i("VbA2"),d=i("msIb"),l=i("6ADy"),h=i("KETb"),u=i("XMfh"),p=i("HxRh"),g=i("ac9z"),m=i("u5KZ"),f=i("/+Un");class b{constructor(e){this.config=e}fetch(e){return Object(n.b)(this,void 0,void 0,(function*(){let t=this.config.initialRequest;if(e&&(t=Object.assign(Object.assign({},t),e)),!t)return m.a.sendAppErrorEvent(Object.assign(Object.assign({},p.th),{message:"default SDService fetch configuration was invalid"})),this.responseStatus=u.a.InvalidRequest,{status:this.responseStatus,cards:void 0};return yield this.fetchSDCards(t)}))}fetchSDCards(e){return Object(n.b)(this,void 0,void 0,(function*(){const t={credentials:"include",headers:yield d.a.getOneServiceFeedCallHeaders(),method:"GET"},i=new URL(s.k,Object(l.c)()),b=Object(g.b)();this.requestQueryParams=new o.a,Object(s.o)(e,this.requestQueryParams);const v=(yield Object(f.d)())===a.c.SignedIn?d.a.getOneServiceParamsWithAuth(r.b.UserId,e.ocid,!1):d.a.getOneServiceParamsWithoutAuth(r.b.UserId,e.ocid,!1);for(let e=0;e<v.length;e++)this.requestQueryParams.set(v[e].key,v[e].value);let y;r.b.SendFeedCallActivityIdInHeader&&this.requestQueryParams.delete(s.m.activityId),this.requestQueryParams.set(s.m.market,r.b.CurrentMarket),b>0&&this.requestQueryParams.set(g.a,b.toString()),this.requestQueryParams.get("$top")||this.requestQueryParams.set("$top","1"),this.requestQueryParams.get("User")||(this.requestQueryParams.set("User",r.b.UserId),this.requestQueryParams.delete(s.m.user)),i.search=this.requestQueryParams.toString();try{const e=1e4,s=yield Object(h.a)(()=>Object(n.b)(this,void 0,void 0,(function*(){return yield Object(c.a)(decodeURIComponent(i.href),e,t)})),"SDCardProvider.fetch");if(!s||!s.ok){const e=s?`SDService returned error response. status: ${s.status} - ${s.statusText}`:"SDService response was null";return m.a.sendAppErrorEvent(Object.assign(Object.assign({},p.vh),{message:e,pb:Object.assign(Object.assign({},p.vh.pb),{customMessage:`ServiceUrl: [${i.href}], requestHeaders: [${JSON.stringify(t&&t.headers)}]`})})),void(this.responseStatus=u.a.Failed)}y=yield s.json()}catch(e){return m.a.sendAppErrorEvent(Object.assign(Object.assign({},p.uh),{message:"Error while fetching SDService response",pb:Object.assign(Object.assign({},p.uh.pb),{customMessage:`Error: ${e} serviceUrl: ${i.href} headers: ${JSON.stringify(t.headers)} activityId: ${r.b.ActivityId}`})})),void(this.responseStatus=u.a.Failed)}return y&&y.cards&&y.cards.length>0?this.responseStatus=u.a.Success:this.responseStatus=u.a.NoContent,y}))}}},"7oW3":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var n=i("G82u");class s{}function a(){s.updateLocationDisplayName.unregisterObservers(),s.fetchWeatherSummarySuccess.unregisterObservers(),s.fetchWeatherSummaryFailure.unregisterObservers(),s.patchHourlyForecastSuccess.unregisterObservers(),s.updateLocationDetectionState.unregisterObservers(),s.updateWeatherUserProfile.unregisterObservers(),s.updateCurrentLocation.unregisterObservers(),s.updateWeatherSettings.unregisterObservers(),s.updateNonmapComponmentsReadiness.unregisterObservers(),s.updateOperationFailure.unregisterObservers(),s.updateFallbackStatus.unregisterObservers(),s.updateOverviewRequestDuration.unregisterObservers(),s.updateHyperlocal.unregisterObservers()}s.updateLocationDisplayName=new n.a("UpdateLocationDisplayName"),s.fetchWeatherSummarySuccess=new n.a("FetchWeatherSummarySuccess"),s.fetchWeatherSummaryFailure=new n.a("FetchWeatherSummaryFailure"),s.patchHourlyForecastSuccess=new n.a("FetchHourlyForecastSuccess"),s.updateLocationDetectionState=new n.a("UpdateLocationDetectionState"),s.updateWeatherUserProfile=new n.a("UpdateWeatherUserProfile"),s.updateCurrentLocation=new n.a("UpdateCurrentLocation"),s.updateWeatherSettings=new n.a("UpdateWeatherSettings"),s.updateNonmapComponmentsReadiness=new n.a("UpdateNonmapComponmentsReadiness"),s.updateOperationFailure=new n.a("updateOperationFailure"),s.updateFallbackStatus=new n.a("updateFallbackStatus"),s.updateOverviewRequestDuration=new n.a("updateOverviewRequestDuration"),s.updateHyperlocal=new n.a("updateHyperlocal")},"8+qV":function(e,t){},"8ntK":function(e,t,i){"use strict";var n;i.d(t,"a",(function(){return n})),function(e){e.Save="Save",e.Mute="Mute",e.Follow="Follow",e.Unfollow="Unfollow",e.InterestFailure="InterestFailure",e.ShowMore="ShowMore",e.ShowFewer="ShowFewer",e.Hide="Hide",e.DisableNotification="DisableNotification",e.EnableNotification="EnableNotification"}(n||(n={}))},Cj5D:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return s})),i.d(t,"c",(function(){return d}));var n,s,a=i("C4R5"),o=i("HS3Q"),r=i("+qLX"),c=i("w0HK");function d(e,t){e&&t?Object(a.a)().pushHistory(o.b.Personalize,"",{isRequestFromSdCardAddRemoveClick:!0}):e&&Object(c.a)().switchPivot({pivotId:e.pivotId,configIndexHref:e.configIndexHref,configIndexRef:e.configIndexRef,context:Object.assign(Object.assign({},e.context),{isRequestFromSdCardAddRemoveClick:!0}),telemetryPageName:r.a.Interests,display:e.displayName})}!function(e){e.SwitchToPageSettings="SwitchToPageSettings",e.SwitchToNewsSettingsInPersonalizePivot="SwitchToNewsSettingsInPersonalizePivot"}(n||(n={})),function(e){e.edgePageSettings="EdgePageSettings",e.chromiumPageSettings="ChromiumPageSettings",e.proActiveCanvasSettingHandler="ProActiveCanvasHandler",e.localStorageSettings="LocalStorageSettings"}(s||(s={}))},Cn94:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n,s=i("G82u");!function(e){e.SaveCard="SaveCard",e.UnsaveCard="UnsaveCard",e.HideCard="HideCard",e.UnhideCard="UnhideCard"}(n||(n={}));class a{}a.Init=new s.a("Init"),a.DisableMenu=new s.a("DisableMenu")},FfXy:function(e,t,i){"use strict";var n;i.d(t,"a",(function(){return n})),function(e){e[e.none=0]="none",e[e.enabled=1]="enabled",e[e.saved=2]="saved",e[e.hide=4]="hide",e[e.showMore=8]="showMore",e[e.showFewer=16]="showFewer",e[e.mute=32]="mute",e[e.hidden=64]="hidden",e[e.report=128]="report",e[e.adFeedbackSubmitted=256]="adFeedbackSubmitted"}(n||(n={}))},HFPz:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var n=i("D57K"),s=i("KHt8"),a=i("P4Ao"),o=i("QBS5"),r=i("oePG");class c extends s.b{constructor(){super(...arguments),this.addCloseButton=!1,this.handleCloseButton=()=>{this.hidden=!0,this.sourceLink="",this.$emit("bing-video-embed-player_close-player")}}}Object(n.e)([o.b],c.prototype,"sourceLink",void 0),Object(n.e)([o.b],c.prototype,"addCloseButton",void 0),Object(n.e)([r.d],c.prototype,"closeButtonAriaLabel",void 0),Object(n.e)([r.d],c.prototype,"closeButtonTelemetryTag",void 0),Object(n.e)([r.d],c.prototype,"videoEmbedPlayerHeight",void 0),Object(n.e)([r.d],c.prototype,"videoEmbedPlayerWidth",void 0);const d=i("4X57").a`
fluent-dialog::part(control) {
    padding: 0;
    display: flex;
    flex-direction: column;
    position: relative;
}

fluent-dialog::part(positioning-region) {
    z-index: 700;
}

.bing-iframe-player {
    width: 100%;
    height: 100%;
    overflow: hidden;
    border-radius: calc(var(--elevated-corner-radius) * 1px);
}

.close-button {
    position: absolute;
    top: 12px;
    right: 12px;
    align-items: center;
    width: 32px;
    height: 32px;
    border-radius: 20px;
    backdrop-filter: blur(4px);
    background: rgba(255, 255, 255, 0.08);
    fill: #ffffff;
    fill-opacity: 0.7;
}

.close-button:hover {
    background: rgba(255, 255, 255, 0.18);
    fill-opacity: 1;
}
`;var l=i("m1Vi"),h=i("6BDD"),u=i("6vBc"),p=i("eUhr");l.b,s.b;const g=h.b`
<style>
    fluent-dialog::part(control) {
        width: ${e=>e.videoEmbedPlayerWidth};
        height: ${e=>e.videoEmbedPlayerHeight};
    }
</style>
<fluent-dialog ?hidden=${e=>e.hidden}>
    ${Object(u.a)(e=>e.addCloseButton,h.b`
        <fluent-button
            tabindex="0"
            appearance="stealth"
            class="close-button"
            part="close-button"
            aria-label=${e=>e.closeButtonAriaLabel}

            @click=${e=>e.handleCloseButton()}
            @keypress=${e=>e.handleCloseButton()}
            ${Object(p.b)(e=>e.closeButtonTelemetryTag)}
        >
            <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M14.1016 1.60156L8.20312 7.5L14.1016 13.3984L13.3984 14.1016L7.5 8.20312L1.60156 14.1016L0.898438 13.3984L6.79688 7.5L0.898438 1.60156L1.60156 0.898438L7.5 6.79688L13.3984 0.898438L14.1016 1.60156Z"
                ></path>
            </svg>
        </fluent-button>
    `)}
    <iframe
        src=${e=>e.sourceLink}
        class="bing-iframe-player"
        frameborder="0"
    />
</fluent-dialog>
`;let m=class extends c{};m=Object(n.e)([Object(a.b)({name:"msn-bing-video-embed-player",template:g,styles:[s.a,d]})],m)},JFdr:function(e,t,i){"use strict";var n=Math.floor,s=Math.random;t.a=function(e,t){return e+n(s()*(t-e+1))}},KPQt:function(e,t,i){"use strict";var n=i("XAMW"),s=i("b8Mt"),a=i("wh7w");t.a=function(e,t){return Object(n.a)(e,Object(a.a)(t,3),s.a)}},KmUD:function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return a})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return g})),i.d(t,"c",(function(){return m})),i.d(t,"d",(function(){return f})),i.d(t,"k",(function(){return b})),i.d(t,"g",(function(){return v})),i.d(t,"j",(function(){return y})),i.d(t,"i",(function(){return C})),i.d(t,"h",(function(){return S}));var n,s,a,o=i("YJhp"),r=i("Am8i"),c=i("dMmp"),d=i("uZl+"),l=i("kpPY"),h=i("XgsJ"),u=i("vhqU");!function(e){e.Email="email",e.Facebook="facebook",e.Line="line",e.LinkedIn="linkedin",e.Skype="skype",e.Twitter="twitter",e.VK="vk",e.WhatsApp="whatsapp"}(n||(n={})),function(e){e.Share="share",e.Mute="mute",e.Report="report",e.ReportAd="reportad"}(s||(s={})),function(e){e.Hide="Hide",e.Like="Like",e.Dislike="Dislike",e.Mute="Mute",e.Save="Save",e.Share="Share",e.ShowMore="ShowMore",e.ShowFewer="ShowFewer",e.Divider="Divider",e.Report="Report",e.ReportAd="ReportAd",e.AdPrivacy="AdPrivacy"}(a||(a={}));const p=e=>({[a.Save]:{title:e.localizedStrings.cardActionMenuItemSave,glyph:o.b.Save,undoGlyph:o.a.Saved,onClickPropKey:a.Save,undoText:e.localizedStrings.cardActionMenuItemUndoSave,key:a.Save,telemetryName:d.b.saveMenuItemTelemetryName,telemetryBehavior:r.c.Save,telemetryType:r.f.ActionButton,undoTelemetryType:r.f.ActionButton},[a.Share]:{title:e.localizedStrings.cardActionMenuItemShare,glyph:o.b.Share,onClickPropKey:a.Save,key:a.Share,telemetryName:d.b.shareDialogTelemetryName,telemetryBehavior:r.c.Share,telemetryType:r.f.ActionButton},[a.ShowMore]:{title:e.localizedStrings.cardActionMenuItemShowMore,glyph:o.b.ThumbUp,undoGlyph:o.b.ThumbUpBlue,onClickPropKey:a.ShowMore,undoText:e.localizedStrings.cardActionMenuItemUndoShowMore,key:a.ShowMore,telemetryName:d.b.showMoreMenuItemTelemetryName,telemetryBehavior:r.c.Like,telemetryType:r.f.ActionButton,telemetryContentHeadline:d.b.showMoreHeadlineTelemetryName,undoTelemetryType:r.f.ActionButton},[a.ShowFewer]:{title:e.localizedStrings.cardActionMenuItemShowFewer,glyph:o.b.ThumbDown,undoGlyph:o.b.ThumbDownBlue,onClickPropKey:a.ShowFewer,undoText:e.localizedStrings.cardActionMenuItemUndoShowFewer,key:a.ShowFewer,telemetryName:d.b.showFewerMenuItemTelemetryName,telemetryBehavior:r.c.Dislike,telemetryType:r.f.ActionButton,telemetryContentHeadline:d.b.showFewerHeadlineTelemetryName,undoTelemetryType:r.f.ActionButton},[a.Hide]:{title:e.localizedStrings.cardActionMenuItemHide,glyph:o.b.HideStory,onClickPropKey:a.Save,key:a.Hide,telemetryName:d.b.hideMenuItemTelemetryName,telemetryBehavior:r.c.Hide,telemetryType:r.c.Hide,telemetryContentHeadline:d.b.hideHeadlineTelemetryName},[a.Mute]:{title:e.localizedStrings.cardActionMenuItemMute,glyph:o.b.Hide,onClickPropKey:a.Save,key:a.Mute,telemetryName:d.b.muteMenuItemTelemetryName,telemetryBehavior:r.c.Mute,telemetryType:r.c.Mute},[a.Report]:{title:e.localizedStrings.cardActionMenuItemReport,glyph:o.b.Flag,onClickPropKey:a.Report,key:a.Report,telemetryName:d.b.reportMenuItemTelemetryName,telemetryBehavior:r.c.Report,telemetryType:r.f.ActionButton,telemetryContentHeadline:d.b.reportHeadlineTelemetryName},[a.ReportAd]:{title:e.localizedStrings.cardActionMenuItemReportAd,glyph:o.b.Flag,onClickPropKey:a.ReportAd,key:a.ReportAd}}),g=(e,t,i,s)=>({[n.Email]:{tooltip:Object(l.a)(e.localizedStrings.socialMediaEmailAriaLabel,e.localizedStrings.socialMediaEmailLabel),backgroundColor:"#0078D7",image:{alt:e.localizedStrings.socialMediaEmailLabel,src:o.a.Mail},source:e.localizedStrings.socialMediaEmailLabel,target:"_self",href:c.String.Format("mailto:?subject={title}&body={body}",{title:encodeURIComponent(i),body:encodeURIComponent(Object(l.a)(e.localizedStrings.shareDialogEmailBodyText,i,t))}),telemetryTag:s&&s[n.Email]},[n.Facebook]:{tooltip:Object(l.a)(e.localizedStrings.socialMediaIconsAriaLabel,"Facebook"),backgroundColor:"#4267B2",image:{alt:"Facebook",src:o.a.Facebook},source:"Facebook",target:"_blank",href:c.String.Format("https://www.facebook.com/sharer.php?u={url}&amp;t={title}",{url:encodeURIComponent(t),title:encodeURIComponent(i)}),telemetryTag:s&&s[n.Facebook]},[n.LinkedIn]:{tooltip:Object(l.a)(e.localizedStrings.socialMediaIconsAriaLabel,"LinkedIn"),backgroundColor:"#0083BE",image:{alt:"LinkedIn",src:o.a.LinkedIn},source:"LinkedIn",target:"_blank",href:c.String.Format("https://www.linkedin.com/shareArticle?mini=true&url={url}&title={title}&source={refererUrl}",{url:encodeURIComponent(t),title:encodeURIComponent(i),refererUrl:Object(h.l)()}),telemetryTag:s&&s[n.LinkedIn]},[n.Skype]:{tooltip:Object(l.a)(e.localizedStrings.socialMediaIconsAriaLabel,"Skype"),backgroundColor:"#33BFFC",image:{alt:"Skype",src:o.a.Skype},source:"Skype",target:"_blank",href:c.String.Format("https://web.skype.com/share?url={url}&flow_id={flowid}&source=msn",{url:encodeURIComponent(t),flowid:Object(u.a)()}),telemetryTag:s&&s[n.Skype]},[n.Twitter]:{tooltip:Object(l.a)(e.localizedStrings.socialMediaIconsAriaLabel,"Twitter"),backgroundColor:"#20A2F2",image:{alt:"Twitter",src:o.a.Twitter},source:"Twitter",target:"_blank",href:c.String.Format("https://twitter.com/share?url={url}&text={title}&original_referer={refererUrl}",{url:encodeURIComponent(t),title:encodeURIComponent(i),refererUrl:Object(h.l)()}),telemetryTag:s&&s[n.Twitter]},[n.WhatsApp]:{tooltip:Object(l.a)(e.localizedStrings.socialMediaIconsAriaLabel,"WhatsApp"),backgroundColor:"#25D366",image:{alt:"WhatsApp",src:o.a.WhatsApp},source:"WhatsApp",target:"_blank",href:c.String.Format("https://web.whatsapp.com/send?text={url}",{url:encodeURIComponent(t)}),telemetryTag:s&&s[n.WhatsApp]}}),m={personalize:"Personalize",myInterests:"MyInterests"},f=5e3,b="/{locale}/feed/personalize#mutedPublishers",v="{locale}",y="https://www.msn.com",C="https://go.microsoft.com/fwlink/?LinkId=521839",S="https://petrol.office.microsoft.com/v1/feedback"},Qo3E:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("u5KZ"),s=i("XlyT"),a=i("HxRh");class o{static renderToast(e){this.renderToastCallback?this.renderToastCallback(e):n.a.sendAppErrorEvent(Object(s.a)(a.sj,"Undefined toast render callback function"))}static setRenderToastCallback(e){this.renderToastCallback=e}static expireToast(e){this.expireToastCallback?this.expireToastCallback(e):n.a.sendAppErrorEvent(Object(s.a)(a.rj,"Undefined toast expire callback function"))}static setExpireToastCallback(e){this.expireToastCallback=e}static setCurrentToast(e,t){this.currentToastId!==e&&(this.currentToastId=e,this.renderToastCallback=t,this.currentToastIdChangeCallbacks.forEach(t=>t(e)),this.renderToast())}static addCurrentToastIdChangeCallback(e){e&&this.currentToastIdChangeCallbacks.push(e)}}o.currentToastIdChangeCallbacks=[]},XAMW:function(e,t,i){"use strict";t.a=function(e,t,i){var n;return i(e,(function(e,i,s){if(t(e,i,s))return n=i,!1})),n}},bYbF:function(e,t,i){"use strict";i.d(t,"a",(function(){return R}));var n,s=i("D57K"),a=i("KmUD"),o=i("ypwz"),r=i("tERu"),c=i("HxRh"),d=i("XlyT");!function(e){e[e.feedbackDefault=2224]="feedbackDefault",e[e.windowsFeed=2475]="windowsFeed"}(n||(n={}));class l{constructor(){this.manifestType="Sas",this.appId=n.feedbackDefault,this.source="Client",this.type="Idea"}}var h=i("I6Lx"),u=i("rvYQ"),p=i("1I/+"),g=i("u5KZ"),m=i("6ADy"),f=i("msIb"),b=i("KETb"),v=i("k112"),y=i("KUTD"),C=i("Qo3E"),S=i("8ntK"),O=i("/+Un"),A=i("FfXy"),w=i("4L2h"),I=i("r6MD"),T=i("ac9z");class R{constructor(e){this.fetchImpl=e,this.providersServiceEndpoint="./Msn/Providers",this.cardActionV2sServiceEndpoint="./Graph/Actions",this.userFeedbackEventhubUrl="/labs/api/feedbackSignal",this.ocid="feeds"}ShowFewer(e){return Object(s.b)(this,void 0,void 0,(function*(){return this.PostCardActionV2Request(e,a.a.Dislike,null)}))}UnshowFewer(e){return Object(s.b)(this,void 0,void 0,(function*(){return this.DeleteCardActionV2Request(e,a.a.Dislike)}))}ShowMore(e){return Object(s.b)(this,void 0,void 0,(function*(){return this.PostCardActionV2Request(e,a.a.Like)}))}UnshowMore(e){return Object(s.b)(this,void 0,void 0,(function*(){return this.DeleteCardActionV2Request(e,a.a.Like)}))}Save(e){return Object(s.b)(this,void 0,void 0,(function*(){return this.PostCardActionV2Request(e,a.a.Save)}))}Unsave(e){return Object(s.b)(this,void 0,void 0,(function*(){return this.DeleteCardActionV2Request(e,a.a.Save)}))}Hide(e){return Object(s.b)(this,void 0,void 0,(function*(){return this.PostCardActionV2Request(e,a.a.Dislike,null)}))}Unhide(e){return Object(s.b)(this,void 0,void 0,(function*(){return this.DeleteCardActionV2Request(e,a.a.Dislike)}))}Mute(e){return Object(s.b)(this,void 0,void 0,(function*(){return this.PostCardActionV2Request(e,a.a.Mute,"SourceProvider")}))}Report(e,t,i,n){return Object(s.b)(this,void 0,void 0,(function*(){const s=h.b.ClientSettings?h.b.ClientSettings.aid:"";let a="";const r={serviceType:"oneservice",oneServiceTraceId:"",oneServiceActivityId:s};u.b.AppType===o.a.Windows&&(a=g.a.getPageMetadata().JoinIdProps.IDXId,r.oneServiceTraceId="",r.oneServiceActivityId=s),g.a.sendTraceInfoEvent(r);const d=this.createOcvFeedbackData(e,t,i,n);this.reportFeedbackToOcv(d);const l=JSON.stringify({article:{id:e},canvas:{name:u.b.AppType,version:navigator.userAgent,pageType:h.b.ClientSettings.pagetype},data:{activityId:s,feedbackTags:t,feedbackText:i},appEnvironment:u.b,clientSettings:h.b.ClientSettings,extSchema:r}),p=Object(m.c)().origin+this.userFeedbackEventhubUrl,b={method:"POST",headers:yield f.a.getOneServiceHeaders(),body:l,credentials:"include"};let v;try{if(v=yield fetch(p,b),v.status>=400)throw new Error(v.statusText)}catch(e){g.a.sendAppErrorEvent(Object.assign(Object.assign({},c.nb.CardActionPostActionError),{message:"Error while posting action for card action",pb:Object.assign(Object.assign({},c.nb.CardActionPostActionError.pb),{customMessage:`url: ${p}, error: ${e}`})}))}return v}))}reportFeedbackToOcv(e){return Object(s.b)(this,void 0,void 0,(function*(){const t={method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};try{const e=yield this.fetchImpl(a.h,t);if(!e.ok){const i=`Error code: ${e.status} Error message: ${e.statusText} Request params: ${t} Service url: ${a.h}`;return Object(d.b)(c.nb.CardActionBadRequestReportingToOcv,"Request is not valid, it has no content, or the manifest is not formatted correctly",i),!1}return!0}catch(e){const i=`Error code: ${e?e.code:"undefined"} Error message: ${e?e.message:"undefined"} Request params: ${t} Service url: ${a.h}`;return Object(d.c)(e,c.nb.CardActionExceptionReportingToOcv,"Exception reporting feedback to OCV",i),!1}}))}createOcvFeedbackData(e,t,i,s){var a,r,c,d;const g=new l,m=null===h.b||void 0===h.b?void 0:h.b.ClientSettings,f=null===u.b||void 0===u.b?void 0:u.b.HostPage,b=Object(p.b)(s.data.locationHref,"locationHref"),v=(null==m?void 0:m.aid)||"",y=(null===(r=null===(a=null===u.b||void 0===u.b?void 0:u.b.CurrentRequestTargetScope)||void 0===a?void 0:a.pageExperiments)||void 0===r?void 0:r.join(","))||"",C=null===(c=null===u.b||void 0===u.b?void 0:u.b.CurrentRequestTargetScope)||void 0===c?void 0:c.browser;return u.b.AppType!==o.a.Windows&&u.b.AppType!==o.a.WindowsShell||(g.appId=n.windowsFeed),g.submitTime=(new Date).toISOString(),g.clientFeedbackId=Object(w.e)(),g.comment=i,g.rating=4,g.application={appData:`{"ScreenResolution":"${window&&window.screen?[screen.width,screen.height].join("x"):""}","articleId":"${e}"}`},g.telemetry={audience:(null===u.b||void 0===u.b?void 0:u.b.CurrentMarket)||"",audienceGroup:(null==f?void 0:f.verticalKey)||"Production",channel:(null==f?void 0:f.categoryKey)||"",deviceType:(null==m?void 0:m.deviceFormFactor)||"",errorClassification:JSON.stringify({articleId:e,NotRelevant:t.OffensiveOrAdult,BlurryImage:t.InaccurateOrMisleading,OutdatedArticle:t.Duplicate,MisleadingTitle:t.Outdated,DuplicateArticle:t.DisplayIssue,OffensiveContent:t.Other}),featureArea:(null==m?void 0:m.pagetype)||"",flights:y,isUserSubscriber:Object(O.e)(),platform:null===(d=u.b.CurrentRequestTargetScope)||void 0===d?void 0:d.os,processSessionId:v,sourceContext:u.b.AppType},g.web={browser:(null==C?void 0:C.browserType)||"",browserVersion:(null==C?void 0:C.version)||"",sourcePageName:(null==f?void 0:f.subcategoryKey)||"",sourcePageURI:b},g}ReportAd(e,t){return Object(s.b)(this,void 0,void 0,(function*(){const i=e.concat("&f="+t);let n=new Image(1,1);n.src=i,n=null}))}GetProviderIcon(e){return Object(s.b)(this,void 0,void 0,(function*(){const t=yield this.GetPublisherDetails(e);return Object(I.a)(t,"value[0].logos[0].imageLink.href",void 0)}))}PostCardActionV2Event(e,t,i,n=(()=>null),o,r,c=!0,d){return Object(s.b)(this,void 0,void 0,(function*(){switch(t){case a.a.ShowMore:return e&A.a.showMore?(c&&C.a.renderToast({id:S.a.ShowMore+"-"+i,toastType:S.a.ShowMore,expirationInMs:a.d,onClick:()=>{o?o(i,e^A.a.showMore,t,!0):this.PostCardActionV2Event(e^A.a.showMore,t,i,n)},referrerButton:d}),yield this.ShowMore(i)):(C.a.expireToast(S.a.ShowMore+"-"+i),yield this.UnshowMore(i)),n(i,e);case a.a.ShowFewer:return e&A.a.showFewer?(c&&C.a.renderToast({id:S.a.ShowFewer+"-"+i,toastType:S.a.ShowFewer,expirationInMs:a.d,onClick:()=>{o?o(i,e^A.a.showFewer,t,!0):this.PostCardActionV2Event(e^A.a.showFewer,t,i,n)},referrerButton:d}),yield this.ShowFewer(i)):(C.a.expireToast(S.a.ShowFewer+"-"+i),yield this.UnshowFewer(i)),n(i,e);case a.a.Save:return e&A.a.saved?(c&&C.a.renderToast({id:S.a.Save+"-"+i,toastType:S.a.Save,expirationInMs:a.d,referrerButton:d}),yield this.Save(i)):(C.a.expireToast(S.a.Save+"-"+i),yield this.Unsave(i)),n(i,e);case a.a.Hide:return e&A.a.hide?yield this.Hide(i):yield this.Unhide(i),n(i,e);case a.a.Mute:yield this.Mute(r);break;case a.a.ReportAd:return n(i,e);default:return}}))}GetPublisherDetails(e){return Object(s.b)(this,void 0,void 0,(function*(){const t=yield f.a.getBaseRequestData("GET"),i={key:"ids",value:e},n=Object(m.d)(this.providersServiceEndpoint);[i,...yield this.getOneServiceCommonParam()].forEach(e=>e.value&&n.searchParams.set(e.key,e.value));try{const i=yield Object(b.a)(()=>Object(s.b)(this,void 0,void 0,(function*(){return yield this.fetchImpl(n.href,t)})),"getProviderDetails");if(!i.ok){const t=`OneService returned error response. Status: ${i.status} for providerId: ${e} (url: ${n.href}`;throw new Error(t)}return i.json()}catch(e){g.a.sendAppErrorEvent(Object.assign(Object.assign({},c.nb.CardActionGetActionError),{message:`Error while calling getPublisherDetails action for card action: url: ${n.href}, error: ${e}`}))}}))}DeleteCardActionV2Request(e,t){return Object(s.b)(this,void 0,void 0,(function*(){const i=yield f.a.getBaseRequestData("DELETE");(yield this.isUserSignedIn())&&(i.credentials="include");const n={key:"$filter",value:`actionType eq '${t}' and targetId eq '${e}'`},a=Object(m.d)(this.cardActionV2sServiceEndpoint);[n,...yield this.getOneServiceCommonParam()].forEach(e=>e.value&&a.searchParams.set(e.key,e.value));try{const n=yield Object(b.a)(()=>Object(s.b)(this,void 0,void 0,(function*(){return yield this.fetchImpl(a.href,i)})),"deleteCardActionV2"+t);if(n.status>=400){const i=`OneService returned error response. Status: ${n.status} for actionType: ${t} and targetId: ${e}`;throw new Error(i)}return Object(v.a)(this.getPreloadReloadReason(t)),Object(T.e)(),n}catch(e){g.a.sendAppErrorEvent(Object.assign(Object.assign({},c.nb.CardActionDeleteActionError),{message:`Error while calling delete action for card action: url: ${a.href}, error: ${e}`}))}}))}PostCardActionV2Request(e,t,i){return Object(s.b)(this,void 0,void 0,(function*(){const n={method:"POST",body:JSON.stringify({actionType:t,targetId:e,targetType:i}),headers:yield f.a.getOneServiceHeaders()};(yield this.isUserSignedIn())&&(n.credentials="include");const a=Object(m.d)(this.cardActionV2sServiceEndpoint);(yield this.getOneServiceCommonParam()).forEach(e=>e.value&&a.searchParams.set(e.key,e.value));try{const o=yield Object(b.a)(()=>Object(s.b)(this,void 0,void 0,(function*(){return yield this.fetchImpl(a.href,n)})),"getCardActionV2"+t);if(o.status>=400){const n=`OneService returned error response. Status: ${o.status} for actionType: ${t}, targetId: ${e} and targetType: ${i}`;throw new Error(n)}return Object(v.a)(this.getPreloadReloadReason(t)),Object(T.e)(),o.json()}catch(e){g.a.sendAppErrorEvent(Object.assign(Object.assign({},c.nb.CardActionPostActionError),{message:`Error while posting action for card action: url: ${a.href}, error: ${e}`}))}}))}getOneServiceCommonParam(){return Object(s.b)(this,void 0,void 0,(function*(){const e=yield this.isUserSignedIn();let t=!0;return u.b.AppType===o.a.NewsAndInterests||u.b.AppType===o.a.WindowsNewsPlus?(t=!1,this.ocid="winp2"):h.b.IsBlendedEnterprise&&(this.ocid="entnewsntp",t=!1),e?f.a.getOneServiceParamsWithAuth(u.b.UserId,this.ocid,t):f.a.getOneServiceParamsWithoutAuth(u.b.UserId,this.ocid,t)}))}isUserSignedIn(){return Object(s.b)(this,void 0,void 0,(function*(){if(h.b.UserIsSignedIn)return!0;return(yield Object(O.d)())===r.c.SignedIn}))}getPreloadReloadReason(e){switch(e){case a.a.Mute:return y.a.MutePublisher;case a.a.Save:return y.a.Save;case a.a.Like:return y.a.Like;case a.a.Dislike:return y.a.Dislike;default:return y.a.SettingsChange}}}},btVS:function(e,t,i){"use strict";t.a=function(e,t,i,n,s){return s(e,(function(e,s,a){i=n?(n=!1,e):t(i,e,s,a)})),i}},cASJ:function(e,t,i){"use strict";i.d(t,"a",(function(){return Oe})),i.d(t,"b",(function(){return we}));var n,s=i("D57K"),a=i("XlyT"),o=i("HxRh"),r=i("+djJ"),c=i("YUMq"),d=i("pMIE"),l=i("2H+z"),h=i("r6MD"),u=i("KPQt"),p=i("CjK2"),g=i("oIHq"),m=i("rvYQ"),f=i("Fpjf"),b=i("ADRF"),v=i("aHCm"),y=i("iQkd");!function(e){e.SlideshowPreview="ss",e.ArticlePreview="ar",e.VideoPreview="vi"}(n||(n={}));var C=i("KETb"),S=i("u5KZ");class O{getCMSList(e,t){return Object(s.b)(this,void 0,void 0,(function*(){if(e)try{const i={method:"GET",headers:{}},n=yield Object(C.a)(()=>Object(s.b)(this,void 0,void 0,(function*(){const t=new URL(`${y.e.CMSListServiceUrl}${e}${m.b.ContentServiceUrlBase.search}`,""+m.b.ContentServiceUrlBase),n=yield fetch(t.toString(),i);if(n.ok)return n.json();S.a.sendAppErrorEvent(Object(a.a)(o.De,"Get CMSAd content failed",`Invalid response from CMS, ${n.statusText}, listId: ${e}`))})),"getCMSList");if(!n)return void S.a.sendAppErrorEvent(Object(a.a)(o.De,"Get CMSAd content failed","Invalid response.json(), listId: "+e));const r=n;return this.translateToCMSItem(r,e,t,y.b.PrivacyUrl)}catch(t){return void S.a.sendAppErrorEvent(Object(a.a)(o.De,"Get CMSAd content failed",`Error while fetching CMS Native Ad  ${t}, id: ${e}`))}else S.a.sendAppErrorEvent(Object(a.a)(o.De,"Get CMSAd content failed","No backfill id found, listId: "+e))}))}translateToCMSItem(e,t,i,n){return Object(s.b)(this,void 0,void 0,(function*(){if(!e||!e.list||0===e.list.length)return void S.a.sendAppErrorEvent(Object(a.a)(o.De,"Get CMSAd content failed","No CMS Response returned from "+t));const s=[];for(const t of e.list){let e=!1;const a=t.extendedProperties;if(a)for(const t of a)if(t.key&&t.key.indexOf("is_content")>-1&&t.values&&t.values.indexOf("true")>-1){e=!0;break}let o;if(null!=t.link&&null!=t.link.title&&t.link.href&&null!=t.link.image&&null!=t.link.image.href){const i=this.getCMSContentId(t.link.image.href);let s,a;if(t.link.ad)if(t.link.ad.providerHref&&t.link.ad.providerHref.href){const e=this.getCMSContentId(t.link.ad.providerHref.href);e?s=yield this.fetchProviderName(e):t.link.ad.sponsorText&&(s=t.link.ad.sponsorText)}else t.link.ad.sponsorText&&(s=t.link.ad.sponsorText);a=s||(null!=t.link.kicker?t.link.kicker:y.e.DefaultProviderName),o={title:t.link.title,url:t.link.href,provider:{name:a},imageUrl:i?Object(f.h)(i,{width:624,height:350,enableDpiScaling:!1}):t.link.image.href,isContent:e,privacyUrl:n}}else if(null!=t.reference&&null!=t.reference.href){const s=this.getCMSContentId(t.reference.href);if(null!=s){const t=yield this.getCMSContent(s);if(!t)continue;o={title:t.title,url:this.constructDestinationUrl(t,i),provider:this.constructProvider(t),imageUrl:this.constructImageUrl(t),isContent:e,privacyUrl:n}}}o&&o.title&&o.imageUrl&&o.url&&s.push(o)}return{id:e._id,items:s}}))}getCMSContent(e){return Object(s.b)(this,void 0,void 0,(function*(){try{const t=new URL(m.b.ContentServiceUrlBase.search,`${m.b.ContentServiceUrlBase}${y.e.CMSContentServiceURl}${e}/`),i=yield fetch(t.toString());if(!i||!i.ok)return void S.a.sendAppErrorEvent(Object(a.a)(o.De,"Get CMSAd content failed","Failed to fetch CMS content, cmsId: "+e));const n=yield i.json();return n||void S.a.sendAppErrorEvent(Object(a.a)(o.De,"Get CMSAd content failed","Invalid JSON response to get CMS content, cmsId: "+e))}catch(t){return void S.a.sendAppErrorEvent(Object(a.a)(o.De,"Get CMSAd content failed",`Error while fetching CMS content ${t}, cmsId: ${e}`))}}))}constructDestinationUrl(e,t){const{category:i}=e,s=i&&i.product||"news",a=i&&i.label||"other",o=n[e.type]||"xx";return`https://www.msn.com/${t}/${b.a.encodeURIComponentForPrime(s||"")}/${b.a.encodeURIComponentForPrime(a||"")}/${b.a.encodeURIComponentForPrime(e.title||"")}/${o}-${e.id}`}constructProvider(e){const{name:t,logo:i}=e.provider;return{name:t,logo:i&&i.id?{src:`${v.a.prod}${i.id}?w=16&h=16`,alt:t}:void 0}}constructImageUrl(e){if(e.images&&!(e.images.length<1)&&e.images[0].id)return Object(f.h)(e.images[0].id,{width:624,height:350,focalRegion:e.images[0].focalRegion,enableDpiScaling:!1})}getCMSContentId(e){return e&&e.indexOf("cms/api/amp")>-1?e.substring(e.lastIndexOf("/")+1):null}fetchProviderName(e){return Object(s.b)(this,void 0,void 0,(function*(){try{const t={method:"GET",headers:{}},i=yield Object(C.a)(()=>Object(s.b)(this,void 0,void 0,(function*(){const i=new URL(`${y.e.CMSListServiceUrl}${e}${m.b.ContentServiceUrlBase.search}`,""+m.b.ContentServiceUrlBase),n=yield fetch(i.toString(),t);if(n.ok)return n.json();S.a.sendAppErrorEvent(Object(a.a)(o.De,"Get CMSAd content failed",`Invalid response from CMS. status: ${n.status}, statusText: ${n.statusText}, url: ${n.url}`))})),"getProviderName");if(!i)return void S.a.sendAppErrorEvent(Object(a.a)(o.De,"Get CMSAd content failed","Invalid response.json(), cmsId: "+e));const n=i;return n?n.displayName:void S.a.sendAppErrorEvent(Object(a.a)(o.De,"Get CMSAd content failed","Failed to parse JSON response, cmsId: "+e))}catch(t){return void S.a.sendAppErrorEvent(Object(a.a)(o.De,"Get CMSAd content failed",`Error while fetching Provider name  ${t}, cmsId: ${e}`))}}))}}var A=i("Bwzq");const w={rating:3,likes:4,price:6,salePrice:7,installmentPrice:500,priceDrop:501,freeShipping:502,viewed:503,sold:504,specialOffer:505,eliteBadge:506,condition:507,localInventory:508,curbsidePickup:509,review:510,discount:600};var I,T=i("hOj1"),R=i("I6Lx"),j=i("zfSW"),x=i("SHdd"),M=i("y+Kz"),D=i("tWvP"),P=i("ypwz"),k=i("s9+9"),E=i("4wjP");!function(e){e.AR="AR",e.GA="GA",e.VI="VI",e.EDGECHRNTP="edgechrntp",e.EDGECHRDHP="edgechrdhp",e.MSNEWS="msnews",e.FirstParty="firstparty",e.VerticalLandingPage="vlp",e.WINVLP="winvlp",e.WINAR="winar",e.WINGA="winga",e.WINVI="winvi",e.WEBCOMPAR="webcompar",e.WEBCOMPGA="webcompga",e.WEBCOMPVI="webcompvi"}(I||(I={}));var F=i("KRKw"),L=i("3Amp"),N=i("hnBi");let W,U=!1;const H=new Promise(e=>{W=e});function B(){return Object(s.b)(this,void 0,void 0,(function*(){switch(yield function(){return Object(s.b)(this,void 0,void 0,(function*(){U||(L.a.cookieConsentStatus.registerObserver(e=>{W()}),U=!0);const e=N.a.getInstance().rootReducer.connector(k.a.SharedState),t=e&&e.getCurrentState(),i=t&&t.cookieConsentStatus;return i!==F.b.Unknown?i:(yield H,e.getCurrentState().cookieConsentStatus)}))}()){case F.b.Required:return!0;case F.b.NotRequired:return!1;default:return}}))}class V{updateMsaOptOutCookie(e){if(!this.getMsaOptoutCookieData()&&e&&e.optout){const t=!0===e.optout.msaOptOut?"1":"0";this.setMsaOptoutCookie(t)}}getMsaOptoutCookieData(){const e=Object(T.a)(y.f.MSAOptOut);return e&&e.length>0?e:null}setMsaOptoutCookie(e){e&&e.length>0&&Object(D.a)(y.f.MSAOptOut,e,1,null,"/")}getBrowserOptoutStatus(){const e=Object(T.a)(y.f.BrowserOptOut);return!(!e||"1"!==e)}setUserOptOutSettings(){const e=this.getBrowserOptoutStatus(),t=this.getMsaOptoutCookieData(),i=!(!t||"1"!==t),n=(e||i).toString().toLowerCase();let s="";e&&(s="b|"),i&&(s+="m");const a=y.b.UserOptOut+":"+n+";"+y.b.UserOptOutOptions+":"+s;if(document.head.attributes["data-info"]){const e=document.head.attributes["data-info"].value.split(";");e.find(e=>e.indexOf(y.b.UserOptOut)>-1)?e.find(e=>e.indexOf(y.b.UserOptOut)>-1)!==y.b.UserOptOut+":"+n&&(document.head.attributes["data-info"].value=document.head.attributes["data-info"].value.replace(y.b.UserOptOut+":false",y.b.UserOptOut+":"+n).replace(y.b.UserOptOut+":true",y.b.UserOptOut+":"+n)):document.head.attributes["data-info"].value=document.head.attributes["data-info"].value+";"+y.b.UserOptOut+":"+n,e.find(e=>e.indexOf(y.b.UserOptOutOptions)>-1)?e.find(e=>e.indexOf(y.b.UserOptOutOptions)>-1)!==y.b.UserOptOutOptions+":"+s&&(e.includes(y.b.UserOptOutOptions+":")?document.head.attributes["data-info"].value=document.head.attributes["data-info"].value.replace(y.b.UserOptOutOptions+":",y.b.UserOptOutOptions+":"+s):e.includes(y.b.UserOptOutOptions+":b|")?document.head.attributes["data-info"].value=document.head.attributes["data-info"].value.replace(y.b.UserOptOutOptions+":b|",y.b.UserOptOutOptions+":"+s):e.includes(y.b.UserOptOutOptions+":b|m")?document.head.attributes["data-info"].value=document.head.attributes["data-info"].value.replace(y.b.UserOptOutOptions+":b|m",y.b.UserOptOutOptions+":"+s):e.includes(y.b.UserOptOutOptions+":m")&&(document.head.attributes["data-info"].value=document.head.attributes["data-info"].value.replace(y.b.UserOptOutOptions+":m",y.b.UserOptOutOptions+":"+s))):document.head.attributes["data-info"].value=document.head.attributes["data-info"].value+";"+y.b.UserOptOutOptions+":"+s}else document.head.setAttribute("data-info",a)}}var _=i("HhTf"),q=i("loKy"),$=i("w0HK"),z=i("C4R5");let G=!0;class Q{constructor(){this.riverNativeAdCount=0,this.reservedRiverNativeAdCount=0,this.dualWideRiverNativeAdCount=0,this.halfRiverNativeAdCount=0,this.beaconService=new g.a,this.cookieService=new V,this.ecasession=y.b.Ecasession;const e=N.a.getInstance().rootReducer;if(m.b.AppType===P.a.EdgeChromium){const t=e.connector(k.a.ChromiumPageSettings);t&&(this.anaheimPageLayout=t.getCurrentState().currentLayout)}const t=e.connector(k.a.SharedState);t&&t.getCurrentState().useHistory?Object(z.a)().addSwitchListener(this.onPivotSwitch.bind(this),q.a.Monetization):Object($.a)().addSwitchListener(this.onPivotSwitch.bind(this),q.a.Monetization)}get sourceUrl(){if(this._sourceUrl)return this._sourceUrl;this._sourceUrl=m.b.HostPage.originalUrl;const e=m.b.CurrentRequestTargetScope.pageType,t=m.b.HostPage.verticalKey;if(e&&t){const i=e.toLowerCase();(i.indexOf(E.b.DHP)>-1||i.indexOf(E.b.NTP)>-1)&&(this._sourceUrl="https://"+m.b.HostPage.hostName+"/"+t+"/"+e)}return this._sourceUrl}get pageType(){if(this._pageType)return this._pageType;const e=m.b.CurrentRequestTargetScope.pageType,t=m.b.CurrentRequestTargetScope.ocid;return this._pageType=e,m.b.AppType===P.a.EdgeChromium?this._pageType=I.EDGECHRNTP:m.b.AppType===P.a.Views&&("article"===e?this._pageType=this.isWindowsViewsPage(t)?I.WINAR:I.WEBCOMPAR:"gallery"===e?this._pageType=this.isWindowsViewsPage(t)?I.WINGA:I.WEBCOMPGA:"video"===e&&(this._pageType=this.isWindowsViewsPage(t)?I.WINVI:I.WEBCOMPVI)),this._pageType}fetchSAMAds(e,t=!1){return Object(s.b)(this,void 0,void 0,(function*(){if(!e||!e.placements||e.placements.length<1)return void S.a.sendAppErrorEvent(Object(a.a)(o.Ge,"Invalid request to fetch native ads","No placements found in the request"));const{anaheimColLayout:i}=e,n=e.pageType||this.pageType;if(!n)return void S.a.sendAppErrorEvent(Object(a.a)(o.Ge,"Invalid request to fetch native ads","No page type found"));const s=this.getImpressionId(),d=this.cookieService.getBrowserOptoutStatus(),l=yield B(),h=this.getMuid(e.adid),u=this.riverNativeAdCount,p=this.reservedRiverNativeAdCount,g=this.dualWideRiverNativeAdCount,f=this.halfRiverNativeAdCount;!l&&t&&(this.ecasession=Object(T.a)(y.f.TaboolaSessionCookieName)||this.ecasession);const b=!(!R.b.ClientSettings||!R.b.ClientSettings.deviceFormFactor||R.b.ClientSettings.deviceFormFactor!==_.a.Phone),v=this.isNotMyFeed(),C={locale:e.locale,rid:s,partnerId:m.b.CurrentRequestTargetScope.pageType,content:{sourceUrl:this.sourceUrl,pageType:n,previousReservedRiverNativeAdCount:p,previousRiverDualWideNativeAdCount:g,previousRiverHalfNativeAdCount:f,previousRiverNativeAdCount:u,verticalName:m.b.HostPage.verticalKey,anaheimPageLayout:this.anaheimPageLayout,anaheimColLayout:i,isXfeed:v,audienceMode:m.b&&m.b.CurrentRequestTargetScope&&m.b.CurrentRequestTargetScope.audienceMode},user:{muid:h,browserOptOut:d,isAdblock:!1},placements:this.getPlacements(e,n),extensions:this.getExtensions(this.lastResponseMetadata,this.ecasession),isCookieWallPresent:l,isPeregrine:!0,device:{isMobile:b}},O=JSON.stringify(C),w=new URL(y.b.SamEndpoint);return new Promise(t=>{try{const i=e.enableAuctionInWebWorker&&G;if(G=!1,i)Object(j.b)({id:x.b.AuctionPrefetch},y.j.Timeout).then(e=>{const i=e.payload;t(i?this.processAdResponse(i):void 0)});else{const e=new XMLHttpRequest;e.open(y.j.Method,w.href,!0),e.withCredentials=!0,e.timeout=y.j.Timeout,e.setRequestHeader(y.j.ContentTypeKey,y.j.ContentType),e.setRequestHeader(y.j.FlightIdKey,R.b.CurrentFlights),e.setRequestHeader(y.j.CacheControlKey,y.j.CacheControl),h&&e.setRequestHeader(y.j.ClientIdKey,h),n===I.GA?e.setRequestHeader(y.j.AuthCookieNameKey,y.f.AnonCookieName):Object(T.a)(y.f.AppAnonCookieExist)&&e.setRequestHeader(y.j.AuthCookieNameKey,M.f),e.onload=()=>{t(this.processAdResponse(e))},e.ontimeout=()=>{S.a.sendAppErrorEvent(Object(a.a)(o.Ie,"Timeout calling SAMRTB Ajax",`pageType: ${n}, status: ${e.status}, StatusText: ${e.statusText}`)),t(void 0)},e.onerror=()=>{S.a.sendAppErrorEvent(Object(a.a)(o.He,"Error calling SAMRTB Ajax",`pageType: ${n}, status: ${e.status}, StatusText: ${e.statusText}`)),t(void 0)},e.send(O)}const s=!0===R.b.IsPrerender?performance.now()-Object(r.j)(c.d):performance.now();Object(r.s)(A.a.TimeToRequestAd,s)}catch(e){return Object(a.c)(e,o.Je,"Failed to get response from SAMRTB call","pageType: "+n),void t(void 0)}})}))}generateSourceUrl(){const e=m.b.CurrentRequestTargetScope.pageType;let t=m.b.HostPage.originalUrl;const i=m.b.HostPage.verticalKey;if(e&&i){const n=e.toLowerCase();(n.indexOf(E.b.DHP)>-1||n.indexOf(E.b.NTP)>-1)&&(t="https://"+m.b.HostPage.hostName+"/"+i+"/"+e)}return t}processAdResponse(e){if(200!==e.status)return 204===e.status?void S.a.sendAppErrorEvent(Object(a.a)(o.Ie,"No content received from SAMRTB Ajax",`Status: ${e.status}, StatusText: ${e.statusText}`)):void S.a.sendAppErrorEvent(Object(a.a)(o.He,"Invalid response from SAMRTB Ajax",`Status: ${e.status}, StatusText: ${e.statusText}`));try{const t=JSON.parse(e.response);if(!t)return void S.a.sendAppErrorEvent(Object(a.a)(o.Ke,"Invalid json response from SAMRTB",`Status: ${e.status}, Invalid json: ${e.response}`));const i=t.metaData;return this.processMetaData(i),this.beaconService.fireRequestLevelBeacons(i.requestLevelBeaconUrls),t}catch(t){return void Object(a.c)(t,o.Je,"Failed to process SAMRTB response",`Status: ${e.status}, json: ${e.response}`)}}getPlacements(e,t){const i=[];return e.placements.forEach(e=>{if(e.region&&e.indices&&e.indices.length){const{indices:n,img:s}=e,a=t==I.EDGECHRNTP&&y.h[e.region]||e.region,o=s?{region:a,indices:n,img:s}:{region:a,indices:n};i.push(o);const r=e.region.toLocaleLowerCase();r===y.b.RiverRegion?this.riverNativeAdCount+=e.indices.length:r===y.b.ReservedRiver?this.reservedRiverNativeAdCount+=e.indices.length:r===y.b.RiverDoubleWide?this.dualWideRiverNativeAdCount+=e.indices.length:r!==y.b.RiverHalf&&r!==y.b.RiverHalfTextOnly||(this.halfRiverNativeAdCount+=e.indices.length)}}),i}processMetaData(e){const t=e&&e.taboola&&e.taboola.sessionId;!this.isCookieWallPresent&&t&&Object(D.a)(y.f.TaboolaSessionCookieName,t,.042,y.f.CookieDomain,"/"),this.lastResponseMetadata=this.mergeMetadata(this.lastResponseMetadata,e),this.cookieService.updateMsaOptOutCookie(e)}mergeMetadata(e,t){return e?t?(t.taboola=this.mergePartnerMetadata(e.taboola,t.taboola),t):e:t}mergePartnerMetadata(e,t){return t=t||{},e&&e.sessionId&&!t.sessionId&&(t.sessionId=e.sessionId),t}getImpressionId(){return this.lastResponseMetadata&&this.lastResponseMetadata.pageViewId?this.lastResponseMetadata.pageViewId:S.a.getRequestId()}clearPreviousInfo(){var e;this.riverNativeAdCount=0,this.reservedRiverNativeAdCount=0,this.dualWideRiverNativeAdCount=0,this.halfRiverNativeAdCount=0,(null===(e=this.lastResponseMetadata)||void 0===e?void 0:e.pageViewId)&&delete this.lastResponseMetadata.pageViewId}getExtensions(e,t){const i={taboola:(e=e||{taboola:{}}).taboola};return i.taboola.sessionId||(i.taboola.sessionId=t),i}getMuid(e){return this.isCookieWallPresent?null:e||Object(T.b)()}onPivotSwitch(e){if(!e.oldSelection)return;const t=e.newSelection.pivotId;t&&t.toLowerCase()!==y.i.EditInterestPivotId&&(this.pivotId=t)}isNotMyFeed(){return!!this.pivotId&&this.pivotId.toLowerCase()!==y.i.MyFeedPivotId&&this.pivotId.toLowerCase()!==y.i.StripeMyFeedPivotId}isWindowsViewsPage(e){return!!e&&("windirect"===(e=e.toLowerCase())||e.startsWith("winp"))}}var K=i("Tc2z"),J=i("hV4J"),X=i("hqLi"),Z=i("SEb4"),Y=i("mEtE"),ee=i("Crvi"),te=i("3noN");function ie(e,t){return t.template.templateType=e,!0}function ne(e,t){return t.template.templateType=ee.a.ZIndex,t.template.flipZIndex=!0,!0}function se(e,t){return ie(ee.a.RiverAnimatedImagery_9by16,t)}function ae(e,t){return ie(ee.a.RiverZIndex_9by16,t)}function oe(e,t){return t&&t.items&&1===t.items.length&&(e===ee.b._1by1?t.template.templateType=ee.a.InfopaneHorizontal_1by1:e===ee.b._4by3?t.template.templateType=ee.a.InfopaneHorizontal_4by3:e===ee.b._3by4?t.template.templateType=ee.a.InfopaneHorizontal_3by4:e===ee.b._9by16&&(t.template.templateType=ee.a.InfopaneHorizontal_9by16)),!0}function re(e,t){return t&&t.items&&1===t.items.length&&(e===ee.b._1by1?t.template.templateType=ee.a.InfopanePatternOverlay_1by1:e===ee.b._4by3&&(t.template.templateType=ee.a.InfopanePatternOverlay_4by3)),!0}function ce(e,t,i){return e[Math.floor(Math.random()*e.length)](t,i)}function de(e,t,i){let n=0;Object(te.a)(e,e=>{n+=e.weight});const s=Math.floor(Math.random()*n);let a=0;for(let n=0;n<e.length;++n)if(a+=e[n].weight,s<a)return e[n].template(t,i),!0;return!1}function le(e,t){return t.template.templateType=ee.a.PatternOverlay,e===ee.b._16by9?t.template.landscapeOverlay=!0:e===ee.b._4by3&&(t.template.landscapeOverlay=!1),!0}const he={riverSingleAdMultiImage:function(e,t){return t.slideshowProps={autoScroll:t.template.slideshowProps.autoScroll,maxImageCount:t.template.slideshowProps.maxImageCount},de([{template:()=>(t.template.templateType=ee.a.Slideshow,t.slideshowProps.autoScrollIntervalMs=t.template.slideshowProps.slideshowScrollInterval,t.slideshowProps.enableSlideshowMediaControls=!0,!0),weight:100-Object(h.a)(t,"template.slideshowProps.psuedoVideoAllocation",80)},{template:()=>(t.template.templateType=ee.a.PseudoVideo,t.slideshowProps.autoScrollIntervalMs=t.template.slideshowProps.psuedoVideoScrollInterval,t.slideshowProps.enableSlideshowMediaControls=!1,!0),weight:Object(h.a)(t,"template.slideshowProps.psuedoVideoAllocation",20)}],e,t)},riverMultiAds:le},ue=[{template:le,weight:1},{template:ne,weight:1}],pe=[{ratio:ee.b._lowerBound,width:1,height:9999},{ratio:ee.b._1by191,width:1,height:1.91},{ratio:ee.b._9by16,width:9,height:16,riverSingleAdSingleImage:function(e,t){return ce([se,ae],e,t)},infoPaneSingleImage:oe},{ratio:ee.b._3by4,width:3,height:4,riverSingleAdSingleImage:function(e,t){return ie(ee.a.RiverZIndex_3by4,t)},infoPaneSingleImage:oe},{ratio:ee.b._1by1,width:1,height:1,riverSingleAdSingleImage:ne,riverSingleAdMultiImage:ne,riverMultiAds:function(e,t){return ie(ee.a.AdCarousel,t)},infoPaneSingleImage:(e,t)=>ce([oe,re],e,t)},{ratio:ee.b._4by3,width:4,height:3,riverSingleAdSingleImage:(e,t)=>de(ue,e,t),riverSingleAdMultiImage:(e,t)=>de(ue,e,t),riverMultiAds:(e,t)=>de(ue,e,t),infoPaneSingleImage:(e,t)=>ce([oe,re],e,t)},Object.assign(Object.assign({ratio:ee.b._16by9,width:16,height:9},he),{riverSingleAdSingleImage:le}),Object.assign({ratio:ee.b._191by1,width:1.91,height:1},he)];function ge(e,t,i,n){const s=i?e.ext.originalImageWidth:e.originalImageWidth,a=i?e.ext.originalImageHeight:e.originalImageHeight,o=1*s/a,r=1*t.width/t.height,c={w:s,h:a};o>=r?c.w=Math.round(a*r):c.h=Math.round(s/r);const d={river:300,infopane:604};return c.w>d[n]&&(c.h=Math.round(c.h*d[n]/c.w),c.w=d[n]),function(e,t,i,n){const s=n?new URL(i.url):new URL(i.imageUrl);s.searchParams.set("h",e),s.searchParams.set("w",t),s.searchParams.set("c","4"),n?i.url=s.href:i.imageUrl=s.href}(c.h,c.w,e,i),c}function me(e){if(!e.items||0===e.items.length||!e.items[0].originalImageHeight||!e.items[0].originalImageWidth||"bing"!==e.providerId||"river"!==e.region&&"infopane"!==e.region)return!1;const t=function(e){const t=Number(e.originalImageHeight),i=Number(e.originalImageWidth);let n=1;for(;n<pe.length&&Math.ceil(i*pe[n].height)!==Math.ceil(t*pe[n].width);++n)if(!(Math.ceil(i*pe[n].height)>Math.ceil(t*pe[n].width))){if(1==n)break;const e=1*i/t;Math.abs(e-pe[n].width/pe[n].height)>=Math.abs(e-pe[n-1].width/pe[n-1].height)&&(n-=1);break}return n==pe.length&&(n-=1),pe[n]}(e.items[0]);let i,n=!1;return"infopane"===e.region?1==e.items.length&&(n=e.items[0].images&&e.items[0].images.length>1?t.infoPaneMultiImage&&t.infoPaneMultiImage(t.ratio,e):t.infoPaneSingleImage&&t.infoPaneSingleImage(t.ratio,e)):"river"===e.region&&(n=e.items.length>1?t.riverMultiAds&&t.riverMultiAds(t.ratio,e):e.items[0].images&&e.items[0].images.length>1?t.riverSingleAdMultiImage&&t.riverSingleAdMultiImage(t.ratio,e):t.riverSingleAdSingleImage&&t.riverSingleAdSingleImage(t.ratio,e)),n&&(e.items.forEach(n=>{const s=ge(n,t,!1,e.region);i||(i=s),n.images&&Object(te.a)(n.images,i=>{i.ext&&i.ext.originalImageWidth&&i.ext.originalImageHeight&&ge(i,t,!0,e.region)})}),e.template.desiredHeight=i.h.toString(),e.template.desiredWidth=i.w.toString(),e.template.desiredRatio=t.ratio),n}class fe{}fe.concat=(e,t)=>`${e}.${t}`,fe.identity=e=>t=>fe.concat(e,t),fe.boolean=e=>t=>t?fe.concat(e,"1"):null;class be{constructor(){this._availableAssets="",this._displayedAssets=""}get availableAssets(){return this._availableAssets}get displayedAssets(){return this._displayedAssets}setAvailableAssets(e){e.items&&e.items[0]&&e.items[0].assets&&(this._availableAssets=Object(K.a)(Object.keys(e.items[0].assets),e=>w[e]).join("_"))}setDisplayedAssets(e){e.items&&e.items[0]&&e.items[0].assets&&(this._displayedAssets=Object(K.a)(Object.keys(e.items[0].assets),e=>w[e]).join("_"))}}const ve={templateType:fe.identity("type"),animatedImage:fe.identity("ani"),flipZIndex:fe.boolean("fz"),landscapeOverlay:fe.boolean("lo")};class ye{updateTemplate(e,t={}){if(!e||"resriver"===e.region||"resinfopane"===e.region)return;this.decorationBeaconBuilder=new be,this.decorationBeaconBuilder.setAvailableAssets(e);const i=Object(J.a)({},t,ee.c);let n=!1;t.templateSelection&&e.items&&e.items[0].originalImageHeight&&e.items[0].originalImageWidth&&(e.template=i,n=me(e)),n||(e.template=this.processConfig(e,i)),this.resetTempateTypeForInfopaneInMultiAds(e),this.filterAssetByFlight(e),this.updatePlacementImageSize(e),this.updateBeacon(e)}processConfig(e,t){const i=t;if(this.updateAllowedAssetsForInfopane(e,i),"river"!==e.region&&(i.templateType=ee.a.Default),this.updateSlideshowTemplateType(e,t,i),i.templateType===ee.a.PatternOverlay)if(this.isProductItem(e)){const t=this.getItemImageSize(e).height;"174"===t?i.landscapeOverlay=!0:"225"===t?i.landscapeOverlay=!1:i.templateType=ee.a.Default}else i.templateType=ee.a.Default;return i.templateType===ee.a.Default&&e.items&&e.items.length>3&&i.adCarousel&&(i.templateType=ee.a.AdCarousel),this.updateTemplateTypeForBrandStory(e,i),i}updatePlacementImageSize(e){if(e.template.templateType===ee.a.PatternOverlay){const t=this.getItemImageSize(e);e.imageWidth=Object(h.a)(e,"imageWidth",t.width),e.imageHeight=Object(h.a)(e,"imageHeight",t.height)}}updateBeacon(e){if(!Object(X.a)(e.beaconsJson)){const t=JSON.parse(e.beaconsJson);if(t&&Object(Z.a)(t.trb)){let i=!1;t.trb=t.trb.map(t=>{if(t.includes("srtb.msn.com")){i=!0;const n=new URL(t);return b.a.appendSearchParam(n,"t",this.serializeTemplateConfig(e)),this.decorationBeaconBuilder.setDisplayedAssets(e),this.decorationBeaconBuilder.availableAssets&&b.a.appendSearchParam(n,"dec",this.decorationBeaconBuilder.availableAssets+"-"+this.decorationBeaconBuilder.displayedAssets),n.href}return t}),i&&(e.beaconsJson=JSON.stringify(t))}}}serializeTemplateConfig(e){return Object(l.a)(ve,(t,i,n)=>{const s=Object(h.a)(e.template,n);if(s){const e=i(s);if(e)return""===t?e:`${t}_${e}`}return t},"")}updateSlideshowTemplateType(e,t,i){e&&e.items&&e.items[0]&&e.items[0].images&&e.items[0].images.length>1&&(i.templateType=this.SlideshowTemplateType||this.getSlideshowTemplateType(t,i),e.slideshowProps=i.slideshowProps)}getSlideshowTemplateType(e,t){if(this.SlideshowTemplateType=ee.a.Default,e&&e.slideshowProps&&t.slideshowProps){const i=Math.floor(100*Math.random());e.slideshowProps.psuedoVideoAllocation&&e.slideshowProps.psuedoVideoAllocation>i?(this.SlideshowTemplateType=ee.a.PseudoVideo,t.slideshowProps.autoScrollIntervalMs=e.slideshowProps.psuedoVideoScrollInterval,t.slideshowProps.enableSlideshowMediaControls=!1):(this.SlideshowTemplateType=ee.a.Slideshow,t.slideshowProps.autoScrollIntervalMs=e.slideshowProps.slideshowScrollInterval,t.slideshowProps.enableSlideshowMediaControls=!0)}return this.SlideshowTemplateType}getItemImageSize(e){const t=Object(Y.a)(e.items);return Object(X.a)(t)?{}:{width:""+Object(h.a)(t,"imageWidth"),height:""+Object(h.a)(t,"imageHeight")}}isProductItem(e){const t=Object(Y.a)(e.items);return!Object(X.a)(t.assets)}calculateDiscount(e){const t=e.price,i=e.salePrice;if(t&&i){const n=Number(t.replace(/[^0-9.-]+/g,"")),s=Number(i.replace(/[^0-9.-]+/g,""));e.discount=Math.floor((n-s)/n*100)}}filterAssetByFlight(e){if(e&&e.items&&e.items[0]&&e.items[0].assets){this.calculateDiscount(e.items[0].assets);const t=Object(l.a)(e.items[0].assets,(t,i,n)=>{var s;return Object(Z.a)(null===(s=e.template)||void 0===s?void 0:s.allowedAssets)&&e.template.allowedAssets.includes(w[n])&&(t[n]=i),t},{});e.items[0].assets=t}}resetTempateTypeForInfopaneInMultiAds(e){"infopane"===e.region&&e.items&&e.items.length>1&&(e.template.templateType=ee.a.Default,e.template.animatedImage="")}isValidProviderNameForBrand(e){if(!(e&&e.items&&e.items[0]&&e.items[0].providerName))return!1;const t=e.items[0].providerName;return-1===t.indexOf("/")&&t.length<20}updateAllowedAssetsForInfopane(e,t){t.templateType!==ee.a.BrandStory&&t.templateType!==ee.a.BrandStoryNoDeco&&t.templateType!==ee.a.HotspotSingle||"infopane"===e.region&&(t.allowedAssets=[])}updateTemplateTypeForBrandStory(e,t){t.templateType!==ee.a.BrandStory&&t.templateType!==ee.a.BrandStoryNoDeco||this.isValidProviderNameForBrand(e)||(t.templateType=ee.a.Default,t.allowedAssets=[])}}var Ce=i("b169");const Se=()=>{var e;const t=performance.getEntriesByName&&(null===(e=performance.getEntriesByName(y.b.SamEndpoint)[0])||void 0===e?void 0:e.duration);t?Object(r.s)(A.a.ApiDuration,t):Object(j.b)({id:x.b.AuctionAPIDuration}).then(({payload:e})=>{e&&Object(r.s)(A.a.ApiDuration,e)})};class Oe{constructor(){this.beaconService=new g.a,this.cmsService=new O,this.samService=new Q,this.templateService=new ye,this.cmsNativeAdsItemsMap=new Map,this.cmsRetryCount=0,this.backfillIndex=0,this.cmsAdsCounter=0,this.callbackFnPlacementList=[],this.callbackList=[]}resetNativeAdService(){this.backfillIndex=0,this.cmsAdsCounter=0,this.callbackFnPlacementList.length=0,this.callbackList.length=0,this.samService.clearPreviousInfo()}fetchNativeAds(e){return Object(s.b)(this,void 0,void 0,(function*(){if(!e||!e.placements||0===e.placements.length)return void S.a.sendAppErrorEvent(Object(a.a)(o.Ee,"Fetch NativeAd failed","No placements found in the request"));if(e.locale||(e.locale=R.b.Locale),!e.locale)return void S.a.sendAppErrorEvent(Object(a.a)(o.Ee,"Fetch NativeAd failed",`No locale found, headData.Locale: ${R.b.Locale}, adRequest.locale: ${e.locale}`));const t=this.samService.fetchSAMAds(e),i=e.locale,n=y.c[i];if(!this.cmsItems){const e=yield this.cmsService.getCMSList(n,i);e&&(this.cmsItems=e.items)}const s=this.buildAdResponse(e),r=yield t;return this.updateAdResponse(s,this.cmsItems,n,r),s}))}updateAdResponse(e,t,i,n){const s=!t||0==t.length,d=!n||!n.placements||0==n.placements.length;if(s&&d)return void S.a.sendAppErrorEvent(Object(a.a)(o.Fe,"Fetch NativeAd failed",`Unable to retrieve backfill list id: ${i} and SAM response`));s&&S.a.sendAppErrorEvent(Object(a.a)(o.Fe,"Unable to retrieve backfill list","Backfill list id: "+i));const l=this.mapSAMPlacements(n);return e.pageViewId=n&&n.metaData&&n.metaData.pageViewId,e.placements.forEach(e=>{const i=e.region+e.regionIndex,n=l.get(i);if(n&&n.items&&n.items.length>0){n.items.forEach(t=>{const i={title:t.title,destinationUrl:t.url,imageUrl:t.imageUrl,providerName:t.sourceName,adChoiceIconUrl:t.adChoicesUrl,imageHeight:t.imageHeight,imageWidth:t.imageWidth,clickBeacons:t.clickBeacons,uniqueId:t.uniqueId,feedbackUrl:Object(p.a)(t.clickBeacons),verificationParameters:t.verificationParameters};e.items.push(i)}),e.privacyUrl=n.privacyUrl,e.adServedUrls=n.adServedUrls,e.jsTrackerUrls=n.jsTrackerUrls,e.visibilityUrls=n.visibilityUrls,e.beaconsJson=n.beaconsJson,e.bingTrackerUrls=n.bingTrackerUrls,e.geminiViewabilityDataJson=n.geminiViewabilityDataJson,this.beaconService.fireAdServedTrackingCall(n.beaconsJson);const t=!0===R.b.IsPrerender?performance.now()-Object(r.j)(c.d):performance.now();Object(r.s)(A.a.TimeToServeAd,t),Se()}else if(s)S.a.sendAppErrorEvent(Object(a.a)(o.E,"Unable to backfill invalid sam placement","Placement key: "+i));else{const i=this.backfillIndex++%t.length,n=t[i],s={title:n.title,destinationUrl:n.url,imageUrl:this.updateImageUrl(e,n.imageUrl),providerName:n.provider?n.provider.name:""};e.items.push(s),e.privacyUrl=n.privacyUrl}}),e}fetchSamAds(e,t=!1,i){return Object(s.b)(this,void 0,void 0,(function*(){if(!e||!e.placements||0===e.placements.length)return void S.a.sendAppErrorEvent(Object(a.a)(o.Ee,"Fetch NativeAd failed","No placements found in the request"));if(e.locale||(e.locale=R.b.Locale),!e.locale)return void S.a.sendAppErrorEvent(Object(a.a)(o.Ee,"Fetch NativeAd failed",`No locale found, headData.Locale: ${R.b.Locale}, adRequest.locale: ${e.locale}`));i&&i.length>0&&this.callbackList.push(...i),this.locale=e.locale;const n=this.samService.fetchSAMAds(e,t);return{placeHolderResponse:this.buildAdResponse(e),samResponse:yield n}}))}fetchCmsAds(e,t,i){return Object(s.b)(this,void 0,void 0,(function*(){if(!e||!e.placements||0===e.placements.length)return void S.a.sendAppErrorEvent(Object(a.a)(o.Ee,"Fetch NativeAd failed","No placements found in the request"));const n=R.b.Locale;if(!this.cmsNativeAdsItemsMap.has(t)){const e=yield this.cmsService.getCMSList(t,n);e&&e.id&&e.items&&this.cmsNativeAdsItemsMap.set(t,e.items)}const s=this.buildAdResponse(e),r=this.cmsNativeAdsItemsMap.has(t)?this.cmsNativeAdsItemsMap.get(t):[];for(const e of s.placements){const t=i.shift();let s,a;if(t){let e=parseInt(t,10);if(e)e=Math.max(e-1,0),e=e<r.length?e:e%r.length,s=r[e];else{if(!this.cmsNativeAdsItemsMap.has(t)){const e=yield this.cmsService.getCMSList(t,n);e&&e.id&&e.items&&this.cmsNativeAdsItemsMap.set(t,e.items)}const e=this.cmsNativeAdsItemsMap.has(t)?this.cmsNativeAdsItemsMap.get(t):[];s=Object(d.a)(e)[0],s||(s=r[this.cmsAdsCounter%r.length])}}else s=r[this.cmsAdsCounter%r.length];s&&(a={title:s.title,destinationUrl:s.url,imageUrl:this.updateImageUrl(e,s.imageUrl),providerName:s.provider?s.provider.name:""},e.items.push(a),e.privacyUrl=s.privacyUrl),this.cmsAdsCounter++}return s}))}updateSamAdResponse(e,t,i){const n=this.cmsItems,s=this.mapSAMPlacements(t),a=!n||0==n.length;return e.pageViewId=t&&t.metaData&&t.metaData.pageViewId,e.placements.forEach(e=>{const t=e.region+e.regionIndex,o=s.get(t);if(o&&o.items&&o.items.length>0){o.items.forEach(t=>{const i={title:t.title,description:t.description,destinationUrl:t.url,providerName:t.sourceName,adChoiceIconUrl:t.adChoicesUrl,imageUrl:t.imageUrl,imageHeight:t.imageHeight,imageWidth:t.imageWidth,images:t.images,clickBeacons:t.clickBeacons,uniqueId:t.uniqueId,beaconsJson:t.beaconsJson,feedbackUrl:Object(p.a)(t.clickBeacons),originalImageWidth:t.originalImageWidth,originalImageHeight:t.originalImageHeight,verificationParameters:t.verificationParameters};this.updateAssetVideoField(i,t.assets),this.updateAssetDataFields(i,t.assets),e.items.push(i)});const t=Object(Ce.a)(e,0);e.videoViewabilityData=t?t.ViewabilityProps:null,e.privacyUrl=o.privacyUrl,e.adServedUrls=o.adServedUrls,e.jsTrackerUrls=o.jsTrackerUrls,e.visibilityUrls=o.visibilityUrls,e.beaconsJson=o.beaconsJson,e.bingTrackerUrls=o.bingTrackerUrls,e.geminiViewabilityDataJson=o.geminiViewabilityDataJson,e.providerId=o.providerId;const n=!0===R.b.IsPrerender?performance.now()-Object(r.j)(c.d):performance.now();Object(r.s)(A.a.TimeToServeAd,n),Se(),this.templateService.updateTemplate(e,i)}else if(a)this.handleCmsStandyPlacement(e);else{const t=this.backfillIndex++%n.length,i=n[t],s={title:i.title,destinationUrl:i.url,imageUrl:this.updateImageUrl(e,i.imageUrl),providerName:i.provider?i.provider.name:""};e.items.push(s),e.privacyUrl=i.privacyUrl,e.isBackfill=!0}}),e}handleCmsStandyPlacement(e){if(this.cmsItems){const t=this.cmsItems;for(const i of this.callbackFnPlacementList){const n=t[this.backfillIndex++%t.length],s={title:n.title,destinationUrl:n.url,imageUrl:this.updateImageUrl(e,n.imageUrl),providerName:n.provider?n.provider.name:""};i.items.push(s),i.privacyUrl=n.privacyUrl,i.isBackfill=!0}this.callbackList.forEach(e=>{e(this)}),this.callbackList=[],this.callbackFnPlacementList=[]}else e&&this.callbackFnPlacementList.push(e)}loadCmsBackFillList(){const e=this.locale?this.locale:R.b.Locale,t=y.c[e];t&&!this.cmsItems&&this.cmsService.getCMSList(t,e).then(e=>{e?(this.cmsItems=e.items,this.handleCmsStandyPlacement()):++this.cmsRetryCount<10&&this.loadCmsBackFillList()})}mapSAMPlacements(e){const t=new Map;return e&&e.placements&&e.placements.forEach(e=>{e.region&&e.index&&t.set(e.region+e.index,e)}),t}buildAdResponse(e){const t=[];e.placements.forEach(e=>{e.region&&e.indices&&e.indices.length&&e.indices.forEach(i=>{const n={region:e.region,regionIndex:i,imageHeight:e.img&&e.img.h&&e.img.h.toString(),imageWidth:e.img&&e.img.w&&e.img.w.toString(),items:[]};t.push(n)})});return{placements:t,adLabelText:Object(p.b)(e.locale),isGreyAdsLabelEnabled:y.g.includes(e.locale),privacyUrl:y.b.PrivacyUrl}}updateImageUrl(e,t){return e&&e.imageWidth&&e.imageHeight&&t?t.replace("w=624","w="+e.imageWidth).replace("h=350","h="+e.imageHeight):t}updateAssetDataFields(e,t){const i=Object(l.a)(t,(e,t)=>{const i=Object(h.a)(t,"data.type"),n=Object(u.a)(w,e=>e===i);return n&&(e[n]=Object(h.a)(t,"data.value")),e},{});e.assets=i}updateAssetVideoField(e,t){t&&t.length>0&&t.forEach(t=>{const i=Object(h.a)(t,"video.vasttag");i&&(e.video=i)})}getAdTagStyleByLocale(e){const t=null!=e?e:R.b.Locale;return{adLabelText:Object(p.b)(t),isGreyAdsLabelEnabled:y.g.includes(t)}}}let Ae;function we(){return Ae||(Ae=new Oe),Ae.resetNativeAdService(),Ae}},eupA:function(e,t,i){"use strict";var n=i("JFdr");t.a=function(e,t){var i=-1,s=e.length,a=s-1;for(t=void 0===t?s:t;++i<t;){var o=Object(n.a)(i,a),r=e[o];e[o]=e[i],e[i]=r}return e.length=t,e}},hV4J:function(e,t,i){"use strict";var n=i("2JSu"),s=i("HVAe"),a=i("p6Gq"),o=i("MyC+"),r=Object.prototype,c=r.hasOwnProperty,d=Object(n.a)((function(e,t){e=Object(e);var i=-1,n=t.length,d=n>2?t[2]:void 0;for(d&&Object(a.a)(t[0],t[1],d)&&(n=1);++i<n;)for(var l=t[i],h=Object(o.a)(l),u=-1,p=h.length;++u<p;){var g=h[u],m=e[g];(void 0===m||Object(s.a)(m,r[g])&&!c.call(e,g))&&(e[g]=l[g])}return e}));t.a=d},hme2:function(e,t,i){"use strict";i.d(t,"a",(function(){return C}));var n=i("D57K"),s=i("OkDC"),a=i("tMmC"),o=i("HxRh"),r=i("ypwz"),c=i("tERu"),d=i("rvYQ"),l=i("msIb"),h=i("6ADy"),u=i("/+Un"),p=i("KETb");class g{constructor(e){this.fetchImpl=e,this.actionsEndpoint="./Graph/Actions",this.defaultOcid="Peregrine"}sendPostActionRequest(e,t=this.defaultOcid,i=!0){return Object(n.b)(this,void 0,void 0,(function*(){const s=JSON.stringify(e),a={method:"POST",body:s,headers:yield l.a.getOneServiceHeaders()};(yield Object(u.e)())&&(a.credentials="include");const o=Object(h.d)(this.actionsEndpoint);(yield l.a.getCommonParams2(t,i)).forEach(e=>e.value&&o.searchParams.set(e.key,e.value));return yield Object(p.a)(()=>Object(n.b)(this,void 0,void 0,(function*(){const e=yield this.fetchImpl(o.href,a);if(e.status>=400){const t=`OneService returned error response. Status: ${e.status} for Post request: ${o.href} with params ${JSON.stringify(a)}`;throw new Error(t)}return e})),"postAction"+s)}))}sendDeleteActionRequest(e,t=this.defaultOcid,i=!0){return Object(n.b)(this,void 0,void 0,(function*(){const s=yield l.a.getBaseRequestData("DELETE");(yield Object(u.e)())&&(s.credentials="include");let a="";const o=Object.keys(e),r=o.length;for(let t=0;t<r;t++)a+=`${o[t]} eq '${e[o[t]]}'`,t!=r-1&&r>1&&(a+=" and ");const c={key:"$filter",value:a},d=Object(h.d)(this.actionsEndpoint);[c,...yield l.a.getCommonParams2(t,i)].forEach(e=>e.value&&d.searchParams.set(e.key,e.value));return yield Object(p.a)(()=>Object(n.b)(this,void 0,void 0,(function*(){const e=yield this.fetchImpl(d.href,s);if(e.status>=400){const t=`OneService returned error response. Status: ${e.status} for Delete request: ${d.href} with params: ${JSON.stringify(s)}`;throw new Error(t)}return e})),"deleteAction"+a)}))}}var m=i("u5KZ"),f=i("ac9z"),b=i("HDSB");class v extends class{constructor(e){this.fetchImpl=e,this.ocid="feeds",this.freServiceEndpoint="news/fre",this.userEndpoint="./msn/user",this.addPageInfoToOcid=!0,this.actionsClient=new g(e),d.b.AppType!==r.a.NewsAndInterests&&d.b.AppType!==r.a.WindowsNewsPlus||(this.addPageInfoToOcid=!1,this.ocid="winp2")}getFreArtifacts(){return Object(n.b)(this,void 0,void 0,(function*(){const e=Object(h.d)(this.freServiceEndpoint);e.searchParams.set("bypass_trigger","true");return[...(yield Object(u.d)())===c.c.SignedIn?l.a.getOneServiceParamsWithAuth(Object(d.c)().UserId,this.ocid,this.addPageInfoToOcid):l.a.getOneServiceParamsWithoutAuth(Object(d.c)().UserId,this.ocid,this.addPageInfoToOcid),{key:f.a,value:Date.now().toString()}].forEach(t=>{t.value&&e.searchParams.set(t.key,t.value)}),this.getFreArtifactsWithUrl(e.href)}))}getFreArtifactsWithUrl(e){return Object(n.b)(this,void 0,void 0,(function*(){if(!e||"-1"===e)return null;const t={method:s.d.Get,credentials:"include",headers:yield l.a.getOneServiceHeaders()};try{const i=yield Object(p.a)(()=>Object(n.b)(this,void 0,void 0,(function*(){return yield this.fetchImpl(e,t)})),"getFreArtifacts");if(!i.ok)throw Error("[FreServiceClient.getFreArtifacts] Failed with response: "+JSON.stringify(i));const s=i.headers&&i.headers.get("ddd-tmpl");return m.a.addOrUpdateTmplString(s),i.json()}catch(e){throw a.a.logError(e.message),e}}))}setFreArtifactForUser(e,t){return Object(n.b)(this,void 0,void 0,(function*(){if(e&&t){const i={method:t,credentials:"include",headers:yield l.a.getOneServiceHeaders()};Object(h.d)(this.freServiceEndpoint);let s=0;try{if(s=(yield Object(p.a)(()=>Object(n.b)(this,void 0,void 0,(function*(){return yield this.fetchImpl(e,i)})),"setFreArtifact")).status,s>=400){const e=`OneService returned error response. Status: ${s} for done action`;throw new Error(e)}}catch(e){return a.a.logError(e.message),s}return s}return m.a.sendAppErrorEvent(Object.assign(Object.assign({},o.Oh),{message:`Any of the required parameters was not properly set by the caller. callbackUrl: ${e} method: ${t}.`})),0}))}updateArtifactInActionsEndpoint(e,t){return Object(n.b)(this,void 0,void 0,(function*(){let i;s.a[e.type]&&(i=Object.assign({},s.a[e.type])),i.targetId=e.id;try{t?yield this.actionsClient.sendPostActionRequest(i,this.ocid,this.addPageInfoToOcid):yield this.actionsClient.sendDeleteActionRequest(i,this.ocid,this.addPageInfoToOcid),Object(f.d)()}catch(i){m.a.sendAppErrorEvent(Object.assign(Object.assign({},o.xe),{message:"Fre Actions call failed",pb:Object.assign(Object.assign({},o.xe.pb),{customMessage:`artifact: ${JSON.stringify(e)} following: ${t} error message: ${i}`})}))}}))}setDoneFreState(){return Object(n.b)(this,void 0,void 0,(function*(){yield this.setFreState(JSON.stringify({stage:s.b}),o.dc)}))}setMaybeLaterFreState(){return Object(n.b)(this,void 0,void 0,(function*(){yield this.setFreState(JSON.stringify({dismiss_timestamp:new Date(Date.now()).toJSON()}),o.ze)}))}setFreState(e,t){return Object(n.b)(this,void 0,void 0,(function*(){const i={method:"POST",body:JSON.stringify({freMultiStepState:e}),headers:yield l.a.getOneServiceHeaders()};(yield Object(u.d)())===c.c.SignedIn&&(i.credentials="include");const s=Object(h.d)(this.userEndpoint);(yield l.a.getCommonParams2(this.ocid,this.addPageInfoToOcid)).forEach(e=>e.value&&s.searchParams.set(e.key,e.value));try{yield Object(p.a)(()=>Object(n.b)(this,void 0,void 0,(function*(){const e=yield this.fetchImpl(s.href,i);if(e.status>=400){const t=`OneService returned error response. Status: ${e.status} for call to set user state`;throw new Error(t)}return e.json()})),"sendFreDoneAction")}catch(i){m.a.sendAppErrorEvent(Object.assign(Object.assign({},t),{message:"Service call to set fre state failed",pb:Object.assign(Object.assign({},t.pb),{customMessage:`state: ${e} error: ${i}`})}))}}))}}{constructor(e){let t;t=e||(Object(b.a)()?window.fetch.bind(window):fetch),super(t)}}let y;const C=e=>y||(y=new v(e),y)},iCsu:function(e,t,i){"use strict";i.r(t),i.d(t,"DesktopFeedEdgeNext",(function(){return dt})),i.d(t,"DesktopFeedEdgeNextActions",(function(){return W})),i.d(t,"DesktopFeedEdgeNextConnector",(function(){return Ye})),i.d(t,"DesktopFeedEdgeNextReducer",(function(){return tt})),i.d(t,"ToolingInfo",(function(){return lt}));var n=i("+viU"),s=i("8+qV"),a=i("OOuA"),o=i("Nt9a"),r=i("VFke"),c=i("5mwN"),d=i("Jw3B"),l=i("plCa"),h=i("wXkv"),u=i("LelC"),p=i("Zn5T"),g=i("K1Uj"),m=i("f/Yt"),f=i("0fst"),b=i("0dho"),v=i("LJMo"),y=i("rFwl"),C=i("OnwC"),S=i("HFPz");S.a;class O extends C.a{constructor(e){super(e),this.handledProps={addCloseButton:void 0,closeButtonAriaLabel:void 0,closeButtonTelemetryTag:void 0,hidden:void 0,managedClasses:void 0,sourceLink:void 0,videoEmbedPlayerHeight:void 0,videoEmbedPlayerTelemetryTag:void 0,videoEmbedPlayerWidth:void 0}}render(){const{addCloseButton:e,closeButtonTelemetryTag:t,closeButtonAriaLabel:i,hidden:n,videoEmbedPlayerHeight:s,videoEmbedPlayerWidth:o,sourceLink:r}=this.props;return Object(a.a)(S.a,{hidden:n,addCloseButton:e,sourceLink:r,props:{closeButtonAriaLabel:i,closeButtonTelemetryTag:t,videoEmbedPlayerHeight:s,videoEmbedPlayerWidth:o}})}}var A=i("rRWH");let w=!0;const I=Object(n.a)(e=>(w="left"===Object(A.b)("left","right",e.direction),{}))(O);var T=i("mXQk"),R=i("ERkP"),j=i.n(R),x=i("7nmT"),M=i.n(x),D=i("o1qX"),P=i("+djJ"),k=i("jrUk"),E=i("u5KZ"),F=i("JnE6");class L extends c.a{constructor(e){super(e),this.handledProps=Object.assign(Object.assign({},c.b),{actionsMenuOpen:void 0,actionsMenuProps:void 0,bingVideoCardData:void 0,closeColdStartExperience:void 0,closeSDCardActionsMenu:void 0,coldStartConfigInfoFre:void 0,coldStartFreResponse:void 0,consumeVerticalTab:void 0,customField:void 0,designSystemOverrides:void 0,enableScrollDownTopSiteInf:void 0,enableWillChange:void 0,experienceName:void 0,fixedCardHeight:void 0,hasRightRail:void 0,isVerticalTabEnabled:void 0,layoutGap:void 0,horizontalTabLayoutGap:void 0,managedClasses:void 0,moneyCardData:void 0,onMount:void 0,onUnmount:void 0,onUserPaginate:void 0,reverseLayoutGap:void 0,riverSectionFeedLayoutData:void 0,riverSectionTelemetryObject:void 0,toast:void 0,zoomRatio:void 0,enableOneColumn:void 0}),this.handleClick=e=>{this.props.actionsMenuProps&&this.props.actionsMenuProps.referrerButton&&!this.props.actionsMenuProps.referrerButton.contains(e.path[0])&&this.actionsMenuEl&&!this.actionsMenuEl.contains(e.path[0])&&this.props.closeSDCardActionsMenu()},this.handleKeyDown=e=>{this.props.actionsMenuProps&&this.props.actionsMenuProps.referrerButton&&!this.props.actionsMenuProps.referrerButton.contains(e.path[0])&&this.actionsMenuEl&&!this.actionsMenuEl.contains(e.path[0])&&this.props.closeSDCardActionsMenu()},this.renderSDCardActionMenu=()=>{const{actionsMenuOpen:e,actionsMenuProps:t}=this.props;return e&&t?M.a.createPortal(Object(a.a)(y.a,Object.assign({},t,{overrideStyles:{zIndex:""+f.a.Above},ref:e=>this.actionsMenuEl=M.a.findDOMNode(e)})),document.getElementById("edge-chromium-page-root")):null},this.onBreakpointChange=e=>{this.setState({columnArrangement:this.props.hasRightRail?this.updateColumnArrangementForRightRail(e):e})},this.onSentinelChange=e=>{if(!e||e.length<1)return;(e[1]||e[0]).isIntersecting?(this.sentinelInView=!0,this.props.onUserPaginate()):this.sentinelInView=!1},this.onMoneyCardAddSymbolClick=()=>{this.props.moneyCardData.setMoneyCardData({cardType:g.b.AddWatchlist,lastCardType:this.props.moneyCardData.cardType,optionSwitch:!1,showSuggestions:!1,noSuggestion:!1,searchSuggestions:[]})},this.onMoneyCardActionInputText=e=>{const t=e.detail;this.props.moneyCardData.handleQuoteSearch(t)},this.onMoneyCardTitleClick=()=>{this.props.moneyCardData.cardType===g.b.AddWatchlist&&this.props.moneyCardData.setMoneyCardData({cardType:this.props.moneyCardData.lastCardType,lastCardType:this.props.moneyCardData.cardType,showSuggestions:!1,noSuggestion:!1,searchSuggestions:[]})},this.addToWatchlist=e=>{const t=e.detail;this.props.moneyCardData.addToWatchlist(t)},this.getColumnArrangementForFeed=e=>{const t=this.state.columnArrangement;switch(t){case d.a.c1:return this.props.enableOneColumn?t.toUpperCase():d.a.c2.toUpperCase();case d.a.c5:return b.a.fiveColSupported()&&e.C5&&e.C5.length>0?d.a.c5.toUpperCase():d.a.c4.toUpperCase();default:return t.toUpperCase()}},this.updateColumnArrangementForRightRail=e=>{switch(e){case d.a.c5:return d.a.c4;case d.a.c4:return d.a.c3;case d.a.c3:return d.a.c2;case d.a.c2:return d.a.c1;default:return e}},this.ttvrFirstSectionFired=!1;const t=Object(l.a)().currentColumnArrangement;this.state={columnArrangement:this.props.hasRightRail?this.updateColumnArrangementForRightRail(t):t},this.desktopFeedEdgeNextContainerRef=j.a.createRef()}scrollToHideTopSites(){const e=document.documentElement?document.documentElement:document.body;if(e){const t=e=>{e&&(E.a.scheduleContentViewEvent(F.b.AutoScroll),e.preventDefaultScroll=!0),document.removeEventListener("scroll",t)};document.addEventListener("scroll",t),e.scrollTop=54}}componentDidMount(){super.componentDidMount(),this.props.enableScrollDownTopSiteInf&&this.scrollToHideTopSites(),!this.ttvrFirstSectionFired&&this.props.riverSectionFeedLayoutData&&this.props.riverSectionFeedLayoutData.length>0&&(Object(P.n)(h.a.riverFirstSection),this.ttvrFirstSectionFired=!0),Object(l.a)().subscribe(this.onBreakpointChange),"IntersectionObserver"in window&&(this.sentinelObserver=new IntersectionObserver(this.onSentinelChange,{threshold:[0,1]}),requestAnimationFrame(()=>{this.sentinelObserver.observe(document.querySelector("#pagination"))})),this.checkPaginationListeners(),this.props.bingVideoCardData&&"Overlay"===this.props.bingVideoCardData.navigateDestination&&this.renderBingOverlayPlayer(),document.addEventListener("action-add-symbol",this.onMoneyCardAddSymbolClick),document.addEventListener("action-text-input",this.onMoneyCardActionInputText),document.addEventListener("action-title-clicked",this.onMoneyCardTitleClick),document.addEventListener("action-add-to-watchlist",this.addToWatchlist),document.addEventListener("mousedown",this.handleClick),document.addEventListener("keydown",this.handleKeyDown),this.props.onMount&&this.props.onMount(),this.props.closeColdStartExperience&&this.coldStartContainerElement&&(this.coldStartContainerElement.addEventListener(T.a,this.props.closeColdStartExperience),this.coldStartContainerElement.addEventListener(T.b,this.props.closeColdStartExperience))}componentDidUpdate(){super.componentDidUpdate(),!this.ttvrFirstSectionFired&&this.props.riverSectionFeedLayoutData&&this.props.riverSectionFeedLayoutData.length>0&&(Object(P.n)(h.a.riverFirstSection),this.ttvrFirstSectionFired=!0),this.checkPaginationListeners()}componentWillUnmount(){Object(l.a)().unsubscribe(this.onBreakpointChange),this.sentinelObserver&&this.sentinelObserver.unobserve(document.querySelector("#pagination")),this.removeBingOverlayPlayer(),document.removeEventListener("action-add-symbol",this.onMoneyCardAddSymbolClick),document.removeEventListener("action-text-input",this.onMoneyCardActionInputText),document.removeEventListener("action-title-clicked",this.onMoneyCardTitleClick),document.removeEventListener("action-add-to-watchlist",this.addToWatchlist),document.removeEventListener("mousedown",this.handleClick),document.removeEventListener("keydown",this.handleKeyDown),this.props.onUnmount&&this.props.onUnmount(),this.coldStartContainerElement&&this.coldStartContainerElement.removeEventListener(T.a,this.props.closeColdStartExperience),this.coldStartContainerElement&&this.coldStartContainerElement.removeEventListener(T.b,this.props.closeColdStartExperience)}render(){const e=this.getGap(),t=Object(D.a)(this.props.managedClasses.desktopFeedEdgeNext_root,[this.props.managedClasses.desktopFeedEdgeNext_withRightRail,this.props.hasRightRail&&(!e||12===e)],[this.props.managedClasses.desktopFeedEdgenext_withRightRail_4gutter,this.props.hasRightRail&&4===e],[this.props.managedClasses.desktopFeedEdgenext_withRightRail_6gutter,this.props.hasRightRail&&6===e],[this.props.managedClasses.desktopFeedEdgenext_withRightRail_8gutter,this.props.hasRightRail&&8===e],[this.props.managedClasses.desktopFeedEdgenext_withRightRail_10gutter,this.props.hasRightRail&&10===e],[this.props.managedClasses.desktopFeedEdgeNext_root_1c,this.props.enableOneColumn]);return Object(a.a)(j.a.Fragment,null,Object(a.a)("div",Object.assign({},this.unhandledProps(),{className:t,role:"main",style:this.props.zoomRatio&&this.props.zoomRatio<1?Object(u.a)(this.props.zoomRatio):{}}),Object(a.a)("div",{id:"infopane-sentinel",className:this.props.managedClasses.infopaneSentinel}),this.renderRiver(),Object(a.a)("div",{id:"pagination",className:this.props.managedClasses.paginationSentinel}),this.renderSDCardActionMenu(),Object(a.a)("div",{ref:e=>this.coldStartContainerElement=e},this.props.coldStartFreResponse&&this.renderColdStartFre()),this.props.coldStartFreResponse&&this.renderColdStartFre()),Object(k.a)(this.props.toast))}renderRiver(){if(!this.props.riverSectionFeedLayoutData.length)return;const e=this.getGap(),t=Object(D.a)(this.props.managedClasses.feedSection,[this.props.managedClasses.xlGap,10===e],[this.props.managedClasses.lGap,8===e],[this.props.managedClasses.mGap,6===e],[this.props.managedClasses.xmGap,4===e]);return Object(a.a)("div",Object.assign({},this.props.riverSectionTelemetryObject?this.props.riverSectionTelemetryObject.render():null,{className:t,style:Object.assign(Object.assign({},this.props.enableWillChange?{"will-change":"auto"}:{}),this.props.zoomRatio&&this.props.zoomRatio>1?Object(u.a)(this.props.zoomRatio):{})}),this.renderRiverSections())}getGap(){let e=12;return this.props.reverseLayoutGap||(e=this.props.consumeVerticalTab&&!this.props.isVerticalTabEnabled?this.props.horizontalTabLayoutGap:this.props.layoutGap),e}updateLayoutGap(e,t,i){if(t&&(e.gap=t+"px",this.props.fixedCardHeight&&i!==v.a.ShoppingCarousel)){const i=((304-t)/2).toFixed(1);e.gridAutoRows=i+"px"}}renderRiverSections(){if(!this.props.riverSectionFeedLayoutData.length)return;const e=e=>{const t={};if(!this.props.reverseLayoutGap)return this.props.consumeVerticalTab&&!this.props.isVerticalTabEnabled?this.updateLayoutGap(t,this.props.horizontalTabLayoutGap,e):this.updateLayoutGap(t,this.props.layoutGap,e),t};return this.props.riverSectionFeedLayoutData.map((t,i)=>{var n;return Object(a.a)(m.a,{style:e(null===(n=t.cardMetadataList)||void 0===n?void 0:n[0].type),key:"riverSection-"+i,attrs:{layout:this.getColumnArrangementForFeed(t.feedData)},props:{data:t.feedData,cardTemplateMap:o.a,layoutStyles:r.a[t.templateId].styles}})})}renderColdStartFre(){const{coldStartFreResponse:e}=this.props,t={coldStartArtifact:e,parentContainerElement:this.coldStartContainerElement};return Object(k.a)(this.props.coldStartConfigInfoFre,{properties:t})}checkPaginationListeners(){this.props.riverSectionFeedLayoutData.length&&(this.paginationAnimationFrameId&&cancelAnimationFrame(this.paginationAnimationFrameId),this.checkPaginationTimeout&&clearTimeout(this.checkPaginationTimeout),this.checkPaginationTimeout=setTimeout(()=>{this.sentinelInView&&(this.paginationAnimationFrameId=requestAnimationFrame(()=>{this.paginationAnimationFrameId=null,this.checkPaginationTimeout=null,this.props.onUserPaginate()}))},100))}renderBingOverlayPlayer(){const{bingOverlayPlayerHeight:e,bingOverlayPlayerWidth:t}=this.props.bingVideoCardData,i={addCloseButton:!0,hidden:!0,sourceLink:"",videoEmbedPlayerWidth:t,videoEmbedPlayerHeight:e};if(!document.getElementById("bing-video-embed-player-root")){const e=Object(a.a)(I,Object.assign({},i)),t=document.createElement("div");t.id="bing-video-embed-player-root",document.body.appendChild(t),M.a.render(e,t)}}removeBingOverlayPlayer(){const e=document.getElementById("bing-video-embed-player-root");e&&document.body.removeChild(e)}}L.defaultProps={experienceName:p.a.desktopFeedEdgeNext};var N=i("G82u");class W{}W.setAutoRotate=new N.a("SetAutoRotate"),W.setIsFocused=new N.a("SetIsFocused"),W.setIsMouseOver=new N.a("SetIsMouseOver"),W.setMoneyCardData=new N.a("SetMoneyCardData"),W.setRiverSectionFeedLayoutData=new N.a("SetRiverSectionFeedLayoutData"),W.setWeatherCardData=new N.a("SetWeatherCardData"),W.toggleSDCardActionsMenu=new N.a("ToggleSDCardActionsMenu"),W.setColdStartExperience=new N.a("SetColdStartExperience");var U,H,B=i("y4Tj"),V=i("D57K"),_=i("Cn94"),q=i("bYbF"),$=i("oIHq"),z=i("cASJ"),G=i("hdNv"),Q=i("cxul"),K=i("8f7u"),J=i("J48h"),X=i("HN5f"),Z=i("ssy2"),Y=i("dTwT"),ee=i("RIQ7"),te=i("gmMM"),ie=i("I6Lx"),ne=i("Ac7j"),se=i("jE1l"),ae=i("s9+9"),oe=i("Bwzq"),re=i("Uw7R"),ce=i("XlyT"),de=i("HxRh"),le=i("YUMq"),he=i("H3ag");!function(e){e.Long="long",e.Short="short"}(U||(U={})),function(e){e.Disabled="disabled",e.OnScroll="onScroll",e.Alwasy="always"}(H||(H={}));var ue=i("rGfm"),pe=i("X9Vi"),ge=i("HcI6"),me=i("mJFi"),fe=i("x/PH"),be=i("7oW3"),ve=i("Z3LZ"),ye=i("+8mm"),Ce=i("ydPk");const Se={[v.a.StockQuote]:"finance",[v.a.SportsMatch]:"sports",[v.a.SportsOlympics]:"sports",[v.a.WeatherSummary]:"weather"},Oe={[Q.b.bingVideoCarousel]:de.X,[Q.b.healthCard]:de.I,[Q.b.moneyCard]:de.Df,[Q.b.sportsCard]:de.li,[Q.b.horoscopeAnswerCard]:de.We,[Q.b.onThisDayCard]:de.cg,[Q.b.travelDestinationCard]:de.hj,[Q.b.weatherCard]:de.dk};var Ae=i("8X6I"),we=i("SSDD"),Ie=i("MSQM"),Te=i("w0HK"),Re=i("loKy"),je=i("Z118"),xe=i("6I6u"),Me=i("XMfh"),De=i("hme2"),Pe=i("8ntK"),ke=i("Qo3E"),Ee=i("9RHM"),Fe=i("1aPi"),Le=i("X3C0"),Ne=i("zZnt"),We=i("Cj5D"),Ue=i("ac9z"),He=i("WfnD");const Be={inspect:e=>{var t;const{config:i,state:n,connectorArgs:s}=e,{moneyCardData:a,coldStartFreResponse:o}=n,r=i.bingVideoCardConfig||{},{childExperienceReferencesWC:c}=i,d=[];return{props:{layoutGap:i.layoutGap,horizontalTabLayoutGap:i.horizontalTabLayoutGap,isVerticalTabEnabled:s.isVerticalTabEnabled,consumeVerticalTab:i.consumeVerticalTab,reverseLayoutGap:i.reverseLayoutGap,actionsMenuProps:n.actionsMenuProps,actionsMenuOpen:n.actionsMenuOpen,bingVideoCardData:{bingOverlayPlayerHeight:null==r?void 0:r.bingVideoOverlayPlayerHeight,bingOverlayPlayerSrcFormat:null==r?void 0:r.bingVideoPlayerSrcFormat,bingOverlayPlayerWidth:null==r?void 0:r.bingVideoOverlayPlayerWidth,navigateDestination:null==r?void 0:r.navigateDestination,pivotSelectionInfo:null==r?void 0:r.pivotSelectionInfo},coldStartFreResponse:o,designSystemOverrides:i.designSystemOverrides,onUserPaginate:s.onUserPaginate,closeSDCardActionsMenu:s.closeSDCardActionsMenu,riverSectionFeedLayoutData:n.riverSectionFeedLayoutData?n.riverSectionFeedLayoutData:[],onUnmount:s.onUnmount,onMount:s.onMount,hasRightRail:s.hasRightRail,moneyCardData:{cardType:a.cardType,dataFrom:a.dataFrom,lastCardType:a.lastCardType,optionSwitch:a.optionSwitch,actionMenuProps:a.actionMenuProps,userSignedIn:a.userSignedIn,searchSuggestions:a.searchSuggestions,showSuggestions:a.showSuggestions,noSuggestion:a.noSuggestion,moneyCardElement:a.moneyCardElement,financeDataProviderPage:i.moneyCardConfig.financeDataProviderPage,addToWatchlist:s.addToWatchlist,handleQuoteSearch:s.handleQuoteSearch,setMoneyCardData:s.setMoneyCardData,goToAddSymbolCallback:s.goToAddSymbolCallback},toast:null===(t=i.childExperienceReferencesWC)||void 0===t?void 0:t.toastWC,coldStartConfigInfoFre:null==c?void 0:c.coldStartModal,fixedCardHeight:i.fixedCardHeight,enableWillChange:i.enableWillChange,zoomRatio:i.zoomRatio,enableOneColumn:i.enableOneColumn},missingChildren:d}}};var Ve=i("eoyk"),_e=i("+qLX"),qe=i("lV/q"),$e=i("HDSB"),ze=i("W+kI"),Ge=i("XLvf"),Qe=i("MRe/"),Ke=i("C/Vb"),Je=i("A8DD");const Xe=Object(re.a)();var Ze;!function(e){e[e.FirstFetchAndRenderContent=0]="FirstFetchAndRenderContent",e[e.SubFetchAndRenderContent=1]="SubFetchAndRenderContent",e[e.RenderContent=2]="RenderContent"}(Ze||(Ze={}));class Ye extends He.a{constructor(e,t,i,n,s,a,o){super(e,t,i,n,s,a,o),this.isFetchingContent=!1,this.infoPaneNativeAdsMap=[],this.tabInfoPaneNativeAdsMap=[],this.riverNativeAdsMap=[],this.cmsInfopaneNativeAdsMap=[],this.cmsRiverNativeAdsMap=[],this.unRenderedLayoutTemplate=[],this.unRenderedRiverContent=[],this.visualReadinessCallbackSet=!1,this.ttvrFired=!1,this.isFirstBatchCall=!0,this.isFirstFeedCall=!0,this.beaconService=new $.a,this.isDocumentVisible="visible"===document.visibilityState,this.waitingAdsMap=new Map,this.cmsAdsConfig={documentId:"",infoPaneIndices:[],riverIndices:[]},this.infoPaneAdRegionIndexList=[],this.riverAdRegionIndexList=[],this.tabInfoPaneAdRegionIndexList=[],this.infoPaneCmsAdRegionIndexList=[],this.riverCmsAdRegionIndexList=[],this.unServedSamAdSet=new Set,this.awayTimestamp=1/0,this.disablePrefetchHack=!1,this.initFirstDone=!1,this.onMount=()=>{document.addEventListener("visibilitychange",this.handleDocumentVisibilityChange)},this.onUnmount=()=>{document.removeEventListener("visibilitychange",this.handleDocumentVisibilityChange)},this.handleDocumentVisibilityChange=()=>{this.isDocumentVisible="visible"===document.visibilityState,this.isDocumentVisible?this.checkAwayTime():this.updateAwayTime()},this.refreshFeedWhenDisableSDCard=()=>Object(V.b)(this,void 0,void 0,(function*(){yield Object(Ue.d)(),this.refreshFeed()})),this.onScroll=()=>{this.enableScrollDownTopSiteInf&&document.documentElement.scrollTop<=54||(this.prefetchOnlyFirstTime(),window.removeEventListener("scroll",this.onScroll))},this.setVisuallyReadyMarkers=()=>{this.ttvrFired||(this.ttvrFired=!0,window.requestAnimationFrame(()=>{setTimeout(()=>{Object(P.m)(p.a.desktopFeedEdgeNext);const e=Object(ve.g)();e&&ye.a.updateVisuallyReadyTiming.getActionSender(e).send(Object(ve.c)(p.a.desktopFeedEdgeNext,void 0,void 0,void 0,window.performance.now()))},0)}))},this.cardActionClickHandler=(e,t,i,n,s,a,o)=>{if(!e||!t)return;const{riverSectionFeedLayoutData:r}=this.getCurrentState(),c=Object(G.i)(t);if(r&&r.length){this.rowCount=this.prevRowCount;const d=[];r.forEach(t=>{const i=[];let n=!1;t.cardMetadataList.forEach(t=>{if(t.type===v.a.Infopane){const s=t;s.subItems.forEach(t=>{t.id===e&&(n=!0,t.metadata=t.metadata||{},t.metadata.actions=c)}),i.push(s)}else{const s=t;s.id===e&&(n=!0,s.metadata=s.metadata||{},s.metadata.actions=c),i.push(s)}}),this.rowCount=this.prevRowCount,d.push(n?{feedData:this.mapFeedData(i,t.templateId,!1,this.riverSectionTelemetryObject),templateId:t.templateId,cardMetadataList:Object(Ee.a)(i)}:t)}),n&&s?this.cardActionServiceClient.PostCardActionV2Event(t,i,e,void 0,s,a,o):this.cardActionServiceClient.PostCardActionV2Event(t,i,e,void 0,null,a,o),W.setRiverSectionFeedLayoutData.getActionSender(this).send(d)}},this.activeItemChangedHandler=(e,t)=>{if(!e)return;const{riverSectionFeedLayoutData:i}=this.getCurrentState();if(i&&i.length){const n=[];i.forEach(i=>{const s=[];let a=!1;i.cardMetadataList.forEach(i=>{const n=i;n.id===e&&(a=!0,n.activeIndexForMultiAds=t),s.push(n)}),this.rowCount=this.prevRowCount,n.push(a?{feedData:this.mapFeedData(s,i.templateId,!1,this.riverSectionTelemetryObject),templateId:i.templateId,cardMetadataList:Object(Ee.a)(s)}:i)}),W.setRiverSectionFeedLayoutData.getActionSender(this).send(n)}},this.initCardAction=e=>{_.a.Init.getGlobalActionSender().send(Object.assign(Object.assign({},e),{overrideStyles:{zIndex:""+f.a.Above}}))},this.onUserPaginate=()=>{this.previousRiverSectionContentResponse&&Object(ve.j)().then(()=>this.renderNextFeed(je.b.subsequent))},this.goToPersonalizeCallback=e=>{var t;const i=this.config.oneRiverInterestsPivotInfo;if(!i)return;const n=Object(Te.a)();let s="muted-publishers"===e?{isRequestFromMutePublisherToast:!0,noScroll:!0}:{};(null===(t=i.context)||void 0===t?void 0:t.navigateToPersonalize)&&(s=i.context),n.switchPivot({pivotId:i.pivotId,configIndexHref:i.configIndexHref,configIndexRef:i.configIndexRef,context:Object.assign(Object.assign({},s),{isRequestFromSdCardAddRemoveClick:!1}),telemetryPageName:_e.a.Interests,display:i.displayName})},this.clickSDCardActionButton=(e,t,i,n)=>{e.menuItems.forEach(e=>{"edit"===e.id?t===Q.b.weatherCard&&(e.onClick=this.switchToWeatherSetting):"hide"===e.id?t===Q.b.weatherCard?e.onClick=()=>{this.showHideWeatherCardAndRefresh(i.cardName,!1,n)}:t===Q.b.moneyCard&&(e.onClick=()=>{this.showHideMoneyCardAndRefresh(i.cardName,!1,n)}):"more"===e.id?t===Q.b.sportsCard?e.onClick=this.goToPersonalizeCallback:e.onClick=this.goToPersonalizeSettingsCallback:"dataProvider"===e.id?e.onClick=this.showMoneyCardDataProvider:"addWatchlist"===e.id&&(e.onClick=this.goToAddSymbolCallback)}),e.onDismiss=this.closeSDCardActionsMenu;const s=!this.getCurrentState().actionsMenuOpen;W.toggleSDCardActionsMenu.getActionSender(this).send(e,s)},this.switchToWeatherSetting=()=>{this.setWeatherCardData({cardMode:"setting",setUnit:void 0,setLocMode:void 0,selectLocation:void 0,suggestedLocations:void 0}),W.toggleSDCardActionsMenu.getActionSender(this).send(this.getCurrentState().actionsMenuProps,!1)},this.updateSDCardData=e=>Object(V.b)(this,void 0,void 0,(function*(){var t;yield Object(Ue.e)();const i=yield this.SDCardProvider.fetch({contentType:Se[e]}),n=i&&(null===(t=i[Se[e]])||void 0===t?void 0:t.find(t=>t.type===e));n&&this.mapSDCardDataToFeedLayout(e,n)})),this.mapSDCardDataToFeedLayout=(e,t)=>{const i=this.getCurrentState().riverSectionFeedLayoutData;let n,s;i.slice(0,2).forEach((t,i)=>{s=t.cardMetadataList.find(t=>t.type===e),s&&(n=i)});const a=i[n],o=a.cardMetadataList.findIndex(t=>t.type===e),r=t?[...a.cardMetadataList.slice(0,o),t,...a.cardMetadataList.slice(o+1)]:a.cardMetadataList;this.rowCount=this.prevRowCount;const c=Object.assign(Object.assign({},a),{feedData:this.mapFeedData(r,a.templateId,!0,this.riverSectionTelemetryObject),cardMetadataList:r});W.setRiverSectionFeedLayoutData.getActionSender(this).send([...i.slice(0,n),c,...i.slice(n+1)])},this.setWeatherCardData=e=>Object(V.b)(this,void 0,void 0,(function*(){W.setWeatherCardData.getActionSender(this).send(e),yield this.mapSDCardDataToFeedLayout(v.a.WeatherSummary)})),this.showHideWeatherCardAndRefresh=(e,t,i)=>Object(V.b)(this,void 0,void 0,(function*(){const n=yield this.weatherPdpClient.enableDisableWeatherCard(t);if(W.toggleSDCardActionsMenu.getActionSender(this).send(this.getCurrentState().actionsMenuProps,!1),n&&(yield this.refreshFeedWhenDisableSDCard(),!t&&i)){const t={id:"hide-weather-toast",expirationInMs:5e3,inputText:e,toastType:Pe.a.Hide,onClick:()=>{this.showHideWeatherCardAndRefresh(null,!0,i)}};ke.a.renderToast(t)}if(this.pageSettingsDataConnector){const{sdCardSettings:e}=this.pageSettingsDataConnector.getCurrentState();e.weatherVisible=t,ne.a.updateLocalStorage.getActionSender(this.pageSettingsDataConnector).send(e)}else if(Object(Y.a)().supported){const e=Object(Y.a)().getObject(Ne.c,Ne.b);e&&(e.weatherVisible=t),Object(Y.a)().setObject(Ne.c,e)}return n})),this.showHideMoneyCardAndRefresh=(e,t,i)=>Object(V.b)(this,void 0,void 0,(function*(){const n=yield this.financeUserService.enableDisableMoneyCard(t);if(W.toggleSDCardActionsMenu.getActionSender(this).send(this.getCurrentState().actionsMenuProps,!1),n&&(yield this.refreshFeedWhenDisableSDCard(),!t&&i)){const t={id:"hide-money-toast",expirationInMs:5e3,inputText:e,toastType:Pe.a.Hide,onClick:()=>{this.showHideMoneyCardAndRefresh(null,!0,i)}};ke.a.renderToast(t)}if(this.pageSettingsDataConnector){const{sdCardSettings:e}=this.pageSettingsDataConnector.getCurrentState();e.moneyVisible=t,ne.a.updateLocalStorage.getActionSender(this.pageSettingsDataConnector).send(e)}else if(Object(Y.a)().supported){const e=Object(Y.a)().getObject(Ne.c,Ne.b);e.moneyVisible=t,Object(Y.a)().setObject(Ne.c,e)}return n})),this.goToPersonalizeSettingsCallback=()=>{var e,t;const i=this.config.oneRiverInterestsPivotInfo;if(i){if(null===(e=i.context)||void 0===e?void 0:e.navigateToPersonalize){const e=null===(t=i.children)||void 0===t?void 0:t.find(e=>"experienceSettings"===e.pivotId);e&&Object(We.c)(e,!1)}else Object(We.c)(i,!1);this.getCurrentState().actionsMenuOpen&&W.toggleSDCardActionsMenu.getActionSender(this).send(this.getCurrentState().actionsMenuProps,!1)}},this.showMoneyCardDataProvider=()=>{window.open(this.config.moneyCardConfig.financeDataProviderPage,"_blank"),W.toggleSDCardActionsMenu.getActionSender(this).send(this.getCurrentState().actionsMenuProps,!1)},this.closeSDCardActionsMenu=()=>{W.toggleSDCardActionsMenu.getActionSender(this).send(this.getCurrentState().actionsMenuProps,!1)},this.handleNavClick=(e,t)=>Object(V.b)(this,void 0,void 0,(function*(){var t,i,n;let s=null===(t=this.getCurrentState().moneyCardData)||void 0===t?void 0:t.multiTabQuoteItems;s&&s[e]||(yield this.refreshMoneyCardData(),s=null===(i=this.getCurrentState().moneyCardData)||void 0===i?void 0:i.multiTabQuoteItems);const a=s[e];if(e===K.b.Watchlist){const t=(null===(n=this.getCurrentState().moneyCardData)||void 0===n?void 0:n.suggestedQuoteItems)||[],[i,o]=this.getCorrectWatchlist(a,t);return s[K.b.Watchlist]=a,void this.setMoneyCardData({cardType:J.c.EdgeShowData,quoteItems:i,suggestedQuoteItems:o,multiTabQuoteItems:s,activeTab:e})}this.setMoneyCardData({cardType:J.c.EdgeShowData,quoteItems:a,activeTab:e})})),this.getCorrectWatchlist=(e,t)=>{let i=e||[],n=t||[];if(t.length>0){const e=this.addedQuoteIds||[],t=n.filter(t=>e.includes(t.id));i=i.concat(t),n=n.filter(t=>!e.includes(t.id))}return[i,n]},this.handleAddToWatchlist=e=>Object(V.b)(this,void 0,void 0,(function*(){let t=this.addedQuoteIds||[];t=[...t],t.includes(e)||t.push(e),this.addedQuoteIds=t})),this.refreshMoneyCardData=()=>Object(V.b)(this,void 0,void 0,(function*(){var e,t,i,n,s,a,o,r,c;yield Object(Ue.e)();const d=this.financeUserService.getWatchlist(),l=this.financeService.getMarketMovers(),[h,u]=yield Promise.all([d,l]),p=(null===(e=this.config.moneyCardConfig)||void 0===e?void 0:e.maxNumQuotes)?null===(t=this.config.moneyCardConfig)||void 0===t?void 0:t.maxNumQuotes:3,g=null==h?void 0:h.slice(0,p),m=null===(n=null===(i=this.config.moneyCardConfig)||void 0===i?void 0:i.marketQuoteIds)||void 0===n?void 0:n.slice(0,p),f=null===(a=null===(s=this.config.moneyCardConfig)||void 0===s?void 0:s.currencyQuoteIds)||void 0===a?void 0:a.slice(0,p),b=null===(o=u.active)||void 0===o?void 0:o.slice(0,p),v=null===(r=u.gainers)||void 0===r?void 0:r.slice(0,p),y=null===(c=u.losers)||void 0===c?void 0:c.slice(0,p),C=this.getSuggestedQuoteIds(g,p),S=[...g,...m,...f,...b,...v,...y,...C],O=yield this.financeService.getQuoteSummary(S),A=this.getQuoteMapIdToItem(O),w=this.getQuoteItemsByIds(A,g),I=this.getQuoteItemsByIds(A,m),T=this.getQuoteItemsByIds(A,f),R=this.getQuoteItemsByIds(A,b),j=this.getQuoteItemsByIds(A,v),x=this.getQuoteItemsByIds(A,y),M=this.getQuoteItemsByIds(A,C),[D,P]=this.getCorrectWatchlist(w,M),k={[K.b.Watchlist]:D,[K.b.Market]:I,[K.b.Currencies]:T,[K.b.Movers]:R,[K.b.Gainers]:j,[K.b.Losers]:x,[K.b.Recent]:[]},E=this.getCurrentState().moneyCardData.activeTab;this.setMoneyCardData({cardType:J.c.EdgeShowData,suggestedQuoteItems:P,quoteItems:k[E],multiTabQuoteItems:k})})),this.getQuoteMapIdToItem=e=>{const t=new Map;if(!e)return t;for(let i=0;i<e.length;i+=1){const n=e[i],s=n.id;t.set(s,n)}return t},this.getQuoteItemsByIds=(e,t)=>{if(!e||!t||0===t.length)return[];const i=[];for(let n=0;n<t.length;n+=1){const s=t[n];if(e.has(s)){const t=e.get(s);i.push(t)}}return i},this.getSuggestedQuoteIds=(e,t)=>{var i,n;if(!e||e.length>=t)return[];let s=(null===(n=null===(i=this.config)||void 0===i?void 0:i.moneyCardConfig)||void 0===n?void 0:n.suggestedQuoteIds)||[];return s=s.filter(t=>!e.includes(t)),s=s.slice(0,t-e.length),s},this.saveWeaSettingAndRefresh=e=>Object(V.b)(this,void 0,void 0,(function*(){e&&e.changeSignal&&(yield this.saveWeaSettings(e)),W.setWeatherCardData.getActionSender(this).send({cardMode:"forecast"}),yield this.updateSDCardData(v.a.WeatherSummary),Object(Ae.c)(we.a.WeatherChange)})),this.triggerWeatherLocAutoSuggest=e=>Object(V.b)(this,void 0,void 0,(function*(){let t=void 0;const i=e.trim();if(i){const e=yield this.weatherAutoSuggestClient.getAutoSuggestResponse(i);null!=e&&(t=e)}this.setWeatherCardData({suggestedLocations:t})})),this.switchToWeatherForecast=()=>{this.setWeatherCardData({cardMode:"forecast",setUnit:void 0,setLocMode:void 0,selectLocation:void 0,suggestedLocations:void 0})},this.selectWeatherLocationMode=e=>{this.setWeatherCardData({setLocMode:e})},this.selectWeatherUnit=e=>{this.setWeatherCardData({setUnit:e})},this.selectWeatherLocation=e=>{this.setWeatherCardData({selectLocation:e,suggestedLocations:void 0})},this.selectDetectedLocation=()=>Object(V.b)(this,void 0,void 0,(function*(){let e=pe.b.headLocation();e&&!pe.b.isCurrentLocaleName(e)&&this.weatherLocationLocalizeClient&&(e=yield this.weatherLocationLocalizeClient.getLocalisedLocationDetails(e)),this.selectWeatherLocation(e)})),this.setMoneyCardData=e=>{W.setMoneyCardData.getActionSender(this).send(e),this.updateSDCardData(v.a.StockQuote)},this.addToWatchlist=e=>Object(V.b)(this,void 0,void 0,(function*(){yield this.financeUserService.addToWatchlist(e),this.setMoneyCardData({cardType:J.c.ShowData,searchSuggestions:[],showSuggestions:!1,noSuggestion:!1}),yield Object(Ue.d)(),this.refreshFeed()})),this.goToAddSymbolCallback=()=>{if(this.config.moneyCardConfig.disableInLineAddWatchlist){const e=Object(ee.b)(),t=new URL(this.config.moneyCardConfig.financeWatchlistPage);e&&t.searchParams.append("ocid",e),window.open(t.href,"_blank")}else this.setMoneyCardData({cardType:J.c.AddWatchlist,lastCardType:this.getCurrentState().moneyCardData.cardType,optionSwitch:!1,showSuggestions:!1,noSuggestion:!1,searchSuggestions:[]});W.toggleSDCardActionsMenu.getActionSender(this).send(this.getCurrentState().actionsMenuProps,!1)},this.handleQuoteSearch=Object(Fe.a)(e=>Object(V.b)(this,void 0,void 0,(function*(){const t=e.trim();if(""!==t)try{const e=yield this.autoSuggestServiceConnect.getAutoSuggest(t,4);return void(e&&0!==e.length?this.setMoneyCardData({cardType:J.c.AddWatchlist,searchSuggestions:e,showSuggestions:!0,noSuggestion:!1}):this.setMoneyCardData({cardType:J.c.AddWatchlist,showSuggestions:!1,noSuggestion:!0}))}catch(e){this.setMoneyCardData({cardType:J.c.AddWatchlist,showSuggestions:!1,noSuggestion:!0})}else this.setMoneyCardData({cardType:J.c.AddWatchlist,showSuggestions:!1,noSuggestion:!1})})),200),this.initializeColdStartExperience=()=>{var e;(null===(e=this.config.childExperienceReferencesWC)||void 0===e?void 0:e.coldStartModal)&&Object(ve.j)().then(()=>{try{Object(De.a)().getFreArtifacts().then(e=>{e&&e.fre?W.setColdStartExperience.getActionSender(this).send(e):e&&Object(Ge.isNullOrUndefined)(e.fre)&&e.subCards&&e.subCards.length&&Object(ce.b)(de.Tb,"FRE request was made but returned no flag or empty data")})}catch(e){Object(ce.c)(e,de.Ne,"Getting data for the required artifacts failed in desktop feed when initializing cold start experience")}})},this.closeColdStartExperience=()=>{W.setColdStartExperience.getActionSender(this).send(null)},this.resetRowCount(),this.pageSettingsDataConnector=i.connector(ae.a.ChromiumPageSettings),this.nativeAdService=Object(z.b)(),this.cardActionServiceClient=new q.a(window.fetch.bind(window)),this.weatherPdpClient=new ge.a,this.weatherAutoSuggestClient=Object(me.a)(a&&a.weatherCardConfig&&a.weatherCardConfig.weatherAutoSuggestionConfig);const r=Object($e.a)()?window.fetch.bind(window):fetch;this.weatherLocationLocalizeClient=new fe.a(r,{noDynamicQueryParams:!0}),this.addedQuoteIds=[],this.financeUserService=Z.FinanceServices.getFinanceUserService(),this.financeService=Z.FinanceServices.getCachedFinanceService(),this.autoSuggestServiceConnect=Z.FinanceServices.getAutoSuggestService(),this.enableScrollDownTopSiteInf=function(e,t){const i=e.connector(ae.a.TopSitesLayoutData),n=e.connector(ae.a.ChromiumPageSettings);if(i&&n){const e=i.getCurrentState(),s=n.getCurrentState(),a="always"===s.selectedFeedDisplaySetting;if(t.scrollDownTopSiteInf&&a&&s.quickLinksEnabled&&e.isTopSitesCollapsed)return!0}return!1}(i,a),Object(ve.j)().then(()=>{this.nativeAdService.loadCmsBackFillList()}),this.updateNativeAdsFromCmsCallback=(e=>{this.updateNativeAdsMap(e.callbackFnPlacementList),this.updateNativeAdsInRiverSections()}).bind(this),this.perfTimeline&&(this.mapFeedData=this.perfTimeline.instrumentFunc("mapFeedData",this.mapFeedData,this))}mapStateToProps(e){var t;const i=Be.inspect({config:this.config,children:this.childComponentInstanceList,state:e,connectorArgs:{addToWatchlist:this.addToWatchlist,goToAddSymbolCallback:this.goToAddSymbolCallback,handleQuoteSearch:this.handleQuoteSearch,onUserPaginate:this.onUserPaginate,setMoneyCardData:this.setMoneyCardData,closeSDCardActionsMenu:this.closeSDCardActionsMenu,onMount:this.onMount,onUnmount:this.onUnmount,hasRightRail:this.hasRightRail,isVerticalTabEnabled:null===(t=this.pageSettingsDataConnector)||void 0===t?void 0:t.getCurrentState().verticalTabsOpened}});return Object.assign(Object.assign({enableScrollDownTopSiteInf:this.enableScrollDownTopSiteInf},i.props),{riverSectionTelemetryObject:this.riverSectionTelemetryObject,closeColdStartExperience:this.closeColdStartExperience})}onComponentConnect(e){var t,i,n,s,a;return Object(V.b)(this,void 0,void 0,(function*(){yield He.a.prototype.onComponentConnect.call(this,e);let o=this.config.riverSectionCardProviderConfig;const r=this.config.riverSectionSDCardProviderConfig;let c;if(this.feedId=null===(t=null==e?void 0:e.context)||void 0===t?void 0:t.feedId,this.feedName=null===(i=null==e?void 0:e.context)||void 0===i?void 0:i.query,this.feedSource=null===(n=null==e?void 0:e.context)||void 0===n?void 0:n.feedSource,this.hasRightRail=null===(s=null==e?void 0:e.context)||void 0===s?void 0:s.hasRightRail,this.isXFeed=!1,(this.feedId||this.feedName)&&(this.feedId!==o.initialRequest.feedId&&(this.isXFeed=!0),c=this.feedId||this.feedName,o=this.updateInitialRequest()),o&&o.initialRequest&&this.pageSettingsDataConnector){const e=this.pageSettingsDataConnector.getCurrentState();let t=!1;"function"==typeof this.pageSettingsDataConnector.getPrimaryAccountInfoAsync&&this.pageSettingsDataConnector.getPrimaryAccountInfoAsync().then(e=>{t=e.accountType===se.d.MSA});const i=qe.a.getPageConfiguration(e,t);i&&!isNaN(i)&&(o.initialRequest.pageConfiguration=i)}this.riverCardProvider=(null===(a=null==e?void 0:e.context)||void 0===a?void 0:a.riverCardProvider)||new je.a(o,this.isXFeed),this.SDCardProvider=new xe.a(r),ue.a.refreshRiver.registerObserver(()=>Object(V.b)(this,void 0,void 0,(function*(){yield Object(Ue.d)(),this.refreshFeed()}))),Ve.a.updateLayout.registerObserver(()=>Object(V.b)(this,void 0,void 0,(function*(){W.setRiverSectionFeedLayoutData.getActionSender(this).send(this.getCurrentState().riverSectionFeedLayoutData)}))),this.initFeed(),this.riverSectionTelemetryObject=this.telemetryObject.addOrUpdateChild({name:"River",content:{headline:c||"RiverSection"}}),Xe[h.a.desktopFeedStart]=window.performance.now(),this.config.childExperienceReferences&&(yield this.loadChildrenExperiences(Object.keys(this.config.childExperienceReferences).filter(e=>this.filterEmptyChildExperience(e)).map(e=>this.config.childExperienceReferences[e]))),Object(Te.a)().addSwitchListener(()=>{window.removeEventListener("scroll",this.onScroll)},Re.a.Monetization),Promise.all([Object(Je.a)(),this.requestPageVisibleAsync()]).then(()=>{this.isDocumentVisible="visible"===document.visibilityState})}))}filterEmptyChildExperience(e){const t=this.config.childExperienceReferences[e];return Object(te.h)(t)}initFeed(){this.resetParameters(),this.renderNextFeed(je.b.init)}refreshFeed(){this.resetParameters(),this.resetRowCount(),this.renderNextFeed(je.b.refresh)}resetParameters(){this.setCmsConfig(),this.waitingAdsMap.clear(),this.riverCardProvider.clearCache(),this.previousRiverSectionContentResponse=null,this.unRenderedLayoutTemplate=[],this.unRenderedRiverContent=[],this.infoPaneAdRegionIndexList=[],this.riverAdRegionIndexList=[],this.tabInfoPaneAdRegionIndexList=[],this.infoPaneCmsAdRegionIndexList=[],this.riverCmsAdRegionIndexList=[],this.isFirstFeedCall=!0,this.unServedSamAdSet.clear(),this.infoPaneNativeAdsMap=[],this.riverNativeAdsMap=[],this.tabInfoPaneNativeAdsMap=[],this.cmsInfopaneNativeAdsMap=[],this.cmsRiverNativeAdsMap=[],this.samAdsInitialUpperBound=this.config.samAdsInitialUpperBound,this.leadgenAdsInitialUpperBound=this.config.leadgenAdsInitialUpperBound,this.nativeAdService.resetNativeAdService()}renderNextFeed(e){var t;return Object(V.b)(this,void 0,void 0,(function*(){if(this.config.isNewPrefetchlogic)return this.renderNextFeedWithPrefetch(e);let i=Ze.RenderContent;if(0===this.unRenderedLayoutTemplate.length){if(!(yield this.getContentForNextFeed(e)))return void(this.isGetContentForNextFeedBlocked=!0);this.isFirstFeedCall?(i=Ze.FirstFetchAndRenderContent,this.isFirstFeedCall=!1):i=Ze.SubFetchAndRenderContent}const n=(null===(t=this.config)||void 0===t?void 0:t.perfEarlyFetchAuction)&&i===Ze.FirstFetchAndRenderContent,s=n?this.fetchSamNativeAdsContent():void 0,a=n?this.fetchCmsAdsContent():void 0;this.addRiverSections(e);const o=this.getCurrentState().riverSectionFeedLayoutData.length-1,r=this.waitingAdsMap;r.has(o)||r.set(o,!0),i===Ze.FirstFetchAndRenderContent?yield this.initAtFirst(s,a):i===Ze.SubFetchAndRenderContent?(this.fetchAndHandleSamAds(),this.fetchAndHandleCmsAds()):i===Ze.RenderContent&&this.updateNativeAdsInRiverSections()}))}renderNextFeedWithPrefetch(e){return Object(V.b)(this,void 0,void 0,(function*(){let t=Ze.RenderContent;if(0===this.unRenderedLayoutTemplate.length){if(!(this.prefetchHandler?yield this.prefetchHandler:yield this.getContentForNextFeed(e)))return;this.isFirstFeedCall&&(t=Ze.FirstFetchAndRenderContent,this.isFirstFeedCall=!1)}this.addRiverSections(e);const i=this.getCurrentState().riverSectionFeedLayoutData.length-1,n=this.waitingAdsMap;if(n.has(i)||n.set(i,!0),t===Ze.FirstFetchAndRenderContent)yield this.initAtFirst();else if(t===Ze.RenderContent){this.updateNativeAdsInRiverSections();const e=this.config.numOfSectionsToPrefetch||2;this.unRenderedLayoutTemplate.length<=e&&!this.prefetchHandler&&this.initFirstDone&&(this.prefetchHandler=this.getContentForNextFeed(je.b.subsequent).then(e=>(e&&(this.fetchAndHandleSamAds(),this.fetchAndHandleCmsAds()),this.prefetchHandler=void 0,e)).catch(()=>(this.prefetchHandler=void 0,!1)))}}))}initAtFirst(e,t){return Object(V.b)(this,void 0,void 0,(function*(){if(yield Object(Ie.a)(),!this.previousRiverSectionContentResponse)return;this.fetchAndHandleSamAds(!1,e),this.fetchAndHandleCmsAds(t);const{selectedFeedDisplaySetting:i}=this.pageSettingsDataConnector.getCurrentState();("peek"===i||this.config.legacyPrefetchBehavior===H.Disabled)&&(this.disablePrefetchHack=!0),this.config.legacyPrefetchBehavior===H.OnScroll?window.addEventListener("scroll",this.onScroll):this.prefetchOnlyFirstTime()}))}prefetchOnlyFirstTime(){return Object(V.b)(this,void 0,void 0,(function*(){if(this.riverAdRegionIndexList)try{yield this.fetchAndHandleSamAds(!0)}catch(e){}if(this.disablePrefetchHack)return void(this.initFirstDone=!0);if(yield this.getContentForNextFeed(je.b.subsequent))if(this.isGetContentForNextFeedBlocked){this.addRiverSections(je.b.subsequent);const e=this.getCurrentState().riverSectionFeedLayoutData.length-1,t=this.waitingAdsMap;t.has(e)||t.set(e,!0),this.fetchAndHandleSamAds(),this.fetchAndHandleCmsAds(),this.isGetContentForNextFeedBlocked=!1}else yield this.fetchAndHandleSamAds(!0),yield this.fetchAndHandleCmsAds();this.initFirstDone=!0}))}getContentForNextFeed(e){return Object(V.b)(this,void 0,void 0,(function*(){if(this.isFetchingContent)return!1;this.isFetchingContent=!0;const t=this.previousRiverSectionContentResponse;if(t&&t.status===Me.a.NoContent)return this.isFetchingContent=!1,!1;const i=t&&t.nextPageRequest,n=yield this.fetchFeedContent(i,e);if(this.isFetchingContent=!1,!n)return!1;if(this.previousRiverSectionContentResponse=n,n.status!==Me.a.Success)return!1;const{sections:s}=n;for(const e of s){const{cards:t,layoutTemplate:i}=e;this.unRenderedRiverContent=this.unRenderedRiverContent.concat(t),this.unRenderedLayoutTemplate.push(i)}return this.updateAdRegionIndexList(),this.switchRedundantCmsAdsToNativeAds(),!0}))}generateSamAdRequest(){var e,t,i,n;const{infoPaneAdRegionIndexList:s,riverAdRegionIndexList:a,tabInfoPaneAdRegionIndexList:o,infoPaneCmsAdRegionIndexList:r,riverCmsAdRegionIndexList:c,samAdsInitialUpperBound:d,leadgenAdsInitialUpperBound:l}=this,h={placements:[]};return(s.length||a.length)&&(h.placements.push({region:"infopane",indices:s.splice(0),img:null===(t=null===(e=this.config.adTemplateConfig)||void 0===e?void 0:e.imageSizeConfig)||void 0===t?void 0:t.infopane},{region:"river",indices:d>0?a.splice(0,d):a.splice(0),img:null===(n=null===(i=this.config.adTemplateConfig)||void 0===i?void 0:i.imageSizeConfig)||void 0===n?void 0:n.river}),this.samAdsInitialUpperBound=-1),this.config.enableInfopaneLeadgenNative&&r.length&&h.placements.push({region:"resinfopane",indices:r.splice(0)}),this.config.enableRiverLeadgenNative&&c.length&&(h.placements.push({region:"resriver",indices:l>0?c.splice(0,l):c.splice(0)}),this.leadgenAdsInitialUpperBound=-1),this.config.enableDenseSlide&&o.length&&h.placements.push({region:"infopane-tab",indices:o.splice(0)}),!this.config.enableAuctionInWebWorker||ie.b.IsPrerender||this.isXFeed||(h.enableAuctionInWebWorker=!0),h}generateCmsAdRequest(){var e,t,i,n;const{infoPaneCmsAdRegionIndexList:s,riverCmsAdRegionIndexList:a}=this;let o;return this.config.enableInfopaneLeadgenNative&&this.config.enableRiverLeadgenNative||!s.length&&!a.length||(o={placements:[{region:"infopane_cms",indices:this.config.enableInfopaneLeadgenNative?[]:s.splice(0),img:null===(t=null===(e=this.config.adTemplateConfig)||void 0===e?void 0:e.imageSizeConfig)||void 0===t?void 0:t.infopane},{region:"river_cms",indices:this.config.enableRiverLeadgenNative?[]:a.splice(0),img:null===(n=null===(i=this.config.adTemplateConfig)||void 0===i?void 0:i.imageSizeConfig)||void 0===n?void 0:n.river}]}),o}filterInfoPaneAds(e,t){return e?e.filter(e=>e.region===t).map(e=>(e.adLabelText=this.adLabelText,e.isGreyAdsLabelEnabled=this.isGreyAdsLabelEnabled,e.isWhiteSlug=this.config.isWhiteSlug,e.isTransparentSlug=this.config.isTransparentSlug,e.isNarrowTitleFooterGap=this.config.isNarrowTitleFooterGap,e)):[]}filterRiverAds(e,t){return e?e.filter(e=>{var i,n,s,a;if(e.region===t){if(e.items.length)if(this.config.useArticleCardTemplate){const t=Number(e.items[0].imageWidth)||(null===(n=null===(i=this.config.adTemplateConfig)||void 0===i?void 0:i.imageSizeConfig)||void 0===n?void 0:n.river.w),o=Number(e.items[0].imageHeight)||(null===(a=null===(s=this.config.adTemplateConfig)||void 0===s?void 0:s.imageSizeConfig)||void 0===a?void 0:a.river.h);e.items[0].imageWidth=(225*t/o).toFixed().toString(),e.items[0].imageHeight="225",e.imageWidth=e.items[0].imageWidth,e.imageHeight=e.items[0].imageHeight}else e.items[0].imageWidth="300",e.items[0].imageHeight="156";return!0}return!1}).map(e=>(e.adLabelText=this.adLabelText,e.isGreyAdsLabelEnabled=this.isGreyAdsLabelEnabled,e.isProviderInHeader=this.config.isProviderInHeader,e.isProviderInFooter=this.config.isProviderInFooter,e.isWhiteSlug=this.config.isWhiteSlug,e.isTransparentSlug=this.config.isTransparentSlug,e)):[]}filterTabInfoPaneAds(e,t){return e?e.filter(e=>e.region===t).map(e=>(e.adLabelText=this.adLabelText,e.isGreyAdsLabelEnabled=this.isGreyAdsLabelEnabled,e)):[]}updateNativeAdsMap(e){this.infoPaneNativeAdsMap=this.infoPaneNativeAdsMap.concat(this.filterInfoPaneAds(e,"infopane")),this.infoPaneNativeAdsMap=this.infoPaneNativeAdsMap.concat(this.filterInfoPaneAds(e,"resinfopane")),this.riverNativeAdsMap=this.riverNativeAdsMap.concat(this.filterRiverAds(e,"river")),this.riverNativeAdsMap=this.riverNativeAdsMap.concat(this.filterRiverAds(e,"resriver")),this.tabInfoPaneNativeAdsMap=this.tabInfoPaneNativeAdsMap.concat(this.filterTabInfoPaneAds(e,"infopane-tab"))}updateCmsNativeAdsMap(e){this.cmsInfopaneNativeAdsMap=this.cmsInfopaneNativeAdsMap.concat(this.filterInfoPaneAds(e,"infopane_cms")),this.cmsRiverNativeAdsMap=this.cmsRiverNativeAdsMap.concat(this.filterRiverAds(e,"river_cms"))}updateNativeAdsInRiverSections(){if(!(this.infoPaneNativeAdsMap.length>0||this.riverNativeAdsMap.length>0||this.cmsInfopaneNativeAdsMap.length>0||this.cmsRiverNativeAdsMap.length>0||this.tabInfoPaneNativeAdsMap.length>0))return;const{riverSectionFeedLayoutData:e}=this.getCurrentState();if(e&&e.length){this.rowCount=this.prevRowCount;for(const[t]of e.entries()){if(!this.waitingAdsMap.get(t))continue;const i=e[t],n=[];let s=!1;i.cardMetadataList.forEach(e=>{if(e.type===v.a.Infopane){const t=e;t.subItems.map((e,i)=>{if(e.type===v.a.NativeAd&&this.isInvalidAdItem(e))t.subItems[i]=this.createNativeAdCardMetadata("infopane",e.regionIndex),this.isInvalidAdItem(t.subItems[i])&&(s=!0);else if(e.type===v.a.CmsAd&&this.isInvalidAdItem(e))t.subItems[i]=this.createNativeAdCardMetadata("infopane_cms",e.regionIndex),this.isInvalidAdItem(t.subItems[i])&&(s=!0);else if(e.type===v.a.Dense){const t=e;t.subItems.map((e,i)=>{e.type===v.a.NativeAd&&this.isInvalidAdItem(e)&&(t.subItems[i]=this.createNativeAdCardMetadata("infopane-tab",e.regionIndex),this.isInvalidAdItem(t.subItems[i])&&(s=!0))})}}),n.push(t)}else if(e.type===v.a.NativeAd&&this.isInvalidAdItem(e)){const t=this.createNativeAdCardMetadata("river",e.regionIndex);n.push(t),this.isInvalidAdItem(t)&&(s=!0)}else if(e.type===v.a.CmsAd&&this.isInvalidAdItem(e)){const t=this.createNativeAdCardMetadata("river_cms",e.regionIndex);n.push(t),this.isInvalidAdItem(t)&&(s=!0)}else n.push(e)}),s||this.waitingAdsMap.set(t,!1),e.splice(t,1,{feedData:this.mapFeedData(n,i.templateId,!0,this.riverSectionTelemetryObject),templateId:i.templateId,cardMetadataList:n})}window.requestAnimationFrame(()=>{setTimeout(()=>{const e=!0===ie.b.IsPrerender?performance.now()-Object(P.j)(le.d):performance.now();Object(P.s)(oe.a.TimeToRenderAd,e)},0)}),W.setRiverSectionFeedLayoutData.getActionSender(this).send(e)}}isInvalidAdItem(e){return 0===e.placement.items.length}addRiverSections(e){return Object(V.b)(this,void 0,void 0,(function*(){if(!this.unRenderedLayoutTemplate.length)return[];let t=[];const i=this.unRenderedLayoutTemplate.shift(),n=r.a[i],s=this.getCardMetaDataForRiverSection(n);if(this.prevRowCount=this.rowCount,e===je.b.init||e===je.b.refresh){const e=s.findIndex(e=>e.type===v.a.Infopane),n=s[e],a=s.findIndex(e=>e.type===v.a.WeatherSummary),o=s[a],r=s.findIndex(e=>e.type===v.a.StockQuote||e.type===v.a.MoneyInfo),c=s[r],d=s.findIndex(e=>e.type===v.a.SportsMatch||e.type===v.a.SportsOlympics),l=s[d],u=s.findIndex(e=>e.type===v.a.Trending),p=(s[u],s.findIndex(e=>e.type===v.a.Upsell)),g=(s[p],[...s]);n&&g.splice(e,1,Object.assign(Object.assign({},n),{subItems:[n.subItems[0]]})),o&&g.splice(a,1,Object.assign(Object.assign({},o),{data:null})),c&&g.splice(r,1,Object.assign(Object.assign({},c),{data:null})),l&&g.splice(d,1,Object.assign(Object.assign({},l),{data:null}));const m=g.slice(13).map(e=>{const t=Object(Ee.a)(e);return t.type!==v.a.NativeAd&&Object.keys(t).forEach(e=>{"type"!==e&&"id"!==e&&(t[e]=null)}),t});g.splice(13,g.length-13+1,...m),t.push({feedData:this.mapFeedData(g,i,!0,this.riverSectionTelemetryObject),templateId:i,cardMetadataList:g}),W.setRiverSectionFeedLayoutData.getActionSender(this).send(t),Xe[h.a.firstSectionRenderStart]=window.performance.now(),Object(ve.j)().then(()=>Object(V.b)(this,void 0,void 0,(function*(){t=[],this.rowCount=this.prevRowCount,t.push({feedData:this.mapFeedData(s,i,!0,this.riverSectionTelemetryObject),templateId:i,cardMetadataList:s}),W.setRiverSectionFeedLayoutData.getActionSender(this).send(t),o&&(this.weatherDataConnector||(this.weatherDataConnector=yield this.rootReducer.getDataConnector(ae.a.WeatherData),this.setupWeatherDataObservers(),this.weatherDataConnector&&this.weatherDataConnector.getCurrentState()&&this.weatherDataConnector.getCurrentState().settingUpdateStatus&&this.updateSDCardData(v.a.WeatherSummary)))})))}else{t.push({feedData:this.mapFeedData(s,i,!0,this.riverSectionTelemetryObject),templateId:i,cardMetadataList:s});const e=this.getCurrentState().riverSectionFeedLayoutData;W.setRiverSectionFeedLayoutData.getActionSender(this).send(e.concat(t)),Xe[h.a.secondSectionRenderStart]=window.performance.now()}return s}))}mapFeedData(e,t,i,n){if(!e.length)return null;const s={cards:[],C5:[],C4:[],C3:[],C2:[],C1:[]},a=t&&r.a[t],{cardSlots:o,rowHeightPx:c,colWidthPx:d,gutterPx:l}=a||{cardSlots:[null]},h=this.config.showToastAfterSDCardHide;return e.forEach((e,a)=>{var r,u,p,m,f,b,y,C,S,O,A;let w=X.a[e.type];if(!w)return;let I=null;if(w===Q.b.infopaneCard&&(I=this.setVisuallyReadyMarkers,this.visualReadinessCallbackSet=!0),!this.visualReadinessCallbackSet&&w===Q.b.contentCard){Object(G.b)(e)&&(I=this.setVisuallyReadyMarkers,this.visualReadinessCallbackSet=!0)}"msft-one-row-five-col"===t&&(E.a.addOrUpdateTmplProperty("isGlanceCard","1"),window.requestAnimationFrame(()=>{setTimeout(()=>{I=this.setVisuallyReadyMarkers,this.visualReadinessCallbackSet=!0,I()},0)}));const T=!this.config.reverseLayoutGap&&(!this.config.consumeVerticalTab||this.pageSettingsDataConnector.getCurrentState().verticalTabsOpened),R={hasRightRail:this.hasRightRail,cardMetadata:e,parentTelemetryObject:n,cardSlot:o[a],openLinksInNewTab:i,cardActionBitMask:this.config.cardActionBitMask||7,isAnaheimDesign:!0,cardActionClickHandler:this.cardActionClickHandler,goToPersonalizeCallback:this.goToPersonalizeCallback,initCardAction:this.initCardAction,visualReadinessCallback:I,localizedStrings:this.config.localizedStrings,configOptions:this.config,layoutGap:T?this.config.layoutGap:void 0,stockImageData:this.config.stockImageData,sdCardActionClickHandler:(e,t,i)=>{this.clickSDCardActionButton(e,t,i,h)},refreshSDCardSection:this.refreshFeedWhenDisableSDCard,goToPersonalizeSettingsCallback:this.goToPersonalizeSettingsCallback,enableRichSocialReaction:this.config.enableRichSocialReactions,isAdFeedbackV1Enabled:!!this.config.adFeedbackV1Enabled,handleAdFeedbackSubmit:this.cardActionServiceClient.ReportAd.bind(this.cardActionServiceClient),activeItemChangedHandler:this.activeItemChangedHandler,isNarrowTitleFooterGap:this.config.isNarrowTitleFooterGap,refreshFeedCallback:()=>this.refreshFeed(),layoutTemplateName:t,rowCount:this.rowCount,rowHeightPx:c,colWidthPx:d,gutterPx:l,isClarityEnabled:this.config.isClarityEnabled};let j;w===Q.b.contentCard&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.socialBarWC&&Object(Ke.a)(this.config.childExperienceReferencesWC.socialBarWC),R.isProviderInFooter=this.config.isProviderInFooter),w===Q.b.nativeAdCard&&(R.isAdProviderInHeader=this.config.isAdProviderInHeader),w===Q.b.infopaneCard&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.socialBarWC&&Object(Ke.a)(this.config.childExperienceReferencesWC.socialBarWC),R.activeIndicator=!1,R.autoRotateIntervalMs=this.config.autoRotateIntervalMs||5e3,R.firstAutoRotateIntervalMs=this.config.firstAutoRotateIntervalMs,this.config.useColorfulInfopane||(R.configOptions=Object(Le.a)(this.config,["useArticleCardTemplate"])),R.disableAutoRotate=this.config.disableAutoRotate,Object(ze.a)().get("vpFreeze")&&(R.disableAutoRotate=!0)),w===Q.b.moneyCard&&(R.cardStateData=this.getCurrentState()&&this.getCurrentState().moneyCardData,R.handleNavClick=this.handleNavClick,R.handleAddToWatchlist=this.handleAddToWatchlist,R.refreshMoneyCardData=this.refreshMoneyCardData,R.cardLayout=g.a.full),w===Q.b.moneyInfoCardWC&&(null===(r=this.config.childExperienceReferencesWC)||void 0===r?void 0:r.moneyInfoCardWC)&&(Object(Ke.a)(this.config.childExperienceReferencesWC.moneyInfoCardWC),R.configOptions=this.config.childExperienceReferencesWC.moneyInfoCardWC),w===Q.b.sportsCard&&(null===(u=this.config.childExperienceReferencesWC)||void 0===u?void 0:u.sportsCardWC)&&(Object(Ke.a)(this.config.childExperienceReferencesWC.sportsCardWC),R.configOptions=this.config.childExperienceReferencesWC.sportsCardWC),w===Q.b.sportsOlympicCard&&(null===(p=this.config.childExperienceReferencesWC)||void 0===p?void 0:p.sportsOlympicCard)&&(Object(Ke.a)(this.config.childExperienceReferencesWC.sportsOlympicCard),R.configOptions=this.config.childExperienceReferencesWC.sportsOlympicCard),w===Q.b.shoppingCarouselCard&&(e.type===v.a.ShoppingCard&&(null===(m=this.config.childExperienceReferencesWC)||void 0===m?void 0:m.shoppingCard)&&(R.configOptions=this.config.childExperienceReferencesWC.shoppingCard),e.type===v.a.ShoppingCarousel&&(null===(f=this.config.childExperienceReferencesWC)||void 0===f?void 0:f.shoppingCarousel)&&(R.configOptions=this.config.childExperienceReferencesWC.shoppingCarousel)),w!==Q.b.comicsCarouselCard&&w!==Q.b.selectCarouselCard&&w!==Q.b.editorsPickCarouselCard&&w!==Q.b.dailyFixGamesCarouselCard||!(null===(b=this.config.childExperienceReferencesWC)||void 0===b?void 0:b.selectCarousel)||(Object(Ke.a)(this.config.childExperienceReferencesWC.selectCarousel),R.configOptions=this.config.childExperienceReferencesWC.selectCarousel),w===Q.b.publisherCarouselCard&&this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.publisherCarousel&&Object(Ke.a)(this.config.childExperienceReferencesWC.publisherCarousel),w===Q.b.weatherCard&&(R.cardStateData=this.getCurrentState()&&this.getCurrentState().weatherCardData,R.saveSettingsAndRefresh=this.saveWeaSettingAndRefresh,R.triggerAutoSuggest=this.triggerWeatherLocAutoSuggest,R.cancelSettings=this.switchToWeatherForecast,R.selectLocationMode=this.selectWeatherLocationMode,R.selectWeatherUnit=this.selectWeatherUnit,R.selectValueFromSuggest=this.selectWeatherLocation,R.selectDetectedLocation=this.selectDetectedLocation,R.switchToWeatherSettings=this.switchToWeatherSetting,R.cardLayout="full",e&&e.data&&this.weatherDataConnector&&this.weatherDataConnector.updateWeatherDataState(e.data)),w===Q.b.serendipityCard?(null===(C=null===(y=this.config)||void 0===y?void 0:y.childExperienceReferencesWC)||void 0===C?void 0:C.trendingNowWC)?(Object(Ke.a)(this.config.childExperienceReferencesWC.trendingNowWC),R.configOptions=this.config.childExperienceReferencesWC.trendingNowWC,w=Q.b.trendingNowCard):R.configOptions=null:w===Q.b.trendingNowCard&&((null===(O=null===(S=this.config)||void 0===S?void 0:S.childExperienceReferencesWC)||void 0===O?void 0:O.trendingNowWC)?(Object(Ke.a)(this.config.childExperienceReferencesWC.trendingNowWC),R.configOptions=this.config.childExperienceReferencesWC.trendingNowWC):R.configOptions=null),w===Q.b.travelDestinationCard&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.travelDestination?(Object(Ke.a)(this.config.childExperienceReferencesWC.travelDestination),R.configOptions=this.config.childExperienceReferencesWC.travelDestination):R.configOptions=null),w===Q.b.healthCard&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.bingHealthCard?(Object(Ke.a)(this.config.childExperienceReferencesWC.bingHealthCard),R.configOptions=this.config.childExperienceReferencesWC.bingHealthCard):R.configOptions=null),w===Q.b.horoscopeAnswerCard&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.horoscopeCard?(Object(Ke.a)(this.config.childExperienceReferencesWC.horoscopeCard),R.configOptions=this.config.childExperienceReferencesWC.horoscopeCard):R.configOptions=null),w===Q.b.onThisDayCard&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.onThisDayCard?(Object(Ke.a)(this.config.childExperienceReferencesWC.onThisDayCard),R.configOptions=this.config.childExperienceReferencesWC.onThisDayCard):R.configOptions=null),w===Q.b.electionsCard&&this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.electionsCard&&(Object(Ke.a)(this.config.childExperienceReferencesWC.electionsCard),R.configOptions=this.config.childExperienceReferencesWC.electionsCard),w===Q.b.lotteryCard&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.lotteryCard?(Object(Ke.a)(this.config.childExperienceReferencesWC.lotteryCard),R.configOptions=this.config.childExperienceReferencesWC.lotteryCard):R.configOptions=null),w===Q.b.qnaCard&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.qnaCard?(Object(Ke.a)(this.config.childExperienceReferencesWC.qnaCard),R.configOptions=this.config.childExperienceReferencesWC.qnaCard):R.configOptions=null),w===Q.b.recipesCard&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.recipesCard?(Object(Ke.a)(this.config.childExperienceReferencesWC.recipesCard),R.configOptions=this.config.childExperienceReferencesWC.recipesCard):R.configOptions=null),w===Q.b.esportsCard&&this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.esportsCard&&(Object(Ke.a)(this.config.childExperienceReferencesWC.esportsCard),R.configOptions=this.config.childExperienceReferencesWC.esportsCard),w===Q.b.recommendedSearchCarousel&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.recommendedSearchCarousel&&Object(Ke.a)(this.config.childExperienceReferencesWC.recommendedSearchCarousel),R.configOptions=this.config.childExperienceReferencesWC.recommendedSearchCarousel),w===Q.b.trafficCard&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.trafficCard?(Object(Ke.a)(this.config.childExperienceReferencesWC.trafficCard),R.configOptions=this.config.childExperienceReferencesWC.trafficCard):R.configOptions=null),w===Q.b.bingVideoCarousel&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.bingVideoCarousel?(Object(Ke.a)(this.config.childExperienceReferencesWC.bingVideoCarousel),R.configOptions=this.config.childExperienceReferencesWC.bingVideoCarousel):R.configOptions=null),w===Q.b.coldStartCard&&(this.config.expectedColdStartPosition>=0&&a+1!==this.config.expectedColdStartPosition&&E.a.sendAppErrorEvent(de.Sb),Object(Ke.a)(null===(A=this.config.childExperienceReferencesWC)||void 0===A?void 0:A.coldStartRiverCard),R.upsellGetStartedClickHandler=this.config.upsellLaunchesInline?void 0:this.initializeColdStartExperience),w===Q.b.denseCard&&(this.config.childExperienceReferencesWC&&this.config.childExperienceReferencesWC.denseCard?(Object(Ke.a)(this.config.childExperienceReferencesWC.denseCard),R.configOptions=this.config.childExperienceReferencesWC.denseCard):R.configOptions=null);try{j=Q.a[w].getFeedDataForCard(R)}catch(t){let i=Oe[w];i||(i=w===Q.b.shoppingCarouselCard?e.type===v.a.ShoppingCard?de.Sh:de.gi:de.vk),Object(ce.c)(t,i,`${w} getFeedDataForCard error, ${t.toString()}`)}j&&Object.keys(j).forEach(e=>{s[e]=s[e].concat(j[e])})}),this.rowCount={C5:this.rowCount.C5+(c&&c.C5&&c.C5.length?c.C5.length/2:0),C4:this.rowCount.C4+(c&&c.C4&&c.C4.length?c.C4.length/2:0),C3:this.rowCount.C3+(c&&c.C3&&c.C3.length?c.C3.length/2:0),C2:this.rowCount.C2+(c&&c.C2&&c.C2.length?c.C2.length/2:0),C1:this.rowCount.C1+(c&&c.C1&&c.C1.length?c.C1.length/2:0)},s}getCardMetaDataForRiverSection(e){const t=[];if(!e)return t;for(let i=0;i<e.cardCount;i++)t.push(this.unRenderedRiverContent.shift());return t}fetchFeedContent(e,t){return Object(V.b)(this,void 0,void 0,(function*(){let i;try{i=yield this.riverCardProvider.fetch(e,t)}catch(e){E.a.sendAppErrorEvent(Object.assign(Object.assign({},de.Vb),{message:"Content fetch failed for Desktop Feed EdgeNext river section.",pb:Object.assign(Object.assign({},de.Vb.pb),{customMessage:"Failed with exception : "+e})}))}return i}))}getTemplateConfig(){return this.config.useArticleCardTemplate?this.config.adTemplateConfig:{}}generateNativeAdsResponse(e,t){const i=this.getTemplateConfig(),n=this.nativeAdService.updateSamAdResponse(e,t,i),{placements:s,adLabelText:a,isGreyAdsLabelEnabled:o}=n;return this.adLabelText||(this.adLabelText="Ad"===e.adLabelText?a:e.adLabelText,this.isGreyAdsLabelEnabled=o),s.filter(e=>e.items.length)}updateAdRegionIndexList(){const{infoPaneAdRegionIndexList:e,riverAdRegionIndexList:t,tabInfoPaneAdRegionIndexList:i,infoPaneCmsAdRegionIndexList:n,riverCmsAdRegionIndexList:s}=this.previousRiverSectionContentResponse;this.infoPaneAdRegionIndexList.push(...e),this.riverAdRegionIndexList.push(...t),this.tabInfoPaneAdRegionIndexList.push(...i),this.infoPaneCmsAdRegionIndexList.push(...n),this.riverCmsAdRegionIndexList.push(...s)}switchRedundantCmsAdsToNativeAds(){const{infoPaneAdRegionIndexList:e,riverAdRegionIndexList:t,infoPaneCmsAdRegionIndexList:i,riverCmsAdRegionIndexList:n}=this,{sections:s}=this.previousRiverSectionContentResponse,a=i.length-this.cmsAdsConfig.infoPaneIndices.length,o=n.length-this.cmsAdsConfig.riverIndices.length;if(a>0||o>0){const r=[],c=[];s.forEach(e=>{e.cards&&e.cards.forEach(e=>{e.type===v.a.Infopane?e.subItems.forEach(e=>{e.type===v.a.CmsAd&&r.push(e)}):e.type===v.a.CmsAd&&c.push(e)})});for(let t=0;t<a;t++)r[r.length-1-t].type=v.a.NativeAd,e.push(i.pop());for(let e=0;e<o;e++)c[c.length-1-e].type=v.a.NativeAd,t.push(n.pop());e.sort((e,t)=>e-t),t.sort((e,t)=>e-t)}}fetchAndHandleCmsAds(e=this.fetchCmsAdsContent()){return Object(V.b)(this,void 0,void 0,(function*(){const t=yield e;t&&(this.updateCmsNativeAdsMap(t.placements),this.updateNativeAdsInRiverSections())}))}fireServedTrackingCallForPlacements(e,t,i){e.forEach(({beaconsJson:e,bingTrackerUrls:n,videoViewabilityData:s})=>{!e||n&&n.length>0&&s||(t&&void 0!==this.config.samAdNextPageUpperBound?i<this.config.samAdNextPageUpperBound?(this.beaconService.fireAdServedTrackingCall(e),i++):this.unServedSamAdSet.add(e):this.beaconService.fireAdServedTrackingCall(e))})}fetchAndHandleSamAds(e,t=this.fetchSamNativeAdsContent()){return Object(V.b)(this,void 0,void 0,(function*(){const i=yield t;if(i&&0!==i.length){this.updateNativeAdsMap(i),this.updateNativeAdsInRiverSections();const t=0;this.fireServedTrackingCallForPlacements(i,e,t)}}))}fetchCmsAdsContent(){var e;return Object(V.b)(this,void 0,void 0,(function*(){const t=this.generateCmsAdRequest();if(t)try{const i=this.cmsAdsConfig.infoPaneIndices.splice(0,t.placements[0].indices.length),n=this.cmsAdsConfig.riverIndices.splice(0,t.placements[1].indices.length),s=i.concat(n),a=yield this.nativeAdService.fetchCmsAds(t,this.cmsAdsConfig.documentId,s);return!this.adLabelText&&a&&(this.adLabelText=a.adLabelText,this.isGreyAdsLabelEnabled=a.isGreyAdsLabelEnabled),(null===(e=this.config)||void 0===e?void 0:e.perfRemoveWait)||(yield Object(ve.j)()),a}catch(e){return void Object(ce.c)(e,de.Ub,"Call to Cms Ad Service failed")}}))}fetchSamNativeAdsContent(){var e;return Object(V.b)(this,void 0,void 0,(function*(){const t=this.generateSamAdRequest();if(t&&t.placements&&0!==t.placements.length)try{let i;he.a.startMark("AdServiceCall.DesktopFeedEdgeNext");let n=!1;this.isFirstBatchCall&&(i=[this.updateNativeAdsFromCmsCallback],n=!0,this.isFirstBatchCall=!1);const s=(yield Promise.all([this.nativeAdService.fetchSamAds(t,n,i),Object(Qe.c)(this.config)]))[0],{placeHolderResponse:a,samResponse:o}=s;return(null===(e=this.config)||void 0===e?void 0:e.perfRemoveWait)||(yield Object(ve.j)()),this.generateNativeAdsResponse(a,o)}catch(e){return void Object(ce.c)(e,de.Ub,"Call to Ad Service failed")}finally{he.a.endMark("AdServiceCall.DesktopFeedEdgeNext")}}))}createNativeAdCardMetadata(e,t){let i,n=v.a.NativeAd;switch(e){case"infopane":i=this.infoPaneNativeAdsMap.find(e=>e.regionIndex===t);break;case"river":i=this.riverNativeAdsMap.find(e=>e.regionIndex===t);break;case"infopane-tab":i=this.tabInfoPaneNativeAdsMap.find(e=>e.regionIndex===t);break;case"infopane_cms":i=this.config.enableInfopaneLeadgenNative?this.infoPaneNativeAdsMap.find(e=>e.regionIndex===t):this.cmsInfopaneNativeAdsMap.find(e=>e.regionIndex===t),n=v.a.CmsAd;break;case"river_cms":i=this.config.enableRiverLeadgenNative?this.riverNativeAdsMap.find(e=>e.regionIndex===t):this.cmsRiverNativeAdsMap.find(e=>e.regionIndex===t),n=v.a.CmsAd}if(i){const{beaconsJson:s}=i;return s&&this.unServedSamAdSet.delete(s)&&this.beaconService.fireAdServedTrackingCall(s),{type:n,regionIndex:t,id:`nativead-${e}-${i.regionIndex}`,placement:i}}return{type:n,regionIndex:t,placement:{items:[]}}}saveWeaSettings(e){return Object(V.b)(this,void 0,void 0,(function*(){const t=[];return 3&e.changeSignal&&t.push(this.weatherPdpClient.updateUserSettings(1&e.changeSignal&&e.unitSet&&e.unitSet.toString(),2&e.changeSignal&&e.locationMode&&e.locationMode.toString())),e.selectedLocation&&e.locationMode==Ce.a.SpecifyLoc&&t.push(this.weatherPdpClient.setHomeLocation(e.selectedLocation)),yield Promise.all(t)}))}setupWeatherDataObservers(){be.a.updateWeatherSettings.registerObserver(()=>Object(V.b)(this,void 0,void 0,(function*(){this.updateSDCardData(v.a.WeatherSummary)})))}updateInitialRequest(){return Object.assign(Object.assign({},this.config.riverSectionCardProviderConfig),{initialRequest:Object.assign(Object.assign({},this.config.riverSectionCardProviderConfig.initialRequest),{feedId:this.feedId,feedName:this.feedName,feedSource:this.feedSource})})}revalidateExperienceStaleState(){var e,t;let i=36e5;return(null===(t=null===(e=this.config)||void 0===e?void 0:e.stalenessInfo)||void 0===t?void 0:t.staleThreshold)<1&&(i=60*this.config.stalenessInfo.staleThreshold*1e3),Object(P.j)(le.d)>i?this.refreshFeed():this.refreshSDCards(),!0}refreshSDCards(){return Object(V.b)(this,void 0,void 0,(function*(){let e=this.getCurrentState().riverSectionFeedLayoutData;const t={};e.slice(0,2).forEach(e=>{e.cardMetadataList.forEach(e=>{e.type!==v.a.WeatherSummary&&e.type!==v.a.StockQuote&&e.type!==v.a.SportsMatch&&e.type!==v.a.SportsOlympics||(t[Se[e.type]]=e.type)})}),this.unRenderedRiverContent.forEach(e=>{e.type!==v.a.WeatherSummary&&e.type!==v.a.StockQuote&&e.type!==v.a.MoneyInfo&&e.type!==v.a.SportsMatch||(t[Se[e.type]]=e.type)});const i=yield this.SDCardProvider.fetch({contentType:Object.keys(t).join(",")});if(!i)return;e=this.getCurrentState().riverSectionFeedLayoutData;const n=[...e];e.slice(0,2).forEach((e,s)=>{e.cardMetadataList.forEach((n,s)=>{var a;if(Object.values(t).includes(n.type)){const t=null===(a=i[Se[n.type]])||void 0===a?void 0:a.find(e=>e.type===n.type);if(!t)return;e.cardMetadataList[s]=t}}),this.rowCount=this.prevRowCount,e=Object.assign(Object.assign({},e),{feedData:this.mapFeedData(e.cardMetadataList,e.templateId,!0,this.riverSectionTelemetryObject),cardMetadataList:e.cardMetadataList}),n.splice(s,1,e)}),W.setRiverSectionFeedLayoutData.getActionSender(this).send(n),this.unRenderedRiverContent.forEach((e,t)=>{var n;if(e.type===v.a.WeatherSummary||e.type===v.a.StockQuote||e.type===v.a.MoneyInfo||e.type===v.a.SportsMatch){const s=null===(n=i[Se[e.type]])||void 0===n?void 0:n.find(t=>t.type===e.type);if(!s)return;this.unRenderedRiverContent[t]=s}})}))}setCmsConfig(){const e=this.config.cmsAds;e&&(this.cmsAdsConfig={documentId:e.documentId,infoPaneIndices:Array.from(e.infopane),riverIndices:Array.from(e.river)})}checkAwayTime(){const{idleTimeout:e,idleControl:t}=this.config;if(!e||ie.b.IsPrerender)return;(new Date).getTime()<this.awayTimestamp+e||(E.a.addOrUpdateTmplProperty("idleAutoRefresh","1"),E.a.sendClientLogEvent({message:"IAR is triggered",type:"information"}),t||(this.ttvrFired=!1,this.refreshFeed(),E.a.sendPageView({page:{name:"IAR",isAutoRefresh:!0}})))}updateAwayTime(){this.awayTimestamp=(new Date).getTime()}resetRowCount(){this.rowCount={C5:0,C4:0,C3:0,C2:0,C1:0},this.prevRowCount=this.rowCount}}var et=i("05Au");class tt{reduce(e,t){if(!e)return{autoRotate:!1,coldStartFreResponse:void 0,isFocused:!1,moneyCardData:{},isMouseOver:!1,riverSectionFeedLayoutData:[]};if(!t)return e;let i,n=!1;return n=et.a.handleAction(t,W.setAutoRotate,t=>{i=Object.assign(Object.assign({},e),{autoRotate:t})}),n=n||et.a.handleAction(t,W.setIsFocused,t=>{i=Object.assign(Object.assign({},e),{isFocused:t})}),n=n||et.a.handleAction(t,W.setIsMouseOver,t=>{i=Object.assign(Object.assign({},e),{isMouseOver:t})}),n=n||et.a.handleAction(t,W.setRiverSectionFeedLayoutData,t=>{i=Object.assign(Object.assign({},e),{riverSectionFeedLayoutData:t})}),n=n||et.a.handleAction(t,W.setWeatherCardData,t=>{i=Object.assign(Object.assign({},e),{weatherCardData:Object.assign(Object.assign({},e.weatherCardData),t)})}),n=n||et.a.handleAction(t,W.setMoneyCardData,t=>{i=Object.assign(Object.assign({},e),{moneyCardData:Object.assign(Object.assign({},e.moneyCardData),t)})}),n=n||et.a.handleAction(t,W.toggleSDCardActionsMenu,(t,n)=>{i=Object.assign(Object.assign({},e),{actionsMenuProps:t,actionsMenuOpen:n})}),n=n||et.a.handleAction(t,W.setColdStartExperience,t=>{i=Object.assign(Object.assign({},e),{coldStartFreResponse:t})}),i||e}}var it=i("C8K2"),nt=i("SP+O");const st=b.a.fiveColSupported(),at=st?{[Object(d.e)(null,d.a.c2)]:{width:it.c+"px"},[Object(d.f)(d.a.c3)]:{width:it.d+"px"},[Object(d.f)(d.a.c4)]:{width:it.e+"px"},[Object(d.e)(d.a.c5,null)]:{width:it.f+"px"}}:{[Object(d.e)(null,d.a.c2)]:{width:it.c+"px"},[Object(d.f)(d.a.c3)]:{width:it.d+"px"},[Object(d.e)(d.a.c4,null)]:{width:it.e+"px"}},ot=st?{[Object(d.e)(null,d.a.c2)]:{width:"300px"},[Object(d.f)(d.a.c3)]:{width:it.c+"px"},[Object(d.f)(d.a.c4)]:{width:it.d+"px"},[Object(d.e)(d.a.c5,null)]:{width:it.e+"px"}}:{[Object(d.e)(null,d.a.c2)]:{width:"300px"},[Object(d.f)(d.a.c3)]:{width:it.c+"px"},[Object(d.e)(d.a.c4,null)]:{width:it.d+"px"}},rt=(e,t)=>{const i=Object(it.g)(e),n=Object(A.b)("margin-right","margin-left",t.direction);return st?{[Object(d.e)(null,d.a.c2)]:{width:"300px",[n]:"auto"},[Object(d.f)(d.a.c3)]:{width:i.Size2ColumnWidth+"px"},[Object(d.f)(d.a.c4)]:{width:i.Size3ColumnWidth+"px"},[Object(d.e)(d.a.c5,null)]:{width:i.Size4ColumnWidth+"px"}}:{[Object(d.e)(null,d.a.c2)]:{width:"300px",[n]:"auto"},[Object(d.f)(d.a.c3)]:{width:i.Size2ColumnWidth+"px"},[Object(d.e)(d.a.c4,null)]:{width:i.Size3ColumnWidth+"px"}}};var ct=i("icPF");const dt=Object(n.a)(e=>({desktopFeedEdgeNext_root:Object.assign({color:nt.c,margin:"0 auto",position:"relative"},at),desktopFeedEdgeNext_root_1c:{[Object(d.e)(null,d.a.c1)]:{width:it.b+"px"}},desktopFeedEdgeNext_withRightRail:Object.assign({},ot),desktopFeedEdgenext_withRightRail_4gutter:Object.assign(Object.assign({},rt(4,e)),{[Object(A.b)("margin-right","margin-left",e.direction)]:"0px"}),desktopFeedEdgenext_withRightRail_6gutter:Object.assign(Object.assign({},rt(6,e)),{[Object(A.b)("margin-right","margin-left",e.direction)]:"0px"}),desktopFeedEdgenext_withRightRail_8gutter:Object.assign(Object.assign({},rt(8,e)),{[Object(A.b)("margin-right","margin-left",e.direction)]:"0px"}),desktopFeedEdgenext_withRightRail_10gutter:Object.assign(Object.assign({},rt(10,e)),{[Object(A.b)("margin-right","margin-left",e.direction)]:"0px"}),feedSection:{display:"grid","flex-flow":"row wrap",gap:"12px","justify-content":"center","margin-bottom":"33px","--elevated-corner-radius":"6","--cold-start-upsell-grid-template-rows":"16px 232px 48px"},xlGap:{gap:"10px!important"},lGap:{gap:"8px!important"},mGap:{gap:"6px!important"},xmGap:{gap:"4px!important"},infopaneSentinel:{position:"absolute",width:"612px",height:"304px",top:"0",left:"0","z-index":"-1"},paginationSentinel:{bottom:"0",height:"1px",position:"absolute",width:"100%","z-index":"-1"}}))(L),lt={reactComponent:dt,experienceConfigSchema:B.DesktopFeedEdgeNextConfigSchema,defaultMockState:s.mockDefaultState,mockState:s.mockState,mockConfig:ct.mockConfig,inspector:Be.inspect}},icPF:function(e,t){},mEtE:function(e,t,i){"use strict";t.a=function(e){return e&&e.length?e[0]:void 0}},mJFi:function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var n=i("HDSB"),s=i("D57K"),a=i("I6Lx"),o=i("ADRF"),r=i("tMmC"),c=i("X9Vi");class d{constructor(e,t,i=null){this.fetchImpl=e,this.config=t,this.xhrFetch=i,this.cfg=t||d.defaultConfig,this.cfg.appId=this.cfg.appId||d.defaultConfig.appId,this.cfg.num=this.cfg.num||d.defaultConfig.num}geocodeSuggestion(e){return Promise.resolve(null)}getAutoSuggestResponse(e){return Object(s.b)(this,void 0,void 0,(function*(){const t=[{key:"appid",value:this.cfg.appId},{key:"mr",value:""+this.cfg.num},{key:"q",value:e},{key:"setmkt",value:!this.cfg.redirectZhCnJaJpMarket||"ja-jp"!==a.b.Locale&&"zh-cn"!==a.b.Locale?a.b.Locale:"en-us"},{key:"setlang",value:a.b.Locale},{key:"ul",value:a.b.ClientSettings?`${a.b.ClientSettings.geo_lat},${a.b.ClientSettings.geo_long},100`:""}];let i=[];if(!e||!e.trim||!e.trim().length)return i;const n=new URL(d.bingAutosuggestApi,d.bingAutoSuggestServiceHost);return n.search=o.a.keyValueArrayToQueryString(t),i=yield this.fetchImpl(n.href,{jsonpCallback:"cb"}).then(e=>e.json()).then(e=>this.getWeatherLocationFromResponse(e)).catch(e=>(r.a.log("failed: "+e),null)),i}))}getWeatherLocationFromResponse(e){const t=[];if(e&&e["@graph"]){const i=e["@graph"];for(let e=0;e<i.length;e++){const n=i[e];if(n){switch(n["b:stype"]){case"Island":case"PopulatedPlace":case"Postcode1":case"Other":{const e=n["s:address"]||{},i=n["s:geo"]||{},s=i["s:latitude"],o=i["s:longitude"];if("number"==typeof s&&"number"==typeof o){const i={locality:e["s:addressLocality"]||e["s:name"]||"",region:c.d.abbreviateUSState(e["s:addressRegion"]||"",a.b.Locale,e["b:countryIso"]||""),subRegion:e["b:addressSubregion"]||"",country:e["s:addressCountry"]||"",latitude:Number(s).toString(),longitude:Number(o).toString(),isoCode:e["b:countryIso"]||"",language:a.b.Locale};c.b.isValidLocationToSuggest(i)&&t.push(i)}}}}}}return t}getLocationSearchResponse(e){return Object(s.b)(this,void 0,void 0,(function*(){const t=[{key:"appid",value:this.cfg.appId},{key:"locale",value:a.b.Locale},{key:"query",value:e}],i=[];if(!e||!e.trim||!e.trim().length)return i;const n=new URL(d.msnLocationSearchApi,d.msnApiServiceHost);n.search=o.a.keyValueArrayToQueryString(t);(new Headers).append("contentType","application/json");const s=yield(this.xhrFetch?this.xhrFetch:fetch)(n.href,{method:"GET",headers:{"Content-Type":"application/json"}});return s.ok||500===s.status?this.getweatherLocationFromSearchResponse(yield s.json()):null}))}isSameLocation(e,t){return e==t||null!=e&&null!=t&&(e.locationType==t.locationType&&(Math.abs(parseFloat(e.latitude)-parseFloat(t.latitude))<.001&&Math.abs(parseFloat(e.longitude)-parseFloat(t.longitude))<.001||(this.distance(e,t)<150||void 0)))}distance(e,t){const i=parseFloat(e.latitude)*Math.PI/180,n=parseFloat(e.longitude)*Math.PI/180,s=parseFloat(t.latitude)*Math.PI/180,a=s-i,o=parseFloat(t.longitude)*Math.PI/180-n,r=Math.sin(a/2)*Math.sin(a/2)+Math.sin(o/2)*Math.sin(o/2)*Math.cos(i)*Math.cos(s);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}getweatherLocationFromSearchResponse(e){if(!(e.value&&e.value[0]&&e.value[0].responses&&e.value[0].responses[0]))return[];const t=e.value[0].responses[0];if(t.error)return[];const i=t.locations.filter(e=>("admindivision1"!==e.entityType.toLowerCase()||"jp"===e.countryCode.toLowerCase())&&e.coordinates&&e.coordinates.lat&&e.coordinates.lon).map(e=>({isoCode:e.countryCode,locality:e.locality,region:e.state||e.adminDistrict,country:e.countryRegion,latitude:e.coordinates.lat.toString(),longitude:e.coordinates.lon.toString(),displayName:e.displayName})),n=[];return i.forEach(e=>{0==n.map(t=>this.isSameLocation(t,e)).filter(e=>e).values.length&&n.push(e)}),n}populateSearchMoreResponse(){}}d.bingAutoSuggestServiceHost="https://platform.bing.com",d.bingAutosuggestApi="geo/AutoSuggest/v1",d.defaultConfig={num:4,appId:"C98EA5B0842DBB9405BBF071E1DA76512D21FE36"},d.msnLocationSearchApi="/v0/weather/locations/search",d.msnApiServiceHost="https://api.msn.com";var l=i("qE0w");class h{constructor(e,t,i,n,s,a,o,r){this.fetchImpl=e,this.host=t,this.api=i,this.appId=n,this.excludeSubTypes=s,this.includeSubTypes=a,this.escapeISO=o,this.flightId=r,this.filterSuggestion=e=>-1===this.excludeSubTypes.indexOf(e.subType)&&(-1!==this.escapeISO.indexOf(e.address&&e.address.countryIso&&e.address.countryIso.toLowerCase())||-1!==this.includeSubTypes.indexOf(e.subType)),this._parseLocationFromAS=!0}addExtraASParams(e,t){return e}_getDefaultSuggestions(){return[]}getSuggestions(e){return Object(s.b)(this,void 0,void 0,(function*(){if(e.disableThisRequest)return null;if((!e.searchText||""===e.searchText.trim())&&(e.disableFavorites||!this._useFavoriteSuggestions)){let e=this._getDefaultSuggestions();const t=this.getHistorySuggestions();e=this._combineSuggestions(t,e),this._updateSuggestionsRank(e);return{suggestions:e}}const t=this._constructASRequestUrl(e);return this.fetchImpl(t.href).then(e=>e.json()).then(t=>{const i=this._parseSuggestionsV6(t),n=this.getHistorySuggestions(e.searchText),s=e.searchText&&""!==e.searchText.trim()?[]:this._getDefaultSuggestions();return i.suggestions=this._combineSuggestions(i.suggestions,n),i.suggestions=this._combineSuggestions(i.suggestions,s),this._updateSuggestionsRank(i.suggestions),i}).catch(e=>null)}))}getHistorySuggestions(e){return[]}_constructASRequestUrl(e){const t=[{key:"appid",value:this.appId},{key:"count",value:""+e.maxResults},{key:"q",value:e.searchText},{key:"localcircularview",value:e.userLocation&&e.userLocation+",100"},{key:"setmkt",value:a.b.Locale},{key:"setlang",value:a.b.Locale},{key:"types",value:e.suggestionTypes||""},{key:"abbrtext",value:e.abbrSuggestions?"1":""},{key:"structuredaddress",value:"true"},{key:"strucaddrread",value:"1"},{key:"setflight",value:this.flightId}],i=new URL(this.api,this.host);return i.search=o.a.keyValueArrayToQueryString(t),i}_combineSuggestions(e,t){let i=[];if(t&&t.length){i=t;let n=!1;for(let s=0;s<e.length;s++){e[s].root;const a=e[s].address,o=a&&a.streetAddress,r=a&&a.addressLocality,c=e[s].name;for(let e=0;e<t.length;e++){const i=t[e];if(o&&i.formatedAddress&&i.formatedAddress.indexOf(o)>-1&&(r&&i.formatedAddress.indexOf(r)>-1||c&&i.title&&i.title.indexOf(c)>-1)){n=!0;break}}n?n=!1:i.push(e[s])}}else i=e;return i}_updateSuggestionsRank(e){for(let t=0;t<e.length;t++)e[t].suggestionRank=t}_parseSuggestionsV6(e){const t={},i=[];if(e){const n=e.instrumentation;t.formattingRules=this._createFormattingRulesV6(e.formattingRules);const s=this._getDefaultFormattingRuleV6(t.formattingRules),o=e.value;for(let e=0;e<o.length;e++){const r={},d=o[e];try{r.root=d,r.type=d._type,r.readLink=d.readLink,r.readLinkPingSuffix=d.readLinkPingSuffix,r.instrumentationInfo=n,r.suggestionRank=e,r.formattingRuleId=d.formattingRuleId,r.formattingRule=r.formattingRuleId&&t.formattingRules[r.formattingRuleId]||s,r.entityId=d.id,r.name=d.name,r.query=d.query;const o=d.categories;r.primaryCategoryPath=o&&o.length&&o[0],r.entityId&&0===r.entityId.indexOf("local_geoid")&&(r.geoId=r.entityId,r.entityId="");const l=d.entityPresentationInfo;l&&l.entitySubTypeHints&&l.entitySubTypeHints.length&&(r.subType=l.entitySubTypeHints[0]);const h=d.geo;if(h&&this._parseLocationFromAS){const e=h.latitude,t=h.longitude;e&&t&&(r.location={latitude:e,longitude:t})}d.address?(r.address=d.address,r.address.addressRegion=c.d.abbreviateUSState(r.address.addressRegion,a.b.Locale,r.address.countryIso)):d.location&&d.location.length?r.address=d.location[0].address:"PostalAddress"===r.type&&(r.address=d),"Favorite"==r.type&&(r.alternateName=d.alternateName,r.subType=d.subType,this._processFavoriteItemId(d,r)),i.push(r)}catch(e){}}}return t.suggestions=i.filter(this.filterSuggestion),t}_createFormattingRulesV6(e){const t={};if(e)for(let i=0;i<e.length;i++){const n=JSON.parse(e[i]);t[n.identifier]=n}return t}_getDefaultFormattingRuleV6(e){let t=e&&e.Default||null;for(const i in e){t||(t=e[i]);if(a.b.Locale.indexOf(i.toLowerCase())>-1){t=e[i];break}}return t}_processFavoriteItemId(e,t){const i=e.bingId;!i||0!==i.indexOf("local_ypid:")&&0!==i.indexOf("sid")&&0!==i.indexOf("local_vdpid")||(t.entityId=i),t.bingId=i}}h.autosuggestCallerId="autosug";class u{constructor(e){this.suggestion=e,this._formatSuggestion(this.suggestion),this.setSimpleSearchText(),this._setDisplayName()}_setDisplayName(){const e=this._formattingRule&&this._formattingRule["b:groupSeparator"]||", ";this.suggestionTextLine2?this.suggestion.displayName=this.suggestionTextLine1+e+this.suggestionTextLine2:this.suggestion.displayName=this.suggestionTextLine1}setSimpleSearchText(){const e=this._formattingRule&&this._formattingRule["b:groupSeparator"]||", ";if("Favorite"===this.suggestion.type){const t=this.suggestion,i=t.name,n=t.address&&t.address.streetAddress;this._searchText=i!==n&&n?i+e+n:i}else this.suggestionTextLine2?this._searchText=this.suggestionTextLine2+e+this.suggestionTextLine1:this._searchText=this.suggestionTextLine1;this.suggestion&&(this.suggestion.searchText=this._searchText)}_removeCountry(e){let t=", ";this._formattingRule&&(t=this._formattingRule["b:groupSeparator"]||this._formattingRule.groupSeparator||", ");const i=this.suggestion.address||this.suggestion.root,n=i&&i.addressCountry;if(n&&e&&e.slice(e.length-n.length)===n){const i=e.slice(0,e.length-n.length);return i.slice(i.length-t.length)===t?i.slice(0,i.length-t.length):i}return e}_formatSuggestion(e){const t=this.suggestion.formattingRule,i=e;if("Favorite"===e.type)return i.alternateName?this.suggestionTextLine1=i.alternateName:this.suggestionTextLine1=i.name,this.suggestionTextLine2=i.address&&i.address.streetAddress,this.suggestion.formatedAddress=i.address&&i.address.streetAddress,void(this.suggestion.title=i.name);i.name&&(this.suggestionTextLine1=i.name,e.title=i.name),i.query&&(this.suggestionTextLine1=i.query),t?(this._formattingRule=t,this.suggestion.address?this._applyFormattingRule(this.suggestion.address):this._applyFormattingRule(e.root)):(this.suggestionTextLine1=e.title,this.suggestionTextLine2=e.formatedAddress),this.suggestion.formatedLine1=this.suggestionTextLine1,this.suggestion.formatedLine2=this.suggestionTextLine2,this.suggestion.formatedLine2WithoutCountry=this._removeCountry(this.suggestionTextLine2)}_applyFormattingRule(e){let t=0;const i=this._formattingRule["b:fieldGroups"]||this._formattingRule.fieldGroups;if(!this.suggestionTextLine1)for(;t<i.length;t++){const n=this._getFormattedGroupString(e,i[t]);if(n){this.suggestionTextLine1=n,this.suggestion.title=n,++t;break}}const n=[];for(;t<i.length;t++){const s=this._getFormattedGroupString(e,i[t]);s&&n.push(s)}const s=this._formattingRule["b:groupSeparator"]||this._formattingRule.groupSeparator||", ";this.suggestionTextLine2=n.join(s),this.suggestion.formatedAddress=this.suggestionTextLine2}_getFormattedGroupString(e,t){const i=[];let n;const s=t.fields;for(let t=0;t<s.length;t++)n=this._getPrimaryField(e,s[t]),n||(n=this._getAlternateField(e,s[t])),n&&i.push(n);const a=t.fieldSeparator||" ";return i.join(a)}_getPrimaryField(e,t){let i;return e&&t&&(i=e[t.name]),i}_getAlternateField(e,t){let i;if(e&&t){const n=t.alternateField;if(n){const t=n.split(",");for(let n=0;n<t.length&&(i=e[t[n]],!i);n++);}}return i}}u.HistorySuggestionType="history";class p{constructor(e,t){this.key=e,this.fetchImpl=t,this.geocode=(e,t,i,n,r)=>Object(s.b)(this,void 0,void 0,(function*(){const s={success:!1,statusCode:null,authenticationResultCode:null,statusDescription:null,name:e,results:null};if(!location)return null;const c=i&&i<=p._maxNumberOfResults?i:p._defaultResultCount,d=[{key:"key",value:this.key},{key:"maxResults",value:""+c},{key:"q",value:encodeURIComponent(e)},{key:"inclnb",value:n?"1":"0"},{key:"incl",value:r?"ciso2":""},{key:"userMapView",value:p._getBoundsString(t)},{key:"culture",value:a.b.Locale}],l=new URL(p.geoApi,p.geoHost);return l.search=o.a.keyValueArrayToQueryString(d),this.fetchImpl(l.href).then(e=>e.json()).then(e=>{if(e&&e.authenticationResultCode===p._validAuthenticationCode&&e.statusCode===p._validStatusCode&&e.statusDescription===p._validStatusDescription&&e.resourceSets&&0!==e.resourceSets.length){let t;s.success=!0,s.statusCode=p._validStatusCode,s.authenticationResultCode=p._validAuthenticationCode,s.statusDescription=p._validStatusDescription;for(let i=0,n=e.resourceSets.length;i<n;i++)if(t=e.resourceSets[i].resources,t&&0!==t.length){s.results=t;break}s.traceId=e.traceId}else e?(s.statusCode=e.statusCode,s.authenticationResultCode=e.authenticationResultCode,s.statusDescription=e.statusDescription,s.errorMessage=e.errorDetails&&e.errorDetails.length>0&&e.errorDetails[0],s.traceId=e.traceId):(s.statusCode=400,s.authenticationResultCode="Unknown",s.statusDescription="Unknown");return s}).catch(e=>(s.authenticationResultCode="Unknown",s.statusCode=404,s.statusDescription="Http Error",s))}))}static _getBoundsString(e){return e?e.south+","+e.west+","+e.north+","+e.east:""}}p._validAuthenticationCode="ValidCredentials",p._validStatusCode=200,p._validStatusDescription="OK",p._defaultResultCount=5,p._maxNumberOfResults=20,p.geoHost="https://dev.virtualearth.net",p.geoApi="/REST/v1/Locations";class g{constructor(e,t,i=null,n=null){this.fetchImpl=e,this.userLocation=i,this.xhrFetch=n,this._translateSuggestion=e=>{const t=e.suggestion.address||e.suggestion.root,i=e.suggestion.location,n=i&&i.latitude,s=i&&i.longitude;if(this.cfg.notFollowFormatRule){const i={language:a.b.Locale,addressLine:e.suggestion.name||(null==t?void 0:t.streetAddress),locality:null==t?void 0:t.addressLocality,region:null==t?void 0:t.addressRegion,subRegion:null==t?void 0:t.addressSubregion,country:t&&(t.addressCountry||""),latitude:n&&Number(n).toString(),longitude:s&&Number(s).toString(),typeV6:e.suggestion.type,searchText:e.suggestion.searchText,formatedAddress:e.suggestion.formatedAddress,readLink:e.suggestion.readLink,locationType:l.getHyperlocalType(e.suggestion.type,e.suggestion.subType),isoCode:t&&(t.countryIso||"")};return i.displayName=l.formatLocation(i),i.firstLine=l.getAutoSuggestLocationFirstLine(i),i.secondLine=l.getAutoSuggestLocationSecondLine(i),i}return{language:a.b.Locale,locality:e.suggestion.formatedLine1,region:e.suggestion.formatedLine2WithoutCountry,country:t&&(t.addressCountry||""),latitude:n&&Number(n).toString(),longitude:s&&Number(s).toString(),typeV6:e.suggestion.type,searchText:e.suggestion.searchText,formatedAddress:e.suggestion.formatedAddress,readLink:e.suggestion.readLink,locationType:l.getHyperlocalType(e.suggestion.type,e.suggestion.subType),isoCode:t&&(t.countryIso||"")}},this.cfg=Object.assign(Object.assign({},g.defaultConfig),t||{}),"CN"==(null==i?void 0:i.isoCode)&&(this.cfg.endpoint="https://cn.bing.com"),this._extraResult=this.cfg.latinPercentageLimit>0?5:0,this._geocoder=new p(this.cfg.geocoderKey,e),this.cfg.escapeISO=this.cfg.escapeISO.map(e=>e.toLowerCase()),this._autoSuggestModel=new h(e,this.cfg.endpoint,g.bingAutosuggestApi,this.cfg.appId,this.cfg.excludeSubTypes,this.cfg.includeSubTypes,this.cfg.escapeISO,this.cfg.flightId)}getLocationSearchResponse(e){return Promise.resolve(null)}getAutoSuggestResponse(e){var t,i,n;return Object(s.b)(this,void 0,void 0,(function*(){if(e){const s="zh-cn"===(null===(t=null===a.b||void 0===a.b?void 0:a.b.Locale)||void 0===t?void 0:t.toLowerCase())&&"zh"!==(null===(n=null===(i=null===a.b||void 0===a.b?void 0:a.b.ClientSettings)||void 0===i?void 0:i.geo_country)||void 0===n?void 0:n.toLowerCase())?"40,116":this.userLocation&&`${this.userLocation.latitude},${this.userLocation.longitude}`,o={searchText:e,maxResults:this.cfg.num+this._extraResult,userLocation:s,suggestionTypes:this.cfg.suggestionTypes,abbrSuggestions:!0,localMapView:null},r=yield this._autoSuggestModel.getSuggestions(o);return this._parseSuggestions(r)}}))}_latinPercentage(e){const t=e.locality+e.country+e.region+e.subRegion;if(!t)return 0;return t.match(g.latinParttern).join("").length/t.length}_parseSuggestions(e){const t=[],i=e.suggestions;if(i.length>0)for(let e=0;e<i.length;e++)t.push(this._getSuggestionResult(i[e]));let n=t.map(this._translateSuggestion);return this.cfg.latinPercentageLimit>0&&(n=n.filter(e=>this._latinPercentage(e)>this.cfg.latinPercentageLimit).slice(0,this.cfg.num)),n=n.filter(e=>l.isValidLocationToSuggest(e)),n}_getSuggestionResult(e){return new u(e)}_getLatLongFromReadLink(e){return Object(s.b)(this,void 0,void 0,(function*(){if(!e.readLink)return null;const t=new URL(e.readLink);return t.searchParams.append("appid",this.cfg.appId),this.fetchImpl(t.href).then(e=>e.json()).then(t=>{var i,n;const s=t.geo||(null===(n=null===(i=t.value)||void 0===i?void 0:i[0])||void 0===n?void 0:n.geo);if(s&&s.latitude&&s.longitude)return Object.assign(Object.assign({},e),{latitude:s.latitude.toString(),longitude:s.longitude.toString()})}).catch(e=>null)}))}geocodeSuggestion(e){return Object(s.b)(this,void 0,void 0,(function*(){const t=e;if(t.longitude&&t.latitude)return t;const i=yield this._getLatLongFromReadLink(e);if(i)return i;const n=this._getSuggestionAddress(t);return this._geocoder.geocode(n,null,1).then(e=>{if(e.success&&e.results&&e.results.length>0){const i=e.results[0];i.bbox;if(i.point){const e=i.point.coordinates;return t.latitude=e[0].toString(),t.longitude=e[1].toString(),t}}return null})}))}_getSuggestionAddress(e){return e&&"LocalBusiness"===e.typeV6&&e.formatedAddress?e.formatedAddress:e&&e.searchText}}g.bingAutosuggestApi="/api/v6/Places/AutoSuggest",g.defaultConfig={num:5,appId:"D41D8CD98F00B204E9800998ECF8427E1FBE79C2",geocoderKey:"AnTcaqBi2ypp0xI-OZNi4W_ik2KhjgpqioTAtXLC8GzkMBQRMlyxvxyTnd5b73im ",suggestionTypes:"",endpoint:"https://www.bing.com",excludeSubTypes:["CountryRegion","AdminDivision1"],includeSubTypes:["PopulatedPlace","AdminDivision2","Other","Island"],escapeISO:["us"],flightId:""},g.latinParttern=/[\u00C0-\u00ff\w\s\p{Number}.,/#!$%^&*;:{}=\-_`~()]+/gu;var m=i("VbA2"),f=i("5xIM"),b=i.n(f);function v(e){if(e&&e.useV6){const t=Object(n.a)()?window.fetch.bind(window):m.b;return new g(t,e,c.b.headLocation())}return new d(b.a,e)}},mOQN:function(e,t,i){"use strict";var n=i("oKML"),s=i("FoV5");t.a=function(e){return null==e?[]:Object(n.a)(e,Object(s.a)(e))}},mXQk:function(e,t,i){"use strict";i.d(t,"d",(function(){return n})),i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"e",(function(){return r})),i.d(t,"f",(function(){return c})),i.d(t,"g",(function(){return d})),i.d(t,"h",(function(){return l}));const n={ColdStart:"ColdStart",UpsellGetStartedButton:"GetStarted"},s="cold-start-close",a="cold-start-confirm",o="cold-start-selection-done",r={Article:{width:148,height:108},Provider:{width:64,height:64},Topic:{width:200,height:200},FollowCard:{width:82,height:82}},c=10,d="https://img-s-msn-com.akamaized.net/tenant/amp/entityid/AAtCmK3.img",l="coldStartUpsell"},oKML:function(e,t,i){"use strict";var n=i("mr4r");t.a=function(e,t){return Object(n.a)(t,(function(t){return e[t]}))}},pMIE:function(e,t,i){"use strict";var n=i("/XsO"),s=i("eupA");var a=function(e){return Object(s.a)(Object(n.a)(e))},o=i("mOQN");var r=function(e){return Object(s.a)(Object(o.a)(e))},c=i("SEb4");t.a=function(e){return(Object(c.a)(e)?a:r)(e)}},rFwl:function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var n=i("OOuA"),s=i("7nmT"),a=i.n(s),o=i("wirn"),r=i("1I/+"),c=i("Gy7L"),d=i("qibw"),l=i("OnwC"),h=i("Sunj"),u=i("pH9t"),p=i("nSud"),g=i("L1Sn");h.a,u.a,p.a;class m extends l.a{constructor(e){super(e),this.handledProps={managedClasses:void 0,menuItems:void 0,onDismiss:void 0,referrerButton:void 0,requestContext:void 0,overrideStyles:void 0,preventFocusScroll:void 0,innerElemScrollTop:void 0},this.determinePosition=()=>{const{referrerButton:e}=this.props;if(e){const{top:t,left:i,width:n}=e.getBoundingClientRect();return{top:t+window.scrollY,left:i+window.scrollX,offset:n}}return{top:window.scrollY,left:window.scrollX,offset:0}},this.menuItemKeyDown=e=>{e.keyCode===c.l&&this.props.menuItems.find(t=>t.id===e.currentTarget.id).onClick(e)},this.keyDownHandler=e=>{const{referrerButton:t,onDismiss:i}=this.props;e.keyCode===c.m?(t&&t.focus(),i&&i()):this.tabEventHandler(e)},this.tabEventHandler=e=>{const{referrerButton:t,onDismiss:i}=this.props,n=a.a.findDOMNode(this);e.keyCode===c.r&&t&&n.contains(document.activeElement)&&(t.focus(),i&&i(),e.preventDefault())},this.state={width:0,height:0}}componentDidMount(){const e=a.a.findDOMNode(this);this.setState({width:e.offsetWidth,height:e.offsetHeight});const t=!!this.props.preventFocusScroll;this.firstMenuItemRef&&this.firstMenuItemRef.focus({preventScroll:t})}componentWillUnmount(){const e=document.getElementsByClassName(this.props.managedClasses.menuItem);Array.from(e).forEach(e=>{g.a.get(e).isCaptured=!1})}render(){return Object(n.a)("div",Object.assign({onKeyDown:this.keyDownHandler,tabIndex:-1,style:Object.assign(Object.assign({},this.getPlacementStyle(document.dir)),{position:"absolute"})},this.unhandledProps(),{className:this.props.managedClasses.menu}),Object(n.a)(h.a,null,this.renderActionsMenuSectionItems()))}renderActionsMenuSectionItems(){const{menuItems:e}=this.props,t={marginTop:0,marginBottom:"6px"};return e.map((e,i)=>e.isDivider?Object(n.a)(p.a,{style:t}):Object(n.a)(u.a,Object.assign({ref:e=>this.firstMenuItemRef=this.firstMenuItemRef||e,role:"menuitem",key:"ccaitem-"+i},e.telemetryTags,{onClick:e.onClick,onKeyDown:this.menuItemKeyDown,id:e.id,tabIndex:0,class:this.props.managedClasses.menuItem}),this.renderGlyph(e.glyph),Object(n.a)("span",{"aria-label":e.ariaLabel?e.ariaLabel:e.title},e.title)))}renderGlyph(e){return e?"string"==typeof e?Object(n.a)("span",{slot:"start",dangerouslySetInnerHTML:{__html:e}}):Object(n.a)(o.a,{glyphType:e,slot:"start"}):null}getPlacementStyle(e){const{width:t,height:i}=this.state;let n,s,a;const{referrerButton:o,innerElemScrollTop:c}=this.props,d=c||0;if(o){const e=this.determinePosition();n=e.left,s=e.top+e.offset+document.body.scrollTop,a=e.offset}if(!t)return{top:s,left:window.scrollX};const l=Object(r.b)(this.props.requestContext.data.innerWidth,"innerWidth"),h=window.document&&window.document.documentElement&&window.document.documentElement.offsetHeight+document.body.scrollTop;if(h&&s+i>h){if(s-i-a<0)return this.getHorizontallyPlacedStyle(e,n,s,a,l,h,t,i);s=s-i-a}s+=d;const u={top:s,left:Math.max(n-t+a,.5*a)},p={top:s,left:n};return this.getPrioritizedFittingPosition(e,[u,p],t,l,a)}getPrioritizedFittingPosition(e,t,i,n,s){const[a,o]=e===d.a.rtl?t:[t[1],t[0]],r=a.left+i<n,c=o.left+i<n;if(r)return a;if(!r&&c)return o;{const i={top:t[0].top};return e===d.a.rtl?i.right=.5*s:i.left=.5*s,i}}getHorizontallyPlacedStyle(e,t,i,n,s,a,o,r){i-n+r<=a?i-=n:i-r>=0?i-=r:i=i-.5*n<.5*a?.5*n:a-.5*n-r;const c={top:i,left:t+n},d={top:i,left:t-o};return this.getPrioritizedFittingPosition(e,[d,c],o,s,n)}}const f={menu:{display:"inline","animation-duration":"0.367s","animation-fill-mode":"both","animation-name":"fadeIn, slideIn","animation-timing-function":"cubic-bezier(0.1, 0.9, 0.2, 1)","border-radius":"4px","box-shadow":"0 2.4px 7.2px rgba(0, 0, 0, 0.18), 0 12.8px 28.8px rgba(0, 0, 0, 0.22)","max-width":"275px","min-width":"240px",overflow:"hidden",position:"absolute","z-index":""+i("0fst").a.Flyout,"&:focus":{outline:"none"},"& fluent-menu-item::part(content)":{width:"100%"}},"@keyframes fadeIn":{from:{opacity:0},to:{opacity:1}},"@keyframes slideIn":{from:{transform:"translate3d(0px, -10px, 0px)"},to:{transform:"translate3d(0px, 0px, 0px)"}},menuItem:{"grid-template-columns":"32px auto"}};var b=i("+viU");const v=Object(b.a)(f)(m)},rGfm:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("G82u");class s{}s.refreshRiver=new n.a("RiverRefresh"),s.repaintRiver=new n.a("RiverRepaint"),s.riverRefreshed=new n.a("RiverRefreshed"),s.riverQueryUpdated=new n.a("RiverQueryUpdated"),s.riverLocationUpdated=new n.a("RiverLocationUpdated")},"uZl+":function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return a}));var n=i("Am8i");const s={cancelTelemetryName:"Cancel",cardActionV2TelemetryName:"Card Action Ellipses",closeHeadlineTelemetryName:"Close dialog",closeModuleTelemetryName:"Dismiss",copyTelemetryName:"Copy",hideMenuItemTelemetryName:"Hide",hideHeadlineTelemetryName:"Hide Story",muteMenuItemTelemetryName:"MutePublisher",muteButtonTelemetryName:"Mute",muteConfirmationTelemetryName:"Hide Stories from Publisher",reportButtonTelemetryName:"Submit",reportCheckedTelemetryName:"Checked",reportDialogTelemetryName:"ReportedReason",reportHeadlineTelemetryName:"Report an issue",reportMenuItemTelemetryName:"ReportArticle",reportUncheckedTelemetryName:"Unchecked",reportDialogFeedbackTextTelemetryName:"Feedback",reportDialogPrivacyStatementTelemetryName:"Privacy Statement",saveMenuItemTelemetryName:"Save",showFewerHeadlineTelemetryName:"Fewer stories like this",showFewerMenuItemTelemetryName:"showFewer",showMoreHeadlineTelemetryName:"More stories like this",showMoreMenuItemTelemetryName:"showMore",shareArticleTelemetryName:"ShareArticle",shareDialogTelemetryName:"Share"};class a{constructor(e){if(this.componentRoot=e,this.mapSocialMediaShareIconTelemetry=(e,t,i,s={})=>(this.socialMediaShareIconTelemetryObjects[e]=this.shareDialogTelemetryObject.addOrUpdateChild({name:t,behavior:n.c.Navigate,action:n.b.Click,content:Object.assign(Object.assign({},s),{headline:i})},this.socialMediaShareIconTelemetryObjects[e]),this.socialMediaShareIconTelemetryObjects[e]),this.mapMenuItemTelemetry=(e,t,i,n,s,a)=>{if(this.componentRoot)return this.menuItemsTelemetryObjects[e]=this.componentRoot.addOrUpdateChild({name:e,type:t,behavior:i,content:Object.assign(Object.assign({},a),{headline:n||e,id:s})},this.menuItemsTelemetryObjects[e]),this.menuItemsTelemetryObjects[e]},this.getReportDialogActionButtonTelemetryObject=(e,t,i,a,o)=>(this.reportDialogTelemetryObjects.actionButtonTelemetryObject=this.reportDialogTelemetryObjects.dialogTelemetryObject.addOrUpdateChild({name:s.reportButtonTelemetryName,type:n.f.Report,behavior:n.c.Report,action:n.b.Submit,content:Object.assign({headline:i,id:a},o),ext:{fields:{checkedReportOption:e,feedbackText:t}}},this.reportDialogTelemetryObjects.actionButtonTelemetryObject),this.reportDialogTelemetryObjects.actionButtonTelemetryObject),!e)return;const t=e.contract.content||{},i=this.componentRoot.addOrUpdateChild({name:s.muteConfirmationTelemetryName,type:n.f.Interaction,behavior:n.c.Mute,content:Object.assign(Object.assign({},t),{headline:s.muteButtonTelemetryName}),action:n.b.View});this.muteDialogTelemetryObjects={dialogTelemetryObject:i,cancelButtonTelemetryObject:i.addOrUpdateChild({name:s.cancelTelemetryName,behavior:n.c.MuteCancel,content:Object.assign(Object.assign({},t),{headline:s.cancelTelemetryName})}),closeButtonTelemetryObject:i.addOrUpdateChild({name:s.closeModuleTelemetryName,behavior:n.c.Close,content:Object.assign(Object.assign({},t),{headline:s.closeHeadlineTelemetryName})}),actionButtonTelemetryObject:i.addOrUpdateChild({name:s.muteButtonTelemetryName,behavior:n.c.Mute,content:Object.assign(Object.assign({},t),{headline:s.hideMenuItemTelemetryName})})};const a=this.componentRoot.addOrUpdateChild({name:s.reportDialogTelemetryName,type:n.f.Interaction,behavior:n.c.Report,content:Object.assign(Object.assign({},t),{headline:s.reportHeadlineTelemetryName}),action:n.b.Click});this.reportDialogTelemetryObjects={dialogTelemetryObject:a,cancelButtonTelemetryObject:a.addOrUpdateChild({name:s.cancelTelemetryName,behavior:n.c.Cancel,content:Object.assign(Object.assign({},t),{headline:s.cancelTelemetryName})}),closeButtonTelemetryObject:a.addOrUpdateChild({name:s.closeModuleTelemetryName,behavior:n.c.Close,content:Object.assign(Object.assign({},t),{headline:s.closeHeadlineTelemetryName})}),actionButtonTelemetryObject:a.addOrUpdateChild({name:s.reportButtonTelemetryName,behavior:n.c.Mute,content:Object.assign(Object.assign({},t),{headline:t.headline})})},this.shareDialogTelemetryObject=this.componentRoot.addOrUpdateChild({name:s.shareDialogTelemetryName,type:n.f.Interaction,behavior:n.c.Share,content:Object.assign(Object.assign({},t),{headline:s.shareDialogTelemetryName}),action:n.b.Click}),this.articleShareTelemetryObject=this.shareDialogTelemetryObject.addOrUpdateChild({name:s.shareArticleTelemetryName,type:n.f.Headline,behavior:n.c.Navigate,content:Object.assign(Object.assign({},t),{headline:s.shareArticleTelemetryName})}),this.closeShareButtonTelemetryObject=this.shareDialogTelemetryObject.addOrUpdateChild({name:s.closeModuleTelemetryName,behavior:n.c.Close,action:n.b.Click,content:Object.assign(Object.assign({},t),{headline:s.closeHeadlineTelemetryName})}),this.copyShareButtonTelemetryObject=this.shareDialogTelemetryObject.addOrUpdateChild({name:s.copyTelemetryName,behavior:n.c.Share,action:n.b.Click,content:Object.assign(Object.assign({},t),{headline:s.copyTelemetryName})}),this.socialMediaShareIconTelemetryObjects={},this.menuItemsTelemetryObjects={},this.reportDialogPrivacyStatementLinkTelemetryObject=a.addOrUpdateChild({name:s.reportDialogPrivacyStatementTelemetryName,behavior:n.c.Navigate,content:Object.assign(Object.assign({},t),{headline:s.reportDialogPrivacyStatementTelemetryName})})}setTelemetryObjectContract(e,t,i){return e.contract&&(e.contract.content.id=t,e.contract.content.type=n.d.Article,e.contract.destinationUrl=i||""),e}}},"x/PH":function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var n=i("D57K"),s=i("rvYQ"),a=i("msIb"),o=i("KETb"),r=i("XlyT"),c=i("HxRh"),d=i("X9Vi"),l=i("ypwz");class h{constructor(e,t){this.fetchImpl=e,this.config=t,this.ocid="Peregrine",this.localizeLocationApi="weather/locations/search"}getLocalisedLocationDetails(e){return Object(n.b)(this,void 0,void 0,(function*(){if(!d.b.isValid(e))return;const t=yield a.a.getBaseRequestData("GET"),i=[...s.b.AppType===l.a.WindowsNewsPlus?a.a.getCommonParams2("winp2",!1):a.a.getCommonParams2(this.ocid),{key:"lat",value:e.latitude},{key:"lon",value:e.longitude},{key:"locale",value:s.b.CurrentMarket}],u=new URL(`${this.localizeLocationApi}${s.b.ServiceUrlBase.search}`,s.b.ServiceUrlBase);let p;i.forEach(e=>{e.value&&u.searchParams.set(e.key,e.value)}),u.searchParams.delete("fdhead"),this.config&&this.config.noDynamicQueryParams&&(u.searchParams.delete("user"),u.searchParams.delete("activityId"));try{const i=yield Object(o.a)(()=>Object(n.b)(this,void 0,void 0,(function*(){const e=yield this.fetchImpl(u.href,t);if(!e.ok){if(p=`code=${e.status}, ${e.statusText}`,e.status>=400&&e.status<500&&408!=e.status)return{isError:!0};throw Error(e.statusText)}return e.json()})),"getLocalizedLocation");if(null==i?void 0:i.isError)throw Error(p);return h.convertResponse(i,e,u.href)}catch(e){p||(p=e&&e.toString()),Object(r.c)(e,c.Rj,p+","+this.localizeLocationApi,u.href)}}))}static convertResponse(e,t,i){const n=e&&e.value&&e.value[0]&&e.value[0].responses||[],a=n[0]&&n[0].locations[0];let o=void 0;if(a&&(o={latitude:t.latitude,longitude:t.longitude,isDetected:t.isDetected,locality:a.locality,region:a.adminDistrict,subRegion:a.adminDistrict2,country:a.countryRegion,isoCode:a.countryCode,language:s.b.CurrentMarket},o.displayName=d.b.getDisplayName(o)),o&&o.displayName)return o;Object(r.b)(c.Rj,"unable to construct valid display name",i)}}},y4Tj:function(e,t){},zZnt:function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return r}));var n=i("Cj5D"),s=i("dTwT");const a={bingShoppingVisible:!0,moneyVisible:!0,sportsVisible:!0,weatherVisible:!0,horoscopeVisible:!0,onThisDayVisible:!0,electionsVisible:!0,esportsVisible:!0,lotteryVisible:!0,qnaVisible:!0,recipesVisible:!0},o="localCardState";function r(e,t){switch(e){case n.a.edgePageSettings:{const e=t,i=e?e.getCurrentState():void 0;return{weatherVisible:!(!i||!i.weatherVisible),sportsVisible:!(!i||!i.sportsVisible),moneyVisible:!(!i||!i.moneyVisible),bingShoppingVisible:!(!i||!i.bingShoppingVisible),horoscopeVisible:!(!i||!i.horoscopeVisible),onThisDayVisible:!(!i||!i.onThisDayVisible),electionsVisible:!(!i||!i.electionsVisible),esportsVisible:!(!i||!i.esportsVisible),lotteryVisible:!(!i||!i.lotteryVisible),qnaVisible:!(!i||!i.qnaVisible),recipesVisible:!(!i||!i.recipesVisible)}}case n.a.chromiumPageSettings:{const e=t,i=e?e.getCurrentState():void 0;return{weatherVisible:!!(i&&i.sdCardSettings&&i.sdCardSettings.weatherVisible),sportsVisible:!!(i&&i.sdCardSettings&&i.sdCardSettings.sportsVisible),moneyVisible:!!(i&&i.sdCardSettings&&i.sdCardSettings.moneyVisible),bingShoppingVisible:!!(i&&i.sdCardSettings&&i.sdCardSettings.bingShoppingVisible),horoscopeVisible:!!(i&&i.sdCardSettings&&i.sdCardSettings.horoscopeVisible),onThisDayVisible:!!(i&&i.sdCardSettings&&i.sdCardSettings.onThisDayVisible),electionsVisible:!!(i&&i.sdCardSettings&&i.sdCardSettings.electionsVisible),esportsVisible:!!(i&&i.sdCardSettings&&i.sdCardSettings.esportsVisible),lotteryVisible:!!(i&&i.sdCardSettings&&i.sdCardSettings.lotteryVisible),qnaVisible:!!(i&&i.sdCardSettings&&i.sdCardSettings.qnaVisible),recipesVisible:!!(i&&i.sdCardSettings&&i.sdCardSettings.recipesVisible)}}case n.a.localStorageSettings:return Object(s.a)().supported?Object(s.a)().getObject(o,a):a;default:return}}}}]);